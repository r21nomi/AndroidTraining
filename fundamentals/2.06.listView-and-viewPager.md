---
title: RecyclerViewとViewPager
description: この章では、RecyclerView と ViewPager の2つの特殊な View について解説します。
keywords: ["android","training", "基礎", "スキル", "開発", "developer", "プログラミング", "RecyclerView", "ViewPager"]

---

参考：[リストとカードの作成](https://developer.android.com/training/material/lists-cards.html?hl=ja)  
参考：[RecyclerView](https://developer.android.com/reference/android/support/v7/widget/RecyclerView.html?hl=ja)  
参考：[PagerAdapter &#124; Android Developers](http://developer.android.com/reference/android/support/v4/view/PagerAdapter.html)  
参考：[FragmentPagerAdapter &#124; Android Developers](http://developer.android.com/reference/android/support/v13/app/FragmentPagerAdapter.html)  

## RecyclerView
[リストとカードの作成](https://developer.android.com/training/material/lists-cards.html?hl=ja)

### 複数タイプのレイアウトを表示する
1つのRecyclerViewの中にレイアウトの異なる複数のViewを表示する場合は、`getItemViewType`で異なるintを返すようにします。

<img src="{{site.baseurl}}/assets/02-06/multitype_viewholder.png" width="300" />

```java
// ジェネリクスの型をRecyclerView.Adapterにする
public class MyAdapter extends RecyclerView.Adapter<RecyclerView.ViewHolder> {

    private List<String> mDataset1;
    private List<Integer> mDataset2;

    public MyAdapter(List<String> mDataset1, List<Integer> mDataset2) {
        this.mDataset1 = mDataset1;
        this.mDataset2 = mDataset2;
    }

    @Override
    public int getItemCount() {
        return mDataset1.size() + mDataset2.size();
    }

    @Override
    public int getItemViewType(int position) {
        // positionに応じて異なるtype（int）を返す
        return position < mDataset1.size() ? 0 : 1;
    }

    @Override
    public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {
        // viewTypeの値によって生成するViewHolderを分ける
        switch (viewType) {
            case 0:
                View view1 = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_viewholder1, parent, false);
                return new ViewHolder1(view1);

            case 1:
                View view2 = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_viewholder2, parent, false);
                return new ViewHolder2(view2);

            default:
                return null;
        }
    }

    @Override
    public void onBindViewHolder(RecyclerView.ViewHolder holder, int position) {
        // ViewHolderの型をみて処理を分ける
        if (holder instanceof ViewHolder1) {
            // Set items to ViewHolder1

        } else if (holder instanceof ViewHolder2) {
            // Set items to ViewHolder2
        }
    }

    public static class ViewHolder1 extends RecyclerView.ViewHolder {
        public ViewHolder1(View itemView) {
            super(itemView);
        }
    }

    public static class ViewHolder2 extends RecyclerView.ViewHolder {
        public ViewHolder2(View itemView) {
            super(itemView);
        }
    }
}
```

## ViewPager

ViewPager は、横にフリックして View を切り替えるための View です。  
単純な View だけでなく、Fragment を持たせて、複数の Fragment を切り替える用途にも使用出来ます。  

ViewPager も、ListView と同じく、Adapter に中身を管理させます。  
また、ViewPager は Support Package で提供されている機能です。  

### PagerAdapter
データをバインドして表示する際には、ListAdapter インタフェースを実装した Adapter を使用します。  
PagerAdapter は ViewPager を表示するための基本的な Adapter です。  

#### PagerAdapterの使い方
ここでは TextView をもつページが5つある ViewPager を作成します。  

ViewPager を表示するには以下の作業が必要となります。  

  * ViewPager をレイアウトxmlに配置  
  * 独自 PagerAdapter を実装  
  * ViewPager に Adapter をセットする  

##### ViewPagerをレイアウトxmlに配置  
ViewPager は Support Package で提供されているため、`android.support.v4.view.ViewPager`と記述します。

activity_main.xml  

```xml
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainActivity" >

    <android.support.v4.view.ViewPager
        android:id="@+id/Pager"
        android:layout_width="match_parent"
        android:layout_height="match_parent" />

</RelativeLayout>
```

##### 独自 PagerAdapter を実装
PagerAdapter を実装するには最低限以下のメソッドを実装する必要があります。  

メソッド名 | 役割
--- | ---
Object instantiateItem(ViewGroup container, int position) | ページを生成します
void destroyItem(ViewGroup container, int position, Object object) | ページを削除します
int getCount() | ページ数を返却します
boolean isViewFromObject(View view, Object object) | instantiateItemで返却されたキーObjectとページが関連付いているかどうかを確認します。  

SamplePagerAdapter.java

```java
class SamplePagerAdapter extends PagerAdapter {

    private static final int PAGE_COUNT = 5;

    private Context mContext;

    public SamplePagerAdapter(Context context) {
        super();
        mContext = context;
    }

    @Override
    public Object instantiateItem(ViewGroup container, int position) {

        // TextViewを生成
        TextView textView = new TextView(mContext);
        textView.setText("Position:" + position);
        //コンテナに追加
        container.addView(textView);

        // ここではTextView自体をキーとして返しています
        return textView;
    }

    @Override
    public void destroyItem(ViewGroup container, int position, Object object) {
        // viewの削除
        // objectはinstantiateItemで返却したオブジェクトです
        container.removeView((View) object);
    }

    @Override
    public int getCount() {
        // ページ数を返します。今回は固定値としています。
        return PAGE_COUNT;
    }

    @Override
    public boolean isViewFromObject(View view, Object object) {
        // キーが正しいかを判定
        return view == (TextView) object;
    }
```
ViewPager はキーとなる object でそれぞれのページを関連付けています。このキーは instantiateItem メソッドで返却された object であり Adapter 内でのユニークな識別子として使用されます。  
上記のコードでは TextView 自身をキーとして使用しています。  

##### ViewPagerにAdapterをセットする  
MainActivity.java

```java
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        ViewPager pager = (ViewPager) findViewById(R.id.Pager);
        pager.setAdapter(new SamplePagerAdapter(this));

    }
```

### FragmentPagerAdapter
ViewPager は Fragment の切り替えに使われるケースが多いです。  
Fragment は簡単に提供できますし、それぞれのページのライフサイクルの管理ができるためです。  
ViewPager で Fragment を使う際のよくあるユースケースをカバーし実装されたものが、 FragmentPagerAdapter と FragmentStatePagerAdapter になります。  

FragmentPagerAdapter は表示したページをメモリに保持します。
FragmentStatePagerAdapter は非表示になったページはステートの保持のみを行い Fragment を破棄します。ページ数が多い場合メモリ消費が大きくなるため使用すると良いです。  

#### FragmentPagerAdapter の使い方

* ViewPager をレイアウトxmlに配置  
* Fragment を作成  
* 独自 FragmentPagerAdapter を実装  
* ViewPager にAdapter をセットする  

##### ViewPagerをレイアウトxmlに配置

PagerAdapter の使い方と同様のため割愛します。

##### Fragmentを作成

サンプルでは表示位置（position）を TextView 表示します。
そのため、newInstance メソッドを用意し position を引数として渡し Bundle を設定しています。  
Bundle から position を取得し、TextView に設定しています。  

fragment_main.xml

```xml
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@android:color/black" >

    <TextView
        android:id="@+id/TextView1"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:layout_margin="4dp"
        android:background="@android:color/white"
        android:gravity="center"
        android:textSize="90sp"
        android:textStyle="bold" />

</FrameLayout>
```
SampleFragment.java

```java
public class SampleFragment extends Fragment {

    public static SampleFragment newInstance(int position) {

        SampleFragment sampleFragment = new SampleFragment();
        Bundle bundle = new Bundle();
        bundle.putInt("position", position);
        sampleFragment.setArguments(bundle);

        return sampleFragment;
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {

        Bundle bundle = getArguments();
        int position = 0;
        if (bundle != null) {
            position = bundle.getInt("position");
        }

        View view = inflater.inflate(R.layout.fragment_main, container, false);

        TextView text = (TextView) view.findViewById(R.id.TextView1);
        text.setText(String.valueOf(position));

        return view;
    }
}
```

##### 独自 FragmentPagerAdapter を実装  
FragmentPagerAdapter を実装するには最低限以下のメソッドを実装する必要があります。  


メソッド名 | 役割
--- | ---
Fragment getItem (int position) | Fragmentを生成します
int getCount() | ページ数を返します


SampleFragmentPagerAdapter.java

```java
public class SampleFragmentPagerAdapter extends FragmentPagerAdapter {

    private static final int PAGE_COUNT = 5;

    public SampleFragmentPagerAdapter(FragmentManager fm) {
        super(fm);
    }

    @Override
    public Fragment getItem(int position) {
        return SampleFragment.newInstance(position);
    }

    @Override
    public int getCount() {
        return PAGE_COUNT;
    }

}
```

##### ViewPager に Adapter をセットする
Fragment を管理するため FragmentManager をコンストラクタに渡します。
Support Package を使用しているため、 FragmentManager を生成するメソッド名は getSupportFragmentManager となります。  
( Support Package でない場合は getFragmentManager となります)  

MainActivity.java

```java
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        ViewPager pager = (ViewPager) findViewById(R.id.Pager);

        FragmentManager fm = getSupportFragmentManager();
        SampleFragmentPagerAdapter sampleFragmentPagerAdapter = new SampleFragmentPagerAdapter(fm);

        pager.setAdapter(sampleFragmentPagerAdapter);
    }
```

## 実習・課題

### RecyclerView
1. (実習) [リストとカードの作成の例](https://developer.android.com/training/material/lists-cards.html?hl=ja#RVExamples)を写経してリストを表示するコードを書いてください。
2. (実習) 実習1のリストの各アイテムをタップしたらそのアイテムのdata（String）がToastで表示されるようにしてください。
3. (課題) 以下のRecyclerViewを表示するように実装してください。
  * [スクリーンショット]({{site.baseurl}}/assets/02-06/assignment/assignment_1_sample.png)  
Adapterには予め用意されているBookクラスを使用するようにして下さい。
4. (課題) 課題3で作成したAdapterを修正し、2種類のViewHolderを表示できるようにしてください。  
  また、各アイテムをタップしたらそのアイテムのdata（String）がToastで表示されるようにしてください。
  * [スクリーンショット]({{site.baseurl}}/assets/02-06/assignment/multitype_viewholder.png)  

### ViewPager
1. (実習) [FragmentPagerAdapter の使い方](#FragmentPagerAdapter の使い方)で説明したプロジェクトを写経して実行してください。説明したプロジェクトは`AndroidTraining/projects/fundamentals/6th/FragmentViewPagerSample`にあります。  
2. (課題) 実習1のプロジェクトを引き続き使用してください。ActionBarのTab Navigationを追加し、Tabを選択したら該当のページが表示されるようにしてください。（3番目のTabを選択したら3ページ目が表示される）また、ページをスクロールさせたら該当のTabが選択されるようにしてください。 また、Tabとページの数は3つとしてください。  
