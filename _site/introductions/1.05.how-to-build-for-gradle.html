<!DOCTYPE html>
<html lang="ja">

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="この章では Android のビルド、とりわけ、Gradleというビルドシステムを用いたビルドについて解説したいと思いす。" />
    <meta name=viewport content="width=device-width, initial-scale=1">
    <!-- ogp for twitter -->
    <meta content="@mixi_engineers" name="twitter:site" />
    <meta content="summary" name="twitter:card" />
    
    <meta content="Android のビルドについて(Gradle) - mixi-inc/AndroidTraining" name="twitter:title" />
    
    <meta content="この章では Android のビルド、とりわけ、Gradleというビルドシステムを用いたビルドについて解説したいと思いす。" name="twitter:description" />
    <meta content="/assets/logo.png" name="twitter:image:src" />
    <!-- ogp -->
    <meta content="mixi-inc/AndroidTraining" property="og:site_name" />
    <meta content="article" property="og:type" />
    <meta content="/assets/logo.png" property="og:image" />
    
    <meta content="Android のビルドについて(Gradle) - mixi-inc/AndroidTraining" name="og:title" />
    
    <meta content="/introductions/1.05.how-to-build-for-gradle.html" property="og:url" />
    <meta content="この章では Android のビルド、とりわけ、Gradleというビルドシステムを用いたビルドについて解説したいと思いす。" property="og:description" />
    
    <meta name="keyword" content="android, training, 基礎, スキル, 開発, developer, プログラミング, gradle, ビルド" />
    

    <meta name="go-import" content="github.com/mixi-inc/AndroidTraining git https://github.com/mixi-inc/AndroidTraining.git">
    <script src="/AndroidTraining/bower_components/webcomponentsjs/webcomponents.js"></script>

    <link rel="stylesheet" type="text/css" media="screen" href="/AndroidTraining/stylesheets/main.css">
    <link rel="shortcut icon" href="/AndroidTraining/assets/favicon.ico" />
    <link rel="import" href="/AndroidTraining/bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-drawer-panel/paper-drawer-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-header-panel/paper-header-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-toolbar/paper-toolbar.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-menu/paper-menu.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-item/paper-item.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="/AndroidTraining/bower_components/iron-icons/iron-icons.html">
    <style is="custom-style">
        paper-scroll-header-panel:not([style-scope]):not(.style-scope) {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        paper-toolbar.tall .bottom:not([style-scope]):not(.style-scope) {
            font-size: 40px;
            margin-left: 60px;

            -webkit-transform-origin: left center;
            transform-origin: left center;
        }

        .content:not([style-scope]):not(.style-scope) {
            padding: 8px;
        }

        .spacer:not([style-scope]):not(.style-scope) {
            -ms-flex: 1 1 0.000000001px;
            -webkit-flex: 1;
            flex: 1;
            -webkit-flex-basis: 0.000000001px;
            flex-basis: 0.000000001px;
        }

    </style>
    <title>Android のビルドについて(Gradle) - mixi-inc/AndroidTraining</title>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-50931519-13', 'auto');
    ga('send', 'pageview');
    </script>
  </head>

  <body itemscope itemtype="http://schema.org/Article" fullbleed layout vertical>

    <paper-drawer-panel selected="main" >
      <!-- MENU -->
      <paper-header-panel mode="seamed" drawer class="drawer">
        <nav>
    <ol class="chapter_navigation">
        <a href="/AndroidTraining/">Home</a>
        <li>まえがき</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/introductions/1.01.about-android-os.html">Android-OSについて</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.02.prepare-for-development.html">開発環境の準備</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.03.create-project-for-android-studio.html">プロジェクトの作成</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.04.basic-knowledge.html">Androidの基礎知識</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.05.how-to-build-for-gradle.html">Android のビルドについて(Gradle)</a></li>
            
        </ol>
        <li>基礎編</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/fundamentals/2.01.create-layout.html">アプリのレイアウト作成</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.02.activity-and-fragment.html">ActivityとFragment</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.03.application-resource-management.html">アプリのリソース管理</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.04.messaging-and-notification.html">メッセージングと通知</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.05.actionbar-and-interaction-control.html">AppBarとインタラクション制御</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.06.listView-and-viewPager.html">RecyclerViewとViewPager</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.07.serialize-and-collection-and-perpetuation.html">直列化とコレクション、永続化</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.08.async-processing.html">非同期処理</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.09.network-access.html">ネットワーク通信</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.10.database.html">データベース</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.11.testing-for-android-studio.html">テスト(AndroidStudio)</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.11.testing.html">テスト</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.12.handler-and-looper.html">HandlerとLooper</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.13.webView.html">WebView</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.14.accountmanager.html">AccountManager</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.15.advance-contentprovider.html">ContentProviderの発展</a></li>
            
        </ol>
        <li>実務編</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/advanced/3.01.build-for-eclipse.html">デバッグと自動ビルド(Eclipse)</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.01.build-for-gradle.html">自動ビルド(Android Studio)</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.02.architecture-and-di.html">アーキテクチャ設計と DI</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.03.advanced-layout.html">続・アプリのレイアウト作成</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.04.user-interface.html">ユーザインタフェース設計</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.05.security.html">セキュリティ</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.06.google-api.html">Google API</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.07.google-play-services.html">Google Play Services</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.08.cloud-sync.html">クラウド同期</a></li>
            
        </ol>
        <li>デザイナー編</li>
        <ol>
        </ol>
    </ol>
    <ol class="appex_navigation">
        <li>付録</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/appendix/A.01.import-from-git-for-eclipse.html">Git リポジトリからのプロジェクトのインポート</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.02.basic-java.html">Java の文法の基礎</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.03.how-to-create-avd.html">仮想デバイスの作成</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.04.advanced-java.html">Javaの活用</a></li>
            
        </ol>
    </ol>
</nav>

      </paper-header-panel>
      <paper-scroll-header-panel main condenses>
        <!-- HEADER -->
        <paper-toolbar class="mainheader tall" role="toolbar">
    <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>

    <span class="title"></span>

    <a id="forkme_banner" href="https://github.com/mixi-inc/AndroidTraining" role="button">
        <paper-icon-button src="/AndroidTraining/images/blacktocat.png"></paper-icon-button> <span>View on GitHub</span>
    </a>

    <div class="middle title">mixi-inc/AndroidTraining</div>
    <div class="bottom title">Android のビルドについて(Gradle)</div>
</paper-toolbar>


<div id="description" itemprop="description">この章では Android のビルド、とりわけ、Gradleというビルドシステムを用いたビルドについて解説したいと思いす。</div>



        <!-- MAIN CONTENT -->
        <div id="main_content_wrap" class="content outer" itemprop="articleBody">
          <section id="main_content" class="inner">
            <p>記述内容は <em>Android Studio 2.1.2</em> , <em>Gradle 2.14</em> 時点のものです。</p>

<h2 id="section">目次</h2>
<ul>
  <li><a href="#about-gradle">Gradle とは</a>
    <ul>
      <li><a href="#requirement">必要環境</a></li>
      <li><a href="#elements">ビルドの構成要素</a></li>
    </ul>
  </li>
  <li><a href="#hello-gradle">Gradle に触れてみよう</a>
    <ul>
      <li><a href="#check">Hello world! の前に環境構築</a></li>
      <li><a href="#project-tree">プロジェクト構成</a></li>
      <li><a href="#hello-world">改めて、Hello world!</a></li>
      <li><a href="#exec">実行</a></li>
      <li><a href="#syntax">記法</a></li>
      <li><a href="#gradlew">gradlew</a></li>
    </ul>
  </li>
  <li><a href="#gradle-in-as">Android Studio における Gradle</a>
    <ul>
      <li><a href="#build-script">ビルドスクリプト</a></li>
      <li><a href="#project-gradle">Project直下のbuild.gradle</a></li>
      <li><a href="#app-gradle">app内の build.gradle</a></li>
      <li><a href="#structure">Android Studio の Project Structure との関係</a></li>
    </ul>
  </li>
  <li><a href="#more-infomation">More infomation</a></li>
</ul>

<hr />

<h2 id="about-gradle">Gradle とは</h2>

<p><a href="http://www.gradle.org/">Gradle</a> とは、Java（JVM）環境におけるビルドシステムのことで、オープンソースプロジェクトとして無償で公開されています。<br />
特長としては、ビルドの記述を XML のような構造ではなく、Groovy ライクな 独自の DSL を用い、スクリプトとして記述できる点です。<br />
用意されているAPIを利用することで、強力な記述が可能となります。</p>

<h3 id="requirement">必要環境</h3>
<p>バージョン 1.6 以上の JVM を必要とします。</p>

<h3 id="elements">ビルドの構成要素</h3>
<p>ビルドスクリプトを実際に触る前に、簡単にビルドの概念を説明します。</p>

<p><strong>ビルドは１つ以上のプロジェクトで構成</strong>され、<br />
その<strong>プロジェクトは１つ以上のタスクで構成</strong>されます。<br />
以下の様なケースを想像してもらえるとイメージが湧きやすいかと思います。</p>

<blockquote>
  <p>『アプリパッケージCを生成するために、A及びBのjarが必要で、<br />
　そのA及びBのjarを作るためのモジュールがあり、<br />
　それらを使って、アプリパッケージCを作るためのビルドを用意する』</p>
</blockquote>

<p>A, B , Cそれぞれにモジュールがありそのビルドをビルドスクリプトで記述します。<br />
また、タスクとはこれ以上分割できないような作業の単位を指します。</p>

<h2 id="hello-gradle">Gradle に触れてみよう</h2>

<h3 id="check">Hello world! の前に環境構築</h3>
<p>練習だけなので、簡単に確認できる環境を用意します。<br />
前章の<a href="/AndroidTraining/introductions/1.03.create-project-for-android-studio.html">プロジェクトの作成</a>で、既に Android Studio をインストール済みかと思います。<br />
こちらに、Gradle が同梱されていますので、こちらを利用します。</p>

<p>説明は割愛しますが、別途、<a href="http://www.gradle.org/downloads">Gradle公式サイト</a>よりダウンロードして、実行環境を構築して頂いても問題ありません。</p>

<h3 id="project-tree">プロジェクト構成</h3>
<p>Android Studio でProjectを作ると、以下の様なツリー構造となります。
ビルドスクリプトは <code class="highlighter-rouge">build.gradle</code> となります。<br />
2つありますが、<em>build.gradle (Project:MyApplication)</em> の方を使います。</p>

<p><img src="/AndroidTraining/assets/01-05/hello-gradle1.png" alt="project-tree" /></p>

<h3 id="hello-world">改めて、Hello world!</h3>
<p><code class="highlighter-rouge">build.gradle</code>を開き、既に記載されているものはそのままにしておき、末尾に以下を追記してください。</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">task</span> <span class="n">hello</span> <span class="o">{</span>
    <span class="n">doLast</span> <span class="o">{</span>
        <span class="n">println</span> <span class="s1">'Hello world!'</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="exec">実行</h3>

<p>編集を終えましたら、Android Studio 同梱の Terminal から以下のコマンドを実行してみてください。<br />
<code class="highlighter-rouge">hello</code>というタスクを実行するコマンドとなります。<br />
（Terminal は左下のランチャ or Tools &gt; Open Terminal より起動できます。馴染みのものでも構いません）</p>

<div class="highlighter-rouge"><pre class="highlight"><code># Mac OS X / Linux プラットフォームの場合。Windows の場合は、gradlew.batを使用してください
% ./gradlew -q hello
</code></pre>
</div>
<blockquote>
  <p>※ <code class="highlighter-rouge">-q</code> オプションは、Gradle のログメッセージを抑制し、引数で与えたタスクのみ、ログ出力を行います。<br />
　今回は練習なので、解りやすいようにこのオプションを利用しています。<br />
　（他のオプションは <a href="http://gradle.monochromeroad.com/docs/userguide/gradle_command_line.html">http://gradle.monochromeroad.com/docs/userguide/gradle_command_line.html</a> を参照してください）<br />
　<br />
　また、<code class="highlighter-rouge">gradlew</code>に実行権限がない場合は、<code class="highlighter-rouge">chmod +x gradlew</code>として、権限を付与して実行してみてください。</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code>Hello world!
</code></pre>
</div>
<p>と出力されたでしょうか。</p>

<p><img src="/AndroidTraining/assets/01-05/hello-gradle2.png" alt="project-tree" /></p>

<p>また、ショートカットを用いて、以下の様に記述することも可能です。</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">task</span> <span class="n">hello</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s1">'Hello world!'</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="syntax">記法</h3>
<p>記法の全てをここでは伝えませんが、基本的なものを紹介します。</p>

<h4 id="section-1">基本型</h4>
<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">task</span> <span class="n">hoge</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">fuga</span> <span class="o">=</span> <span class="s1">'fuga'</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">println</span> <span class="s1">'hoge'</span> <span class="o">+</span> <span class="n">fuga</span> <span class="o">+</span> <span class="s1">'piyo'</span>
	<span class="n">println</span> <span class="n">count</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span>
<span class="o">}</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>% ./gradlew -q hoge
hogefugapiyo
9

</code></pre>
</div>

<h4 id="section-2">繰り返し</h4>
<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">task</span> <span class="n">count</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
    <span class="mi">3</span><span class="o">.</span><span class="na">times</span> <span class="o">{</span>
        <span class="n">println</span> <span class="n">it</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>% ./gradlew -q count
0
1
2
</code></pre>
</div>

<h4 id="section-3">依存関係の記述</h4>
<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">task</span> <span class="n">unlockDoor</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s2">"I unlock the door"</span>
<span class="o">}</span>
<span class="n">task</span> <span class="nf">enterMyRoom</span><span class="o">(</span><span class="nl">dependsOn:</span> <span class="n">unlockDoor</span><span class="o">)</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s2">"I'm home"</span>
<span class="o">}</span>
<span class="n">task</span> <span class="nf">relax</span><span class="o">(</span><span class="nl">dependsOn:</span> <span class="n">enterMyRoom</span><span class="o">)</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s2">"Relax..."</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>% ./gradlew -q relax
I unlock the door
I'm home
Relax...

% ./gradlew -q enterMyRoom
I unlock the door
I'm home
</code></pre>
</div>

<p>依存関係のあるタスクが先に実行されていることがわかるかと思います。</p>

<p>それでは、順番を並び替えた以下を実行してください。</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">task</span> <span class="nf">enterMyRoom</span><span class="o">(</span><span class="nl">dependsOn:</span> <span class="n">unlockDoor</span><span class="o">)</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s2">"I'm home"</span>
<span class="o">}</span>
<span class="n">task</span> <span class="n">unlockDoor</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s2">"I unlock the door"</span>
<span class="o">}</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>% ./gradlew -q enterMyRoom
-&gt; ERROR!
</code></pre>
</div>

<p>エラーが起こって正常に実行できないようになったかと思います。
これは、未定義な <code class="highlighter-rouge">unlockDoor</code> を呼びだそうとする事により、起こるエラーです。</p>

<p>以下の様に、呼び出しを文字列にしてあげるだけで、遅延評価されるようになり、問題は起こらなくなります。</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">task</span> <span class="nf">enterMyRoom</span><span class="o">(</span><span class="nl">dependsOn:</span> <span class="s1">'unlockDoor'</span><span class="o">)</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s2">"I'm home"</span>
<span class="o">}</span>
<span class="n">task</span> <span class="n">unlockDoor</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s2">"I unlock the door"</span>
<span class="o">}</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>% ./gradlew -q enterMyRoom
I unlock the door
I'm home
</code></pre>
</div>

<p>また、task定義とは別に依存関係を記述することも可能です。</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">task</span> <span class="n">unlockDoor</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s2">"I unlock the door"</span>
<span class="o">}</span>
<span class="n">task</span> <span class="n">enterMyRoom</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s2">"I'm home"</span>
<span class="o">}</span>
<span class="n">task</span> <span class="n">relax</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s2">"Relax..."</span>
<span class="o">}</span>

<span class="n">unlockDoor</span><span class="o">.</span><span class="na">dependsOn</span> <span class="n">enterMyRoom</span>
<span class="n">relax</span><span class="o">.</span><span class="na">dependsOn</span> <span class="n">unlockDoor</span><span class="o">,</span> <span class="n">enterMyRoom</span>
</code></pre>
</div>

<h4 id="task">taskの前後に処理を差し込む</h4>
<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">task</span> <span class="n">sample</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
	<span class="n">println</span> <span class="s1">'hoge'</span>
<span class="o">}</span>
<span class="n">sample</span><span class="o">.</span><span class="na">doFirst</span> <span class="o">{</span>
	<span class="n">println</span> <span class="s1">'hello!'</span>
<span class="o">}</span>
<span class="n">sample</span><span class="o">.</span><span class="na">doLast</span> <span class="o">{</span>
	<span class="n">println</span> <span class="s1">'fuga'</span>
<span class="o">}</span>
<span class="n">sample</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>
	<span class="n">println</span> <span class="s1">'piyo'</span>
<span class="o">}</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>%  ./gradlew -q sample
hello! 
hoge
fuga
piyo
</code></pre>
</div>

<p><code class="highlighter-rouge">doFirst</code>, <code class="highlighter-rouge">doLast</code>（<code class="highlighter-rouge">&lt;&lt;</code>） を用いることで、タスクの前後に処理を追加することが可能です。<br />
複数の処理を同じ箇所に追加した場合は、定義された順番に実行されます。<br />
また、定義済み task は、上記の様にドットアクセスでタスクを記述できます。</p>

<h3 id="gradlew">gradlew</h3>
<p>上で<code class="highlighter-rouge">gradlew</code>（あるいは<code class="highlighter-rouge">gradlew.bat</code>）を用いてサンプルコードを実行していましたが、<code class="highlighter-rouge">gradlew</code>とはGradleラッパーといい、Gradleのビルド実行において推奨されている方法です。<br />
<code class="highlighter-rouge">gradlew</code>の実体はシェルスクリプトです。<br />
指定のバージョンのGradleをダウンロードし、それを用いてビルドを実行を行います。<br />
なので、<code class="highlighter-rouge">gradle</code>ではなく、<code class="highlighter-rouge">gradlew</code>を使うようにしておけば、環境に依存することがありません。</p>

<p>上記の観点より、<code class="highlighter-rouge">gradlew</code>をリポジトリに含めるようにしておいてください。<br />
そうすることで、CIや公開リポジトリなりで配布した際にもバージョン依存で悩む必要がなくなるはずです。</p>

<p>なお、<code class="highlighter-rouge">gradlew</code>には実行権限が必要なので、無ければ設定してください。</p>

<h2 id="gradle-in-as">Android Studio における Gradle</h2>

<p>Android Studio のパッケージには Gradle が同梱しておりますので、
インストールしてすぐ利用することが可能です。</p>

<h3 id="build-script">ビルドスクリプト</h3>
<p>例えば新規にMyApplicationという名前のプロジェクトを作成すると、以下の２つの <code class="highlighter-rouge">build.gradle</code> が生成されます。</p>

<ul>
  <li><code class="highlighter-rouge">build.gradle (Project: MyApplication)</code> =&gt; Project直下の build.gradle</li>
  <li><code class="highlighter-rouge">build.gradle (Module: app)</code> =&gt; app内の build.gradle</li>
</ul>

<p>それぞれについて簡単に説明したいと思います。</p>

<h4 id="project-gradle">Project直下のbuild.gradle</h4>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="c1">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span>

<span class="n">buildscript</span> <span class="o">{</span>
    <span class="n">repositories</span> <span class="o">{</span>
        <span class="n">jcenter</span><span class="o">()</span>
    <span class="o">}</span>
    <span class="n">dependencies</span> <span class="o">{</span>
        <span class="n">classpath</span> <span class="s1">'com.android.tools.build:gradle:2.1.2'</span>

        <span class="c1">// NOTE: Do not place your application dependencies here; they belong</span>
        <span class="c1">// in the individual module build.gradle files</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">allprojects</span> <span class="o">{</span>
    <span class="n">repositories</span> <span class="o">{</span>
        <span class="n">jcenter</span><span class="o">()</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">buildscript</code> / <code class="highlighter-rouge">allprojects</code> の <code class="highlighter-rouge">repositories</code> は、外部からインポートする jar のリポジトリを指定します。<br />
デフォルトで <code class="highlighter-rouge">jcenter()</code> が指定されています。<br />
これで事が足りるとは思いますが、明示的に他のリポジトリも参照したい場合は以下のように記載します。</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">buildscript</span> <span class="o">{</span>
    <span class="n">repositories</span> <span class="o">{</span>
        <span class="n">jcenter</span><span class="o">()</span>
        <span class="n">maven</span> <span class="o">{</span>
        	<span class="n">url</span> <span class="s2">"{TARGET_REPOSITORY_URL}"</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="o">...</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">dependencies</code>は依存関係を記述します。<br />
<strong>外部のライブラリを読み込みたい場合はここに記述します。</strong><br />
すると、自動的にプロジェクトの<code class="highlighter-rouge">External Libraries</code>に読み込まれます。</p>

<p>デフォルトの様に<code class="highlighter-rouge">mavenCentral()</code> にあるものであれば、パスのみで記述できます。<br />
また、リポジトリが無い jar を読み込みたい場合は、以下の様にします。<br />
lib 以下の jar ファイルを読み込む設定です。</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code>    <span class="n">dependencies</span> <span class="o">{</span>
        <span class="n">compile</span> <span class="nf">fileTree</span><span class="o">(</span><span class="nl">dir:</span><span class="s1">'libs'</span><span class="o">,</span> <span class="nl">include:</span> <span class="s1">'*.jar'</span><span class="o">)</span>
    <span class="o">}</span>
</code></pre>
</div>

<h4 id="app-gradle">app内のbuild.gradle</h4>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'com.android.application'</span>

<span class="n">android</span> <span class="o">{</span>
    <span class="n">compileSdkVersion</span> <span class="mi">21</span>
    <span class="n">buildToolsVersion</span> <span class="s2">"21.1.2"</span>

    <span class="n">defaultConfig</span> <span class="o">{</span>
        <span class="n">minSdkVersion</span> <span class="mi">15</span>
        <span class="n">targetSdkVersion</span> <span class="mi">21</span>
        <span class="n">versionCode</span> <span class="mi">1</span>
        <span class="n">versionName</span> <span class="s2">"1.0"</span>
    <span class="o">}</span>
    <span class="n">buildTypes</span> <span class="o">{</span>
        <span class="n">release</span> <span class="o">{</span>
            <span class="n">minifyEnabled</span> <span class="kc">false</span>
            <span class="n">proguardFiles</span> <span class="nf">getDefaultProguardFile</span><span class="o">(</span><span class="s1">'proguard-android.txt'</span><span class="o">),</span> <span class="s1">'proguard-rules.pro'</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="nf">fileTree</span><span class="o">(</span><span class="nl">dir:</span> <span class="s1">'libs'</span><span class="o">,</span> <span class="nl">include:</span> <span class="o">[</span><span class="s1">'*.jar'</span><span class="o">])</span>
    <span class="n">compile</span> <span class="s1">'com.android.support:appcompat-v7:21.0.3'</span>
<span class="o">}</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">apply plugin: 'com.android.application'</code>はAndroidのPluginを使う上での宣言です。</p>

<p><code class="highlighter-rouge">android</code>はビルドの情報を記載します。<br />
<code class="highlighter-rouge">defaultConfig</code>はデフォルトの設定を記載し、<br />
<code class="highlighter-rouge">buildTypes</code>はビルド毎の設定を記載します。</p>

<h3 id="structure">Android Studio の Project Structure との関係</h3>

<p><code class="highlighter-rouge">settings.gradle</code>というファイルを確認します。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>include ':app'
</code></pre>
</div>

<p>と書かれているものが<code class="highlighter-rouge">Project Structure</code> &gt; <code class="highlighter-rouge">Project Settings</code> &gt; <code class="highlighter-rouge">Modules</code>に表示されます。<br />
上記の例だと、<code class="highlighter-rouge">app</code>モジュールの設定が表示されます。</p>

<p>しかしながら、一部表示されないものがあったり、メリットは少ないので、<code class="highlighter-rouge">build.gradle</code>を編集することをおすすめします。</p>

<h2 id="more-infomation">More infomation</h2>
<p>Gradleの触りの部分を紹介しましたが、より理解を深めたい方は以下サイトを参照ください。</p>

<ul>
  <li><a href="http://www.gradle.org/documentation">Gradle Documentation</a>
    <ul>
      <li>邦訳：<a href="http://gradle.monochromeroad.com/docs/">Gradle 日本語ドキュメント</a></li>
    </ul>
  </li>
  <li><a href="http://www.gradle.org/docs/current/dsl/index.html">Gradle Build Language Reference</a>
    <ul>
      <li>邦訳：<a href="http://gradle.monochromeroad.com/docs/dsl/index.html">Gradleビルド言語リファレンス</a></li>
    </ul>
  </li>
  <li><a href="http://tools.android.com/tech-docs/new-build-system/user-guide">Gradle Plugin User Guide</a></li>
</ul>

          </section>
        </div>

        <!-- FOOTER  -->
        <!-- <div id="footer_wrap" class="outer">
          <footer class="inner">
  <p class="license">Portions of this page are reproduced from work created and <a href="https://code.google.com/p/android/">shared by the Android Open Source Project</a> and used according to terms described in the <a href="http://creativecommons.org/licenses/by/2.5/">Creative Commons2.5 Attribution License</a>.</p>
  <p class="license">
  This work is licensed under a <a rel="license" itemprop="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. 
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
  </p>
  <p class="copyright">Androidtraining maintained by <a href="https://github.com/mixi-inc" itemprop="author">mixi-inc</a></p>
  <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>

</footer>

        </div> -->
      </paper-scroll-header-panel>
    </paper-drawer-panel>
    <script>
        // custom transformation: scale header's title
        var title = document.querySelectorAll('.title')[2];
        addEventListener('paper-header-transform', function(e) {
            var d = e.detail;
            var m = d.height - d.condensedHeight;
            var scale = Math.max(0.75, (m - d.y) / (m / 0.25)  + 0.75);

            Polymer.Base.transform('scale(' + scale + ') translateZ(0)', title);
        });

    </script>
</body>
</html>
