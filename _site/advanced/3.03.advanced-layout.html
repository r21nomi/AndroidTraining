<!DOCTYPE html>
<html lang="ja">

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="この章では、レイアウトの作成に関してより発展的な内容を解説します。" />
    <meta name=viewport content="width=device-width, initial-scale=1">
    <!-- ogp for twitter -->
    <meta content="@mixi_engineers" name="twitter:site" />
    <meta content="summary" name="twitter:card" />
    
    <meta content="続・アプリのレイアウト作成 - mixi-inc/AndroidTraining" name="twitter:title" />
    
    <meta content="この章では、レイアウトの作成に関してより発展的な内容を解説します。" name="twitter:description" />
    <meta content="/assets/logo.png" name="twitter:image:src" />
    <!-- ogp -->
    <meta content="mixi-inc/AndroidTraining" property="og:site_name" />
    <meta content="article" property="og:type" />
    <meta content="/assets/logo.png" property="og:image" />
    
    <meta content="続・アプリのレイアウト作成 - mixi-inc/AndroidTraining" name="og:title" />
    
    <meta content="/advanced/3.03.advanced-layout.html" property="og:url" />
    <meta content="この章では、レイアウトの作成に関してより発展的な内容を解説します。" property="og:description" />
    
    <meta name="keyword" content="android, training, 基礎, スキル, 開発, developer, プログラミング, レイアウト, 画面, include" />
    

    <meta name="go-import" content="github.com/mixi-inc/AndroidTraining git https://github.com/mixi-inc/AndroidTraining.git">
    <script src="/AndroidTraining/bower_components/webcomponentsjs/webcomponents.js"></script>
    
    <link rel="stylesheet" type="text/css" media="screen" href="/AndroidTraining/stylesheets/main.css">
    <link rel="shortcut icon" href="/AndroidTraining/assets/favicon.ico" />
    <link rel="import" href="/AndroidTraining/bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-drawer-panel/paper-drawer-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-header-panel/paper-header-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-toolbar/paper-toolbar.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-menu/paper-menu.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-item/paper-item.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="/AndroidTraining/bower_components/iron-icons/iron-icons.html">
    <style is="custom-style">
        paper-scroll-header-panel:not([style-scope]):not(.style-scope) {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        paper-toolbar.tall .bottom:not([style-scope]):not(.style-scope) {
            font-size: 40px;
            margin-left: 60px;

            -webkit-transform-origin: left center;
            transform-origin: left center;
        }

        .content:not([style-scope]):not(.style-scope) {
            padding: 8px;
        }

        .spacer:not([style-scope]):not(.style-scope) {
            -ms-flex: 1 1 0.000000001px;
            -webkit-flex: 1;
            flex: 1;
            -webkit-flex-basis: 0.000000001px;
            flex-basis: 0.000000001px;
        }

    </style>
    <title>続・アプリのレイアウト作成 - mixi-inc/AndroidTraining</title>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-50931519-13', 'auto');
    ga('send', 'pageview');
    </script>
  </head>

  <body itemscope itemtype="http://schema.org/Article" fullbleed layout vertical>

    <paper-drawer-panel selected="main" >
      <!-- MENU -->
      <paper-header-panel mode="seamed" drawer class="drawer">
        <nav>
    <ol class="chapter_navigation">
        <a href="/AndroidTraining/">Home</a>
        <li>まえがき</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/introductions/1.01.about-android-os.html">Android-OSについて</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.02.prepare-for-development.html">開発環境の準備</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.03.create-project-for-android-studio.html">プロジェクトの作成</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.04.basic-knowledge.html">Androidの基礎知識</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.05.how-to-build-for-gradle.html">Android のビルドについて(Gradle)</a></li>
            
        </ol>
        <li>基礎編</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/fundamentals/2.01.create-layout.html">アプリのレイアウト作成</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.02.activity-and-fragment.html">ActivityとFragment</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.03.application-resource-management.html">アプリのリソース管理</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.04.messaging-and-notification.html">メッセージングと通知</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.05.actionbar-and-interaction-control.html">AppBarとインタラクション制御</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.06.listView-and-viewPager.html">ListViewとViewPager</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.07.serialize-and-collection-and-perpetuation.html">直列化とコレクション、永続化</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.08.async-processing.html">非同期処理</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.09.network-access.html">ネットワーク通信</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.10.database.html">データベース</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.11.testing-for-android-studio.html">テスト(AndroidStudio)</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.11.testing.html">テスト</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.12.handler-and-looper.html">HandlerとLooper</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.13.webView.html">WebView</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.14.accountmanager.html">AccountManager</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.15.advance-contentprovider.html">ContentProviderの発展</a></li>
            
        </ol>
        <li>実務編</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/advanced/3.01.build-for-eclipse.html">デバッグと自動ビルド(Eclipse)</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.01.build-for-gradle.html">自動ビルド(Android Studio)</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.02.architecture-and-di.html">アーキテクチャ設計と DI</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.03.advanced-layout.html">続・アプリのレイアウト作成</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.04.user-interface.html">ユーザインタフェース設計</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.05.security.html">セキュリティ</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.06.google-api.html">Google API</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.07.google-play-services.html">Google Play Services</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.08.cloud-sync.html">クラウド同期</a></li>
            
        </ol>
        <li>デザイナー編</li>
        <ol>
        </ol>
    </ol>
    <ol class="appex_navigation">
        <li>付録</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/appendix/A.01.import-from-git-for-eclipse.html">Git リポジトリからのプロジェクトのインポート</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.02.basic-java.html">Java の文法の基礎</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.03.how-to-create-avd.html">仮想デバイスの作成</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.04.advanced-java.html">Javaの活用</a></li>
            
        </ol>
    </ol>
</nav>

      </paper-header-panel>
      <paper-scroll-header-panel main condenses>
        <!-- HEADER -->
        <paper-toolbar class="mainheader tall" role="toolbar">
    <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>

    <span class="title"></span>

    <a id="forkme_banner" href="https://github.com/mixi-inc/AndroidTraining" role="button">
        <paper-icon-button src="/AndroidTraining/images/blacktocat.png"></paper-icon-button> <span>View on GitHub</span>
    </a>

    <div class="middle title">mixi-inc/AndroidTraining</div>
    <div class="bottom title">続・アプリのレイアウト作成</div>
</paper-toolbar>


<div id="description" itemprop="description">この章では、レイアウトの作成に関してより発展的な内容を解説します。</div>



        <!-- MAIN CONTENT -->
        <div id="main_content_wrap" class="content outer" itemprop="articleBody">
          <section id="main_content" class="inner">
            <p>参考：<a href="http://developer.android.com/training/improving-layouts/reusing-layouts.html">Re-using Layouts with <include></include> | Android Developers</a><br />
参考：<a href="http://developer.android.com/guide/topics/ui/dialogs.html">Dialogs | Android Developers</a><br />
参考：<a href="http://developer.android.com/guide/topics/ui/settings.html">Settings | Android Developers</a></p>

<h2 id="section">目次</h2>

<ul>
  <li><a href="#レイアウトのインクルード">レイアウトのインクルード</a>
    <ul>
      <li><a href="#`&lt;include&gt;`"><code class="highlighter-rouge">&lt;include&gt;</code></a></li>
      <li><a href="#`&lt;merge&gt;`"><code class="highlighter-rouge">&lt;merge&gt;</code></a></li>
    </ul>
  </li>
  <li><a href="#ダイアログ">ダイアログ</a>
    <ul>
      <li><a href="#ダイアログのデザイン">ダイアログのデザイン</a></li>
      <li><a href="#DialogFragment">DialogFragment</a></li>
    </ul>
  </li>
  <li><a href="#設定画面">設定</a>
    <ul>
      <li><a href="#設定情報を xml に定義">設定情報を xml に定義</a></li>
    </ul>
  </li>
</ul>

<h2 id="section-1">レイアウトのインクルード</h2>

<h3 id="include"><code class="highlighter-rouge">&lt;include&gt;</code></h3>
<p><code class="highlighter-rouge">&lt;include&gt;</code>タグは別のレイアウトxmlを挿入する機能を提供します。<br />
<code class="highlighter-rouge">&lt;include&gt;</code>を使用することでレイアウトを再利用でき、アプリのコンポーネントが共通化されUIが統一できます。また、修正する際のコストが下がります。レイアウトが複雑でコードが肥大化する場合は、コードの分割に使用することで可読性が向上し、レイアウトの管理や各コンポーネントの配置替えが容易になります。</p>

<p>button_pannel.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
    <span class="na">android:orientation=</span><span class="s">"horizontal"</span> <span class="nt">&gt;</span>

    <span class="nt">&lt;Button</span>
        <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_weight=</span><span class="s">"1"</span>
        <span class="na">android:text=</span><span class="s">"@string/button_1"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;Button</span>
        <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_weight=</span><span class="s">"1"</span>
        <span class="na">android:text=</span><span class="s">"@string/button_2"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;Button</span>
        <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_weight=</span><span class="s">"1"</span>
        <span class="na">android:text=</span><span class="s">"@string/button_3"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/LinearLayout&gt;</span>
</code></pre>
</div>
<p>include_main.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">android:orientation=</span><span class="s">"vertical"</span>
    <span class="na">tools:context=</span><span class="s">".MainActivity"</span> <span class="nt">&gt;</span>

    <span class="nt">&lt;TextView</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"0dp"</span>
        <span class="na">android:layout_weight=</span><span class="s">"1"</span>
        <span class="na">android:text=</span><span class="s">"@string/include_sample"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- 別のレイアウトファイルを挿入 --&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">layout=</span><span class="s">"@layout/button_pannel"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/LinearLayout&gt;</span>
</code></pre>
</div>
<p><img src="/AndroidTraining/assets/03-03/include_sample.png" alt="include_sample" /></p>

<p><code class="highlighter-rouge">&lt;include&gt;</code>には<code class="highlighter-rouge">android:id</code>を設定することができるので、同じレイアウトを include しても個別に管理することができます。</p>

<h3 id="merge"><code class="highlighter-rouge">&lt;merge&gt;</code></h3>
<p><code class="highlighter-rouge">&lt;merge&gt;</code>タグはレイアウトを合わせる機能を提供します。</p>

<p>通常レイアウトファイルは Viewgroup をルートViewとして配置していますが、<code class="highlighter-rouge">&lt;merge&gt;</code>タグに置き換えることができます。<br />
置き換えたレイアウトを include すると<code class="highlighter-rouge">&lt;merge&gt;</code>タグは無視され、内部のレイアウトが include 先のレイアウトに直接とりこまれることになります。ViewGroup を取り除くことができるため、View の階層が1つ浅くなり描画コストが減ることになります。  　　</p>

<p>merge適用前のレイアウト:button_no_apply_merge.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;FrameLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span> <span class="nt">&gt;</span>

    <span class="nt">&lt;Button</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:text=</span><span class="s">"@string/button_1"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/FrameLayout&gt;</span>
</code></pre>
</div>

<p>merge適用後のレイアウト:button_apply_merge.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;merge</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span> <span class="nt">&gt;</span>

    <span class="nt">&lt;Button</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:text=</span><span class="s">"@string/button_1"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/merge&gt;</span>
</code></pre>
</div>

<p>merge_main.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">android:orientation=</span><span class="s">"vertical"</span>
    <span class="na">tools:context=</span><span class="s">".MainActivity"</span> <span class="nt">&gt;</span>

    <span class="nt">&lt;TextView</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"0dp"</span>
        <span class="na">android:layout_weight=</span><span class="s">"1"</span>
        <span class="na">android:text=</span><span class="s">"@string/merge_sample"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- マージされたレイアウトファイルを挿入 --&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">layout=</span><span class="s">"@layout/button_apply_merge"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/LinearLayout&gt;</span>
</code></pre>
</div>

<p><img src="/AndroidTraining/assets/03-03/merge_sample.png" alt="merge_sample" /></p>

<p>上記レイアウトをそれぞれ実行し、Hierarchy View でレイアウト階層を確認すると以下のようになり、FrameLayoutが取り除かれているのがわかります。<br />
<img src="/AndroidTraining/assets/03-03/merge_no_apply_sample.png" alt="merge_no_apply_sample" /> merge前<br />
<img src="/AndroidTraining/assets/03-03/merge_apply_sample.png" alt="merge_apply_sample" /> merge後</p>

<h2 id="dialog">Dialog</h2>

<p>Dialog はユーザーに意思決定や情報の入力を促すための小さいウィンドウです。<br />
画面いっぱいに表示するものではなく、何らかの処理を行う前にユーザーへアクションを要求するのに使用します。</p>

<p>この他、進捗状況を知らせる為にも Dialog が使われます。</p>

<p>Dialog の表示には DialogFragment を使用することが推奨されています。
DialogFragment は Android 3.0 から使用出来る機能ですが、Support Library で提供されているため Android 2.x系でも使用することができます。</p>

<h3 id="dialog-">Dialog のデザイン</h3>

<p>ユーザへ意思決定を求める Dialog を、AlertDialog と言います。<br />
AlertDialog の構成は以下のようになっています。</p>

<p><img src="/AndroidTraining/assets/03-03/dialogs_regions.png" alt="dialogs_regions" /><br />
1. タイトルです。必須ではなくコンテンツ領域が詳細なメッセージなどで埋められている場合などに使用します。<br />
2. コンテンツ領域です。メッセージを表示します。また、独自のレイアウトに変更することもできます。<br />
3. アクションボタンです。ボタンの数は3つ以下とします。</p>

<p>一方、進捗状況を知らせる Dialog を、ProgressDialog と言います。</p>

<p>それぞれ、Dialog を表示すると、表示領域外がグレーアウトします。<br />
このグレーアウトした領域をタップすると、キャンセル扱いとすることができるようになっています。</p>

<h3 id="fragmentdialog-">FragmentDialog の</h3>

<p>以下の手順が必要となります。</p>

<ol>
  <li>DialogFragment を作成</li>
  <li>コンテンツ領域に独自レイアウトを使用するなら作成</li>
  <li>Dialog の表示処理を行う</li>
</ol>

<h4 id="dialog--1">通常の Dialog を表示する</h4>

<p>独自のDialogFragment</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="cm">/**
     * Dialogを使用して、コンテンツ領域に独自レイアウトは表示するサンプルです。
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyDialogFragment</span> <span class="kd">extends</span> <span class="n">DialogFragment</span> <span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">View</span> <span class="nf">onCreateView</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 独自のレイアウトをコンテンツ領域表示する場合、ここでViewをinfrateして返却する</span>
            <span class="k">return</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">dialog_content</span><span class="o">,</span> <span class="n">container</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Dialog</span> <span class="nf">onCreateDialog</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Dialogを生成</span>
            <span class="n">Dialog</span> <span class="n">dialog</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">onCreateDialog</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
            <span class="c1">// タイトルを設定</span>
            <span class="n">dialog</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">my_dialog_fragment</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">dialog</span><span class="o">;</span>
        <span class="o">}</span>

    <span class="o">}</span>
</code></pre>
</div>

<p>コンテンツ領域に表示する独自レイアウト : dialog_content.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;RelativeLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">android:paddingBottom=</span><span class="s">"@dimen/activity_vertical_margin"</span>
    <span class="na">android:paddingLeft=</span><span class="s">"@dimen/activity_horizontal_margin"</span>
    <span class="na">android:paddingRight=</span><span class="s">"@dimen/activity_horizontal_margin"</span>
    <span class="na">android:paddingTop=</span><span class="s">"@dimen/activity_vertical_margin"</span>
    <span class="na">tools:context=</span><span class="s">".MainActivity"</span> <span class="nt">&gt;</span>

    <span class="nt">&lt;ImageView</span>
        <span class="na">android:id=</span><span class="s">"@+id/imageView1"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_alignParentLeft=</span><span class="s">"true"</span>
        <span class="na">android:layout_alignParentTop=</span><span class="s">"true"</span>
        <span class="na">android:src=</span><span class="s">"@drawable/ic_launcher"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;TextView</span>
        <span class="na">android:id=</span><span class="s">"@+id/textView1"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_alignTop=</span><span class="s">"@+id/imageView1"</span>
        <span class="na">android:layout_marginLeft=</span><span class="s">"17dp"</span>
        <span class="na">android:layout_marginTop=</span><span class="s">"15dp"</span>
        <span class="na">android:layout_toRightOf=</span><span class="s">"@+id/imageView1"</span>
        <span class="na">android:text=</span><span class="s">"@string/custom_content"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/RelativeLayout&gt;</span>
</code></pre>
</div>

<p>ダイアログの表示<br />
MainActivity.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>        <span class="n">DialogFragment</span> <span class="n">myDialogFragment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyDialogFragment</span><span class="o">();</span>
        <span class="c1">// 引数にFramentManagerとtagを設定します</span>
        <span class="n">myDialogFragment</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="n">getSupportFragmentManager</span><span class="o">(),</span> <span class="s">"my_dialog_fragment"</span><span class="o">);</span>
</code></pre>
</div>
<p><img src="/AndroidTraining/assets/03-03/dialog_sample.png" alt="dialog_sample" /></p>

<h4 id="alertdialog-">AlertDialog を表示する</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>   <span class="cm">/**
     * AlertDialogを使用するサンプルです。コンテンツ領域に独自レイアウトは表示しません。
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyAlertDialogFragment</span> <span class="kd">extends</span> <span class="n">DialogFragment</span> <span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Dialog</span> <span class="nf">onCreateDialog</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>

            <span class="c1">// AlertDialogはBuilderパターンで生成</span>
            <span class="n">AlertDialog</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AlertDialog</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">getActivity</span><span class="o">());</span>

            <span class="n">builder</span><span class="o">.</span><span class="na">setMessage</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">alert_dialog_message</span><span class="o">)</span>
                    <span class="c1">// OKボタン</span>
                    <span class="o">.</span><span class="na">setPositiveButton</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">ok</span><span class="o">,</span> <span class="k">new</span> <span class="n">DialogInterface</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
                        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">DialogInterface</span> <span class="n">dialog</span><span class="o">,</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span> <span class="s">"Positive"</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                        <span class="o">}</span>
                    <span class="o">})</span>
                    <span class="c1">// Cancelボタン</span>
                    <span class="o">.</span><span class="na">setNegativeButton</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">cancel</span><span class="o">,</span> <span class="k">new</span> <span class="n">DialogInterface</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
                        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">DialogInterface</span> <span class="n">dialog</span><span class="o">,</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span> <span class="s">"Negative"</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                        <span class="o">}</span>
                    <span class="o">});</span>
            <span class="c1">// Dialogを作成して返却</span>
            <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre>
</div>
<p><img src="/AndroidTraining/assets/03-03/alertdialog_sample.png" alt="alertdialog_sample" /></p>

<h4 id="alertdialog--1">AlertDialog を表示する際の注意点</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>   <span class="cm">/**
     * AlertDialogを使用しつつ、コンテンツ領域に独自レイアウトを表示するサンプルです。
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ErrorMyAlertDialogFragment</span> <span class="kd">extends</span> <span class="n">DialogFragment</span> <span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">View</span> <span class="nf">onCreateView</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Dialogと同じように表示したいコンテンツをinfrateして返却するとクラッシュします。</span>
            <span class="k">return</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">dialog_content</span><span class="o">,</span> <span class="n">container</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Dialog</span> <span class="nf">onCreateDialog</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">AlertDialog</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AlertDialog</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">getActivity</span><span class="o">());</span>
            <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
        <span class="o">}</span>

    <span class="o">}</span>
</code></pre>
</div>
<p>onCreateDialog() で Dialog オブジェクトを返却する場合、onCreateView() でコンテンツ View を返却しようとするとクラッシュしてしまいます。<br />
回避するには onCreateView() で <code class="highlighter-rouge">null</code> を返却するか、onCreateView() をオーバライドしないようにします。<br />
代わりに、コンテンツ View は builder の setView メソッドで設定します。</p>

<h2 id="section-2">設定画面</h2>

<p>設定画面を作成する場合、他のアプリケーションとUI/UXの整合性がとれたインターフェースを提供する必要があります。<br />
Android では設定画面に共通なUI/UXを提供できるようにするために Preference APIs が用意されています。Preference APIs を使用することで他のアプリケーションとの設定画面のUI/UXを統一することができます。<br />
また、設定画面で変更されたデータは自動的に SharedPreferences に保存されます。<br />
そのため、設定情報の保存処理を自身で実装する必要がなくなります。</p>

<p>設定画面を作成するには以下の手順が必要となります。<br />
1. 設定画面に表示する情報を xml に定義<br />
2. 表示する PreferenceActivity または PreferenceFragment を作成</p>

<h3 id="xml-">設定情報を xml に定義</h3>

<h4 id="xml--1">xml の保存先</h4>

<ul>
  <li>xml ファイルはres/xmlディレクトリに格納する必要があります。</li>
  <li>ファイル名は任意で決めることができますが、一般的にpreferences.xmlとすると良いです。</li>
  <li>マルチペインのレイアウトを作成した場合は、Fragment毎に個別のxmlファイルが必要です。</li>
</ul>

<h4 id="xml">xmlの定義</h4>

<p>xml ファイルのルートタグは<code class="highlighter-rouge">&lt;PreferenceScreen&gt;</code> とします。
<code class="highlighter-rouge">&lt;PreferenceScreen&gt;</code> に追加された子要素（<code class="highlighter-rouge">CheckBoxPreference</code>、<code class="highlighter-rouge">ListPreference</code>、<code class="highlighter-rouge">EditTextPreference</code>）は、設定画面の内の1つの項目として表示されます。
また、<code class="highlighter-rouge">&lt;PreferenceScreen&gt;</code>内に<code class="highlighter-rouge">&lt;PreferenceScreen&gt;</code>を配置することも可能です。</p>

<p>res/xml/preferences.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;PreferenceScreen</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span> <span class="nt">&gt;</span>

    <span class="nt">&lt;CheckBoxPreference</span>
        <span class="na">android:defaultValue=</span><span class="s">"true"</span>
        <span class="na">android:key=</span><span class="s">"sample_checkbox_key"</span>
        <span class="na">android:summary=</span><span class="s">"サンプルです"</span>
        <span class="na">android:title=</span><span class="s">"チェックボックスのサンプル"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;ListPreference</span>
        <span class="na">android:defaultValue=</span><span class="s">"1"</span>
        <span class="na">android:dependency=</span><span class="s">"sample_checkbox_key"</span>
        <span class="na">android:dialogTitle=</span><span class="s">"リスト選択ダイアログ"</span>
        <span class="na">android:entries=</span><span class="s">"@array/item_entries"</span>
        <span class="na">android:entryValues=</span><span class="s">"@array/item_entries_value"</span>
        <span class="na">android:key=</span><span class="s">"sample_list_key"</span>
        <span class="na">android:title=</span><span class="s">"リストのサンプル"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;EditTextPreference</span>
        <span class="na">android:dialogTitle=</span><span class="s">"エディットテキストダイアログ"</span>
        <span class="na">android:key=</span><span class="s">"edit_texit_key"</span>
        <span class="na">android:title=</span><span class="s">"エディットテキストのサンプル"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/PreferenceScreen&gt;</span>
</code></pre>
</div>
<p>res/values/array.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;resources&gt;</span>

    <span class="nt">&lt;string-array</span> <span class="na">name=</span><span class="s">"item_entries"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;item&gt;</span>アイテム1<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;item&gt;</span>アイテム2<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;item&gt;</span>アイテム3<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;/string-array&gt;</span>

    <span class="nt">&lt;string-array</span> <span class="na">name=</span><span class="s">"item_entries_value"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;item&gt;</span>one<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;item&gt;</span>two<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;item&gt;</span>three<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;/string-array&gt;</span>

<span class="nt">&lt;/resources&gt;</span>
</code></pre>
</div>
<p><img src="/AndroidTraining/assets/03-03/preference_sample.png" alt="preference_sample" /></p>

<table>
  <thead>
    <tr>
      <th>名前</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>android:key</td>
      <td>SharedPreferences に保存する際に使用するキーとなります。要素が PreferenceCategory か PreferenceScreen かintentの呼び出し設定がされている場合は必須ではありません。</td>
    </tr>
    <tr>
      <td>android:title</td>
      <td>設定画面に表示するタイトルです</td>
    </tr>
    <tr>
      <td>android:defaultValue</td>
      <td>システムに SharedPreferences へ初期値を設定するように指定します</td>
    </tr>
    <tr>
      <td>android:entries</td>
      <td><code class="highlighter-rouge">ListPreference</code>で表示するデータリスト</td>
    </tr>
    <tr>
      <td>android:entryValues</td>
      <td><code class="highlighter-rouge">ListPreference</code>で選択したときに保存される値。android:entries と key-value な関係となります</td>
    </tr>
    <tr>
      <td>android:dependency</td>
      <td>他のpreferenceのandroid:keyを設定します。設定したpreferenceが未設定またはOFFの場合はdisableとなります。</td>
    </tr>
  </tbody>
</table>

<h5 id="section-3">グループの作成</h5>

<p>設定項目がいくつもあった場合、ユーザーは設定したい項目がどこにあるのか見つけるのに苦労してしまいます。<br />
<code class="highlighter-rouge">PreferenceCategory</code>を使用することにより設定項目を関連するものどうしで分けることができ、表示をわかりやすくできます。<br />
res/xml/preferences_category.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;PreferenceScreen</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span> <span class="nt">&gt;</span>

    <span class="c">&lt;!-- グループ分けされます --&gt;</span>
    <span class="nt">&lt;PreferenceCategory</span>
        <span class="na">android:key=</span><span class="s">"pref_key_storage_settings"</span>
        <span class="na">android:title=</span><span class="s">"カテゴリ1"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;CheckBoxPreference</span>
            <span class="na">android:key=</span><span class="s">"category1_checkbox1_key"</span>
            <span class="na">android:title=</span><span class="s">"カテゴリ1チェックボックス1"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;CheckBoxPreference</span>
            <span class="na">android:key=</span><span class="s">"category1_checkbox2_key"</span>
            <span class="na">android:title=</span><span class="s">"カテゴリ1チェックボックス2"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/PreferenceCategory&gt;</span>

    <span class="c">&lt;!-- グループ分けされます --&gt;</span>
    <span class="nt">&lt;PreferenceCategory</span>
        <span class="na">android:key=</span><span class="s">"pref_key_storage_settings"</span>
        <span class="na">android:title=</span><span class="s">"カテゴリ2"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;CheckBoxPreference</span>
            <span class="na">android:key=</span><span class="s">"category2_checkbox1_key"</span>
            <span class="na">android:title=</span><span class="s">"カテゴリ2チェックボックス1"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/PreferenceCategory&gt;</span>

<span class="nt">&lt;/PreferenceScreen&gt;</span>
</code></pre>
</div>
<p><img src="/AndroidTraining/assets/03-03/preference_category.png" alt="preference_category" /></p>

<h5 id="section-4">サブスクリーンの作成</h5>

<p>グループとは別に<code class="highlighter-rouge">PreferenceScreen</code>内に<code class="highlighter-rouge">PreferenceScreen</code>を配置することで、サブスクリーンを作成して階層的に表示することができます。<br />
res/xml/preferences_subscreen.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;PreferenceScreen</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span> <span class="nt">&gt;</span>

    <span class="c">&lt;!-- 別階層になります --&gt;</span>
    <span class="nt">&lt;PreferenceScreen</span>
        <span class="na">android:key=</span><span class="s">"subscreen_key"</span>
        <span class="na">android:title=</span><span class="s">"サブスクリーン"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;CheckBoxPreference</span>
            <span class="na">android:key=</span><span class="s">"subscreen_checkbox1_key"</span>
            <span class="na">android:title=</span><span class="s">"サブスクリーンチェックボックス1"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;CheckBoxPreference</span>
            <span class="na">android:key=</span><span class="s">"subscreen_checkbox2_key"</span>
            <span class="na">android:title=</span><span class="s">"サブスクリーンチェックボックス2"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/PreferenceScreen&gt;</span>

    <span class="nt">&lt;CheckBoxPreference</span>
        <span class="na">android:key=</span><span class="s">"screen_checkbox1_key"</span>
        <span class="na">android:title=</span><span class="s">"チェックボックス1"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/PreferenceScreen&gt;</span>
</code></pre>
</div>
<p><img src="/AndroidTraining/assets/03-03/preference_subscreen_1.png" alt="preference_subscreen_1" />　
<img src="/AndroidTraining/assets/03-03/preference_subscreen_2.png" alt="preference_subscreen_2" /></p>

<h5 id="intent">Intentを使用する</h5>

<p>設定画面の変わりに、別のActivityやWebページを表示することができます。<br />
res/xml/preferences_intent.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;PreferenceScreen</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span> <span class="nt">&gt;</span>

    <span class="c">&lt;!-- Web表示 --&gt;</span>
    <span class="nt">&lt;Preference</span> <span class="na">android:title=</span><span class="s">"Intent Web"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;intent</span>
            <span class="na">android:action=</span><span class="s">"android.intent.action.VIEW"</span>
            <span class="na">android:data=</span><span class="s">"http://mixi.jp/"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/Preference&gt;</span>

    <span class="c">&lt;!-- Activityを起動 --&gt;</span>
    <span class="nt">&lt;Preference</span> <span class="na">android:title=</span><span class="s">"Intent Activity"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;intent</span>
            <span class="na">android:targetClass=</span><span class="s">"jp.mixi.sample.preference.SubActivity"</span>
            <span class="na">android:targetPackage=</span><span class="s">"jp.mixi.sample.preference"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/Preference&gt;</span>

<span class="nt">&lt;/PreferenceScreen&gt;</span>
</code></pre>
</div>
<p><img src="/AndroidTraining/assets/03-03/preference_intent.png" alt="preference_intent" /></p>

<h4 id="preferenceactivity--preferencefragment">PreferenceActivity と PreferenceFragment</h4>
<p>設定画面を表示するためには PreferenceActivity を継承した Acitivity を作成し、使用します。<br />
PreferenceActivity は設定が更新されると自動的に SharedPreferences に値を保存します。</p>

<p>アプリケーションのターゲットをAndroid3.0以降のものみとする場合はPreferenceFragmentを使用することが推奨されています。</p>

<h5 id="preferenceactivity-">PreferenceActivity の使い方</h5>
<p>onCreate() 内で addPreferencesFromResource() の引数として表示する設定ファイルを渡します。<br />
SettingsActivity.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SettingsActivity</span> <span class="kd">extends</span> <span class="n">PreferenceActivity</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

        <span class="n">addPreferencesFromResource</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">preferences</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<h5 id="preferencefragment-">PreferenceFragment の使い方</h5>
<p>Fragment の onCreate() 内で addPreferencesFromResource() の引数として表示する設定ファイルを渡し、
Activity で Fragment を追加して表示します。<br />
SettingsActivity2.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SettingsActivity2</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

        <span class="c1">// ActivityにFragmentを追加</span>
        <span class="n">getFragmentManager</span><span class="o">().</span><span class="na">beginTransaction</span><span class="o">()</span>
                <span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">content</span><span class="o">,</span> <span class="k">new</span> <span class="n">SettingsFragment</span><span class="o">())</span>
                <span class="o">.</span><span class="na">commit</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SettingsFragment</span> <span class="kd">extends</span> <span class="n">PreferenceFragment</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

            <span class="n">addPreferencesFromResource</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">preferences</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<h5 id="section-5">設定変更時のコールバック</h5>
<p>設定情報が変更されたときのコールバックメソッドが提供されています。<br />
コールバックメソッドを使用することで、変更時に設定情報のサマリーを一緒に変更するといったことが可能となります。<br />
SettingsActivity3.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 * 設定変更時のコールバックサンプルです。
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SettingsActivity3</span> <span class="kd">extends</span> <span class="n">PreferenceActivity</span> <span class="kd">implements</span> <span class="n">OnSharedPreferenceChangeListener</span> <span class="o">{</span>

    <span class="c1">// EditTextPreference で使用しているkey</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EDIT_TEXT_KEY</span> <span class="o">=</span> <span class="s">"edit_texit_key"</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

        <span class="n">addPreferencesFromResource</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">preferences</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSharedPreferenceChanged</span><span class="o">(</span><span class="n">SharedPreferences</span> <span class="n">sharedPreferences</span><span class="o">,</span> <span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 処理対象のPreferenceかをkeyで判定</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">EDIT_TEXT_KEY</span><span class="o">))</span> <span class="o">{</span>
            <span class="c1">// keyからPreferenceのインスタンスを取得</span>
            <span class="n">EditTextPreference</span> <span class="n">editPref</span> <span class="o">=</span> <span class="o">(</span><span class="n">EditTextPreference</span><span class="o">)</span> <span class="n">findPreference</span><span class="o">(</span><span class="n">EDIT_TEXT_KEY</span><span class="o">);</span>
            <span class="c1">// Preferenceのサマリーを変更</span>
            <span class="n">editPref</span><span class="o">.</span><span class="na">setSummary</span><span class="o">(</span><span class="n">editPref</span><span class="o">.</span><span class="na">getText</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
        <span class="c1">// リスナーを登録</span>
        <span class="n">getPreferenceScreen</span><span class="o">().</span><span class="na">getSharedPreferences</span><span class="o">()</span>
                <span class="o">.</span><span class="na">registerOnSharedPreferenceChangeListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
        <span class="c1">// リスナーを登録解除</span>
        <span class="n">getPreferenceScreen</span><span class="o">().</span><span class="na">getSharedPreferences</span><span class="o">()</span>
                <span class="o">.</span><span class="na">unregisterOnSharedPreferenceChangeListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<h2 id="section-6">実習・課題</h2>

<h3 id="include-1">include</h3>
<ol>
  <li>(実習)  include を使用したレイアウトを作成し、merge の有り無しで View の階層がどのようになるのかを Hierarchy View で確認してレポートしてください。</li>
</ol>

<h3 id="dialog-1">Dialog</h3>
<ol>
  <li>(実習) 下記の画像のような Dialog を表示してください。
    <ul>
      <li><a href="/AndroidTraining/assets/03-03/dialog_practice.png">DialogPractice のスクリーンショット</a></li>
    </ul>
  </li>
  <li>(実習) DialogPractice2 のプロジェクトに、Activity と Fragment が配置されています。TODO コメントの指示通りのプログラムを記述してください。</li>
  <li>(課題) 下記の画像のような Dialog を表示してください。
    <ul>
      <li><a href="/AndroidTraining/assets/03-03/dialog_assignment.png">DialogAssignment のスクリーンショット</a><br />
OKボタンを押した時は入力した情報を SharedPreferences に保存するように実装してください。</li>
    </ul>
  </li>
</ol>

<h3 id="section-7">設定画面</h3>
<ol>
  <li>(実習)  下記の画像のような設定画面を実装してください。
    <ul>
      <li><a href="/AndroidTraining/assets/03-03/preference_practice_1.png">PreferencePractice のスクリーンショット1</a></li>
      <li><a href="/AndroidTraining/assets/03-03/preference_practice_2.png">PreferencePractice のスクリーンショット2</a><br />
「自動同期の間隔」は「連絡先の同期設定」がONの場合のみ有効にしてください。<br />
「自動同期の間隔」は変更内容を Summary に反映させてください。</li>
    </ul>
  </li>
</ol>


          </section>
        </div>

        <!-- FOOTER  -->
        <div id="footer_wrap" class="outer">
          <footer class="inner">
  <p class="license">Portions of this page are reproduced from work created and <a href="https://code.google.com/p/android/">shared by the Android Open Source Project</a> and used according to terms described in the <a href="http://creativecommons.org/licenses/by/2.5/">Creative Commons2.5 Attribution License</a>.</p>
  <p class="license">
  This work is licensed under a <a rel="license" itemprop="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. 
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
  </p>
  <p class="copyright">Androidtraining maintained by <a href="https://github.com/mixi-inc" itemprop="author">mixi-inc</a></p>
  <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>

</footer>

        </div>
      </paper-scroll-header-panel>
    </paper-drawer-panel>
    <script>
        // custom transformation: scale header's title
        var title = document.querySelectorAll('.title')[2];
        addEventListener('paper-header-transform', function(e) {
            var d = e.detail;
            var m = d.height - d.condensedHeight;
            var scale = Math.max(0.75, (m - d.y) / (m / 0.25)  + 0.75);

            Polymer.Base.transform('scale(' + scale + ') translateZ(0)', title);
        });

    </script>
</body>
</html>
