<!DOCTYPE html>
<html lang="ja">

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="この章では、Android 向けの直列化とコレクション、永続化について解説します。" />
    <meta name=viewport content="width=device-width, initial-scale=1">
    <!-- ogp for twitter -->
    <meta content="@mixi_engineers" name="twitter:site" />
    <meta content="summary" name="twitter:card" />
    
    <meta content="直列化とコレクション、永続化 - mixi-inc/AndroidTraining" name="twitter:title" />
    
    <meta content="この章では、Android 向けの直列化とコレクション、永続化について解説します。" name="twitter:description" />
    <meta content="/assets/logo.png" name="twitter:image:src" />
    <!-- ogp -->
    <meta content="mixi-inc/AndroidTraining" property="og:site_name" />
    <meta content="article" property="og:type" />
    <meta content="/assets/logo.png" property="og:image" />
    
    <meta content="直列化とコレクション、永続化 - mixi-inc/AndroidTraining" name="og:title" />
    
    <meta content="/fundamentals/2.07.serialize-and-collection-and-perpetuation.html" property="og:url" />
    <meta content="この章では、Android 向けの直列化とコレクション、永続化について解説します。" property="og:description" />
    
    <meta name="keyword" content="android, training, 基礎, スキル, 開発, プログラミング, Bundle, Parcelable, SharedPreferences, 永続化" />
    

    <meta name="go-import" content="github.com/mixi-inc/AndroidTraining git https://github.com/mixi-inc/AndroidTraining.git">
    <script src="/AndroidTraining/bower_components/webcomponentsjs/webcomponents.js"></script>

    <link rel="stylesheet" type="text/css" media="screen" href="/AndroidTraining/stylesheets/main.css">
    <link rel="shortcut icon" href="/AndroidTraining/assets/favicon.ico" />
    <link rel="import" href="/AndroidTraining/bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-drawer-panel/paper-drawer-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-header-panel/paper-header-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-toolbar/paper-toolbar.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-menu/paper-menu.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-item/paper-item.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="/AndroidTraining/bower_components/iron-icons/iron-icons.html">
    <style is="custom-style">
        paper-scroll-header-panel:not([style-scope]):not(.style-scope) {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        paper-toolbar.tall .bottom:not([style-scope]):not(.style-scope) {
            font-size: 40px;
            margin-left: 60px;

            -webkit-transform-origin: left center;
            transform-origin: left center;
        }

        .content:not([style-scope]):not(.style-scope) {
            padding: 8px;
        }

        .spacer:not([style-scope]):not(.style-scope) {
            -ms-flex: 1 1 0.000000001px;
            -webkit-flex: 1;
            flex: 1;
            -webkit-flex-basis: 0.000000001px;
            flex-basis: 0.000000001px;
        }

    </style>
    <title>直列化とコレクション、永続化 - mixi-inc/AndroidTraining</title>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-50931519-13', 'auto');
    ga('send', 'pageview');
    </script>
  </head>

  <body itemscope itemtype="http://schema.org/Article" fullbleed layout vertical>

    <paper-drawer-panel selected="main" >
      <!-- MENU -->
      <paper-header-panel mode="seamed" drawer class="drawer">
        <nav>
    <ol class="chapter_navigation">
        <a href="/AndroidTraining/">Home</a>
        <li>まえがき</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/introductions/1.01.about-android-os.html">Android-OSについて</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.02.prepare-for-development.html">開発環境の準備</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.03.create-project-for-android-studio.html">プロジェクトの作成</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.04.basic-knowledge.html">Androidの基礎知識</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.05.how-to-build-for-gradle.html">Android のビルドについて(Gradle)</a></li>
            
        </ol>
        <li>基礎編</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/fundamentals/2.01.create-layout.html">アプリのレイアウト作成</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.02.activity-and-fragment.html">ActivityとFragment</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.03.application-resource-management.html">アプリのリソース管理</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.04.messaging-and-notification.html">メッセージングと通知</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.05.actionbar-and-interaction-control.html">AppBarとインタラクション制御</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.06.listView-and-viewPager.html">RecyclerViewとViewPager</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.07.serialize-and-collection-and-perpetuation.html">直列化とコレクション、永続化</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.08.async-processing.html">非同期処理</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.09.network-access.html">ネットワーク通信</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.10.database.html">データベース</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.11.testing-for-android-studio.html">テスト(AndroidStudio)</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.11.testing.html">テスト</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.12.handler-and-looper.html">HandlerとLooper</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.13.webView.html">WebView</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.14.accountmanager.html">AccountManager</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.15.advance-contentprovider.html">ContentProviderの発展</a></li>
            
        </ol>
        <li>実務編</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/advanced/3.01.build-for-eclipse.html">デバッグと自動ビルド(Eclipse)</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.01.build-for-gradle.html">自動ビルド(Android Studio)</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.02.architecture-and-di.html">アーキテクチャ設計と DI</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.03.advanced-layout.html">続・アプリのレイアウト作成</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.04.user-interface.html">ユーザインタフェース設計</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.05.security.html">セキュリティ</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.06.google-api.html">Google API</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.07.google-play-services.html">Google Play Services</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.08.cloud-sync.html">クラウド同期</a></li>
            
        </ol>
        <li>デザイナー編</li>
        <ol>
        </ol>
    </ol>
    <ol class="appex_navigation">
        <li>付録</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/appendix/A.01.import-from-git-for-eclipse.html">Git リポジトリからのプロジェクトのインポート</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.02.basic-java.html">Java の文法の基礎</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.03.how-to-create-avd.html">仮想デバイスの作成</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.04.advanced-java.html">Javaの活用</a></li>
            
        </ol>
    </ol>
</nav>

      </paper-header-panel>
      <paper-scroll-header-panel main condenses>
        <!-- HEADER -->
        <paper-toolbar class="mainheader tall" role="toolbar">
    <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>

    <span class="title"></span>

    <a id="forkme_banner" href="https://github.com/mixi-inc/AndroidTraining" role="button">
        <paper-icon-button src="/AndroidTraining/images/blacktocat.png"></paper-icon-button> <span>View on GitHub</span>
    </a>

    <div class="middle title">mixi-inc/AndroidTraining</div>
    <div class="bottom title">直列化とコレクション、永続化</div>
</paper-toolbar>


<div id="description" itemprop="description">この章では、Android 向けの直列化とコレクション、永続化について解説します。</div>



        <!-- MAIN CONTENT -->
        <div id="main_content_wrap" class="content outer" itemprop="articleBody">
          <section id="main_content" class="inner">
            <p>参考 : <a href="http://developer.android.com/intl/ja/reference/android/os/Bundle.html">Bundle | Android Developers</a><br />
参考 : <a href="http://developer.android.com/intl/ja/reference/android/util/SparseArray.html">SparseArray | Android Developers</a><br />
参考 : <a href="http://developer.android.com/reference/java/io/Serializable.html">Serializable | Android Developers</a><br />
参考 : <a href="http://developer.android.com/intl/ja/reference/android/os/Parcelable.html">Parcelable | Android Developers</a><br />
参考 : <a href="http://developer.android.com/intl/ja/reference/android/os/Parcel.html">Parcel | Android Developers</a><br />
参考 : <a href="http://developer.android.com/intl/ja/reference/org/json/JSONObject.html">JSONObject | Android Developers</a><br />
参考 : <a href="http://developer.android.com/intl/ja/reference/org/json/JSONArray.html">JSONArray | Android Developers</a><br />
参考 : <a href="http://developer.android.com/intl/ja/guide/topics/data/data-storage.html">Storage Options | Android Developers</a><br />
参考 : <a href="http://developer.android.com/intl/ja/reference/android/content/SharedPreferences.html">SharedPreferences | Android Developers</a><br />
参考 : <a href="http://developer.android.com/intl/ja/reference/android/content/Context.html#getExternalFilesDir%28java.lang.String%29">Context#getExternalFilesDir() | Android Developers</a></p>

<h2 id="section">目次</h2>

<ul>
  <li><a href="#コレクション">コレクション</a>
    <ul>
      <li><a href="#Bundle">Bundle</a></li>
      <li><a href="#SparseArray">SparseArray</a></li>
    </ul>
  </li>
  <li><a href="#直列化">直列化</a>
    <ul>
      <li><a href="#Serializable">Serializable</a></li>
      <li><a href="#Parcel と Parcelable">Parcel と Parcelable</a></li>
      <li><a href="#JSONObject と JSONArray">JSONObject と JSONArray</a></li>
      <li><a href="#JSON を取り扱うその他のライブラリ">JSON を取り扱うその他のライブラリ</a></li>
    </ul>
  </li>
  <li><a href="#永続化">永続化</a>
    <ul>
      <li><a href="#SharedPreferences">SharedPreferences</a></li>
    </ul>
  </li>
</ul>

<h2 id="section-1">コレクション</h2>

<p>Java には Collection インタフェースを実装したコレクションクラスが、コレクションフレームワークとして提供されています。<br />
この、コレクションフレームワークで提供されている各クラスは、データセットの管理をする上で非常に重要な役割を持っています。</p>

<p>この項目では、Android に最適化されたコレクションフレームワークのうち、Bundle、SparseArrayについて説明をします。</p>

<h3 id="bundle">Bundle</h3>

<p>Bundle は、String をキーとして、各種の Android 向けに最適化されたオブジェクト（各種プリミティブ型、Serializable 型、Parcelable 型、これらの配列ないし List コレクション）をマッピングするためのコレクションです。<br />
Intent の Extras は、内部では Bundle オブジェクトとして管理しています。</p>

<p>Bundle オブジェクトにマッピングを追加するメソッドは put*() です。<br />
マッピングに追加する型に合わせてメソッドが用意されています。</p>

<p>これに対応して、マッピングから値を取り出すメソッドが、get*() として定義されています。<br />
追加した時と取り出す時の型は一致している必要があります。</p>

<p>呼び出し元のActivity</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">,</span> <span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">ResultActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">Bundle</span> <span class="n">bundle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bundle</span><span class="o">();</span>
        <span class="n">bundle</span><span class="o">.</span><span class="na">putString</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span><span class="s">"value"</span><span class="o">);</span>
        <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"bundlePrams"</span><span class="o">,</span> <span class="n">parcelableData</span><span class="o">);</span>
        <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>呼び出し先のActivity</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
        <span class="n">Bundle</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">getIntent</span><span class="o">().</span><span class="na">getExtras</span><span class="o">();</span>
        <span class="n">Bundle</span> <span class="n">bundlePrams</span> <span class="o">=</span> <span class="n">extras</span><span class="o">.</span><span class="na">getParcelable</span><span class="o">(</span><span class="s">"bundlePrams"</span><span class="o">);</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">"data:"</span> <span class="o">+</span> <span class="n">bundlePrams</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"data"</span><span class="o">),</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre>
</div>

<h3 id="sparsearray">SparseArray</h3>

<p>SparseArray は、int 型の値を key とした HashMap のようなものです。<br />
key を int 型に固定することにより、HashMap よりも高速に動作します。</p>

<p>SparseArray では、int 型の key の値は、連続している必要がありません。この点が、Sparse という名前の所以です。</p>

<p>Android では、リソースへのアクセスのために R.id.hoge など int 型の ID を用いることが多いため、それに対するマッピングを行いたいケースは多くなります。HashMapを利用する際にはSparseArrayが利用できないかを検討してみてください（Android Lint が警告を出してくれます）。</p>

<p>また、SparseArray では、値の型は自由な型が指定出来ますが、value が boolean または int の場合には、<a href="http://developer.android.com/intl/ja/reference/android/util/SparseBooleanArray.html">SparseBooleanArray</a>、<a href="http://developer.android.com/intl/ja/reference/android/util/SparseIntArray.html">SparseIntArray</a> が利用可能です。</p>

<p>int 型では key の空間が足りない場合は、key に long 型を利用した <a href="http://developer.android.com/intl/ja/reference/android/util/LongSparseArray.html">LongSparseArray</a> も存在します。</p>

<p><code class="highlighter-rouge">Java
SparseArray&lt;String&gt; array = new SparseArray&lt;String&gt;();
array.add(R.id.TextView1, "hoge");
array.add(R.id.TextView2, "fuga");
array.add(R.id.TextView3, "foo");
array.add(R.id.TextView4, "bar");
</code></p>

<h2 id="section-2">直列化</h2>

<p>この項目では、Java で提供されている直列化フレームワークと、Android で提供されている直列化フレームワークの両方を解説します。</p>

<h3 id="serializable">Serializable</h3>

<p>Java で提供されている直列化フレームワークで、オブジェクトの保存と復旧の方法を決めるためのインタフェースです。<br />
<code class="highlighter-rouge">ObjectInputStream</code>や<code class="highlighter-rouge">ObjectOutputStream</code>の I/O の仕組みを利用して、オブジェクトを何らかの形式で以ってデータ化（シリアライズ）可能であること、またそのデータ化したものからの復旧（デシリアライズ）が可能であることを保証します。<br />
実際にどのような形式で直列化を行うかは、個々の実装に依存します。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyObject</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4324129709521L</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">mName</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Serializable インタフェースには、メソッドの宣言がありません（このようなインタフェースの事をマーカインタフェースと呼ぶ）。</p>

<p>直列化のフレームワークで扱うものは、クラスのフィールドです。特に、フィールド名とそのフィールドが持つデータについてを扱います。<br />
ですので、<code class="highlighter-rouge">static</code>な変数や定数、<code class="highlighter-rouge">transient</code>な変数、メソッドは直列化されません。<br />
また直列化のフレームワークでは、一定のフォーマットへの変換を想定するため、クラスのフィールドの互換性を管理する必要があります。<br />
互換性のないクラスや、フィールドに変更が加えられたクラスでは、直列化のフレームワークが上手く機能しなくなることがあります。この場合、自前で直列化の実際の処理を記述する必要が有ることに注意してください。</p>

<p>特に理由がなければ、以降で述べる Parcelable や JSONObject などより軽量なフレームワークの利用を推奨します。</p>

<h3 id="parcel--parcelable">Parcel と Parcelable</h3>

<p>Android で提供されている直列化フレームワークです。<br />
ただし、Serializable と異なり、永続化の為のフレームワークではありません。<br />
プロセス間通信でハイパフォーマンスを得るために設計されたインタフェースです。Intent や Bundle も Parcelable を実装したクラスになっています。</p>

<p>Parcelable のインタフェースに書き込み処理と復元(読み込み)処理を定義することによりメッセージングで型を限定されずオブジェクトを渡すことが出来るようになっています。<br />
このことにより、Intent で呼び出す Activity などに対してパラメータとしてプリミティブ型や String 型ではなく、独自に定義した型を渡したい場合に利用することができます。</p>

<p>Parcel、Parcelable は次のような特徴を持っています。</p>

<ol>
  <li>Parcelable の実装クラスの中に Parcelable ではないクラスを含めることが可能</li>
  <li>異なるアプリケーションへのメッセージングでも同一オブジェクトが復元できることが保証される</li>
</ol>

<p>Parcelable を実装するには、下記の手順が必要です。</p>

<ol>
  <li><code class="highlighter-rouge">Parcelable#writeToParcel()</code> メソッド内で<code class="highlighter-rouge">Parcel</code>に対してデータを書き込む</li>
  <li><code class="highlighter-rouge">CREATOR</code>という定数を定義し、<code class="highlighter-rouge">Parcelable.Creator&lt;T&gt;</code>を実装</li>
  <li><code class="highlighter-rouge">Parcelable.Creator#createFromParcel()</code>で<code class="highlighter-rouge">Parcel</code>からオブジェクトを生成する処理を実装</li>
</ol>

<p>Parcel から読み込む順序は<code class="highlighter-rouge">Parcelable#writeToParcel()</code>で書き込んだ順序と同じになるようにする必要があります。</p>

<p>Parcelable を Intent で受け渡しするサンプルは下記のようになります。</p>

<p>受け渡し対象のParcelableを実装したクラス</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyParcelable</span> <span class="kd">implements</span> <span class="n">Parcelable</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Parcelable</span><span class="o">.</span><span class="na">Creator</span><span class="o">&lt;</span><span class="n">MyParcelable</span><span class="o">&gt;</span> <span class="n">CREATOR</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Parcelable</span><span class="o">.</span><span class="na">Creator</span><span class="o">&lt;</span><span class="n">MyParcelable</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">MyParcelable</span> <span class="nf">createFromParcel</span><span class="o">(</span><span class="n">Parcel</span> <span class="n">in</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">MyParcelable</span><span class="o">(</span><span class="n">in</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">MyParcelable</span><span class="o">[]</span> <span class="nf">newArray</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">MyParcelable</span><span class="o">[</span><span class="n">size</span><span class="o">];</span>
        <span class="o">}</span>
    <span class="o">};</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mData</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MyParcelable</span><span class="o">()</span> <span class="o">{}</span>

    <span class="kd">private</span> <span class="nf">MyParcelable</span><span class="o">(</span><span class="n">Parcel</span> <span class="n">in</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mData</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readInt</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">describeContents</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeToParcel</span><span class="o">(</span><span class="n">Parcel</span> <span class="n">out</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">out</span><span class="o">.</span><span class="na">writeInt</span><span class="o">(</span><span class="n">mData</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setData</span><span class="o">(</span><span class="kt">int</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mData</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getData</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">mData</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>呼び出し元のActivity</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">,</span> <span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">ResultActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">MyParcelable</span> <span class="n">parcelableData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyParcelable</span><span class="o">();</span>
        <span class="n">parcelableData</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"parcelableData"</span><span class="o">,</span> <span class="n">parcelableData</span><span class="o">);</span>
        <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>呼び出し先のActivity</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
        <span class="n">Bundle</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">getIntent</span><span class="o">().</span><span class="na">getExtras</span><span class="o">();</span>
        <span class="n">MyParcelable</span> <span class="n">parcelData</span> <span class="o">=</span> <span class="n">extras</span><span class="o">.</span><span class="na">getParcelable</span><span class="o">(</span><span class="s">"parcelableData"</span><span class="o">);</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">"data:"</span> <span class="o">+</span> <span class="n">parcelData</span><span class="o">.</span><span class="na">getData</span><span class="o">(),</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre>
</div>

<h3 id="jsonobject--jsonarray">JSONObject と JSONArray</h3>

<p>オブジェクトのシリアライズ・デシリアライズ形式の 1 つである JSON 形式を取り扱うためのフレームワークです。
JSONRPC など主にネットワーク経由でのデータの転送に利用します。</p>

<p>JSON におけるオブジェクトに対応するものが<code class="highlighter-rouge">JSONObject</code>、JSON におけるオブジェクトの配列に対応するものが<code class="highlighter-rouge">JSONArray</code>となります。<br />
このため、JSONObject と JSONArray を正しく使い分ける必要があります。<br />
例えば、下記のような場合はJSONExceptionとなります。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">JSONObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="s">"[\"value1\",\"value2\",\"value3\"]"</span><span class="o">);</span>
</code></pre>
</div>

<p>JSONObject から値を取得する方法として、二種類の方法が提供されています。</p>

<p>1 つは、<code class="highlighter-rouge">JSONObject#get()</code>のような、<code class="highlighter-rouge">get</code>を接頭辞とするメソッドを用いて取得する方法です。<br />
それぞれ、取得する型に合わせて、<code class="highlighter-rouge">JSONObject#getString()</code>、<code class="highlighter-rouge">JSONObject#getInt()</code>など、型を指定したものを使います。</p>

<p>JSON 文字列上の型と異なる型を取得するメソッドを用いた場合、適宜型が変換されることと、存在しない key を指定した場合に<code class="highlighter-rouge">JSONException</code>がスローされることに注意してください。</p>

<p>2 つには、<code class="highlighter-rouge">JSONObject#opt()</code>のような、<code class="highlighter-rouge">opt</code>を接頭辞とするメソッドを用いて取得する方法です。<br />
こちらも、それぞれ取得する型に合わせて<code class="highlighter-rouge">JSONObject#optString()</code>、<code class="highlighter-rouge">JSONObject#optInt()</code>などのメソッドを利用します。</p>

<p>こちらは、存在しない key を指定した場合には、フォールバックの値が使用されます。</p>

<p>いずれの場合においても、下記のような JSON を<code class="highlighter-rouge">JSONObject#getString()</code>や<code class="highlighter-rouge">JSONObject#optString()</code>でパースする場合、<code class="highlighter-rouge">null</code>値ではなく、文字列として”null”が帰ってくることに注意が必要です。</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"hoge"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>値が<code class="highlighter-rouge">null</code>値かどうかを判定するメソッドとして、<code class="highlighter-rouge">JSONObject#isNull()</code>があります。</p>

<h3 id="json-">JSON を取り扱うその他のライブラリ</h3>

<p>JSONObject や JSONArray 以外にも、JSON を取り扱う為のライブラリがあります。</p>

<p>その 1 つとして、<a href="https://code.google.com/p/google-gson/">Gson</a> という、JSON 文字列から Java のオブジェクトにマッピングするフレームワークがあります。<br />
このライブラリでは、自分で JSON 文字列から値を取り出す処理を書かなくても、JSON 文字列でのデータ構造と、Java のクラスのデータ構造を一致させておくことで、自動で JSON 文字列から Java のオブジェクトを生成してくれます。</p>

<p>ただし、<a href="http://alpha.mixi.co.jp/2013/11572/">特定の端末でGsonライブラリを利用するとVerifyErrorでクラッシュしてしまう</a>ので、対象の端末でも利用可能にするためには、名前空間の変更が必要となります。<br />
利用する場合は作成するアプリケーションのサポート端末に注意してください。</p>

<h2 id="section-3">永続化</h2>

<p>Android では永続化の手法がいくつか用意されています。</p>

<ul>
  <li>Shared Preferences</li>
  <li>Internal Storage</li>
  <li>External Storage</li>
  <li>SQLite Databases</li>
  <li>Network Connection</li>
</ul>

<p>この章では Shared Preferences、Internal Storage、External Storageについて扱います。<br />
SQLite Databases についてはデータベースの章で扱います。<br />
Network Connection についてはネットワークを経由してサーバー上にデータを保存することを指しています。ネットワーク通信についてはネットワーク通信の章で扱います。</p>

<h3 id="sharedpreferences">SharedPreferences</h3>

<p>SharedPreferences は Android 標準で用意されている永続化の方法の一つです。<br />
key と value の組み合わせで、プリミティブ型やString型のデータを永続化します。</p>

<p>ファイルの読み書きと、ファイルの状態の管理・監視を請け負っているため、自前でファイル I/O を準備するよりも簡単にデータストアの仕組みが実装できます。</p>

<h4 id="section-4">ファイルの実体</h4>

<p>SharedPreferences を用いた場合、ファイルそのものは、アプリの持つ内部ストレージ領域に保存されます。このため、アプリのアンインストール時には、ファイルも含めて削除されることになります。</p>

<p>このため、アプリケーションが再インストールされてもなおデータを永続化したいユースケースには適用できません。<br />
その場合でもデータを保持しておきたい場合は、適宜サーバにデータを保存するようにするのが良いでしょう。</p>

<p>一部端末において、<a href="http://alpha.mixi.co.jp/2013/11572/">保存場所が違うことに起因する問題</a>が報告されています。<br />
対象の端末をサポートする場合、<a href="https://github.com/mixi-inc/Android-Device-Compatibility">Android-Device-Compatibility</a>を利用するなどして問題を回避することを推奨します。</p>

<h4 id="section-5">ファイルへのアクセス権限</h4>

<p>SharedPreferences のファイル作成時に、モードと呼ばれるアクセス権限を設定します。</p>

<p>通常、アプリの領域内へは他のアプリがアクセス出来ない（MODE_PRIVATE）ようになっていますが、これを SharedPreferences のファイル単位でコントロールが可能です。</p>

<p>ただし、SharedPreferences はアプリの各種設定項目を保存する目的でも使用されるため、他のアプリからのアクセスを許可することは推奨されません。</p>

<p>代わりに、アプリ間連携のための仕組みを使用してください。</p>

<p>また、複数のプロセスをもつアプリケーションで同じファイルを参照する場合に利用する MODE_MULTI_PROCESS というモードも存在しますが、サポートされるのは API Level 11(Android3.0) 以降なので、2.x 系の端末をサポートする場合には利用できません。</p>

<h4 id="sharedpreferences-">SharedPreferences の使用</h4>

<p>SharedPreferences のインスタンスは<code class="highlighter-rouge">Context#getSharedPreferences(String, int)</code>で取得します。<br />
第 1 引数には扱いたい SharedPreferences 名を指定します。ここで指定した名前がそのままファイル名となります。<br />
第 2 引数には SharedPreferences のモードを指定します。<br />
モードは対象のSharedPreferencesに対するアクセス権の設定です。デフォルトではMODE_PRIVATEになります。</p>

<h4 id="section-6">データの保存</h4>

<p>データの保存は、SharedPreferences.Editor クラスを介して行います。</p>

<ol>
  <li><code class="highlighter-rouge">SharedPreferences#edit()</code>で<code class="highlighter-rouge">SharedPreferences.Editor</code>オブジェクトを取得</li>
  <li><code class="highlighter-rouge">SharedPreferences.Editor#putString(String,String)</code>などで値を設定する</li>
  <li><code class="highlighter-rouge">SharedPreferences.Editor#commit()</code>または<code class="highlighter-rouge">SharedPreferences.Editor#apply()</code>で保存する</li>
</ol>

<p><code class="highlighter-rouge">SharedPreferences.Editor#apply()</code>は保存の完了を待たずに処理が戻ってきます。<br />
そのため、保存に成功したかを確認することができません。
また、apply()は API Level 9 (Android 2.3) 以降のサポートになるため、Android2.2 以前の端末をサポートする場合利用できません。</p>

<p>メインスレッドから SharedPreferences を扱っていて、保存の成功、失敗を意識しなくていい場合以外は、非同期処理の中で<code class="highlighter-rouge">SharedPreferences.Editor#commit()</code>を使用することが望ましいでしょう。</p>

<p>値を削除する場合は<code class="highlighter-rouge">SharedPreferences.Editor#remove(String)</code>で個別に削除できます。<br />
全ての値を削除したい場合は<code class="highlighter-rouge">SharedPreferences.Editor#clear()</code>メソッドを用います。</p>

<p>値の削除に関しても<code class="highlighter-rouge">SharedPreferences.Editor#commit()</code>ないし<code class="highlighter-rouge">SharedPreferences.Editor#apply()</code>を呼び出すまでは保存されません。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="c1">// データの保存</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">savePerson</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SharedPreferences</span> <span class="n">sp</span> <span class="o">=</span> <span class="n">getSharedPreferences</span><span class="o">(</span><span class="s">"person"</span><span class="o">,</span> <span class="n">MODE_PRIVATE</span><span class="o">);</span>
        <span class="n">Editor</span> <span class="n">editor</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="na">edit</span><span class="o">();</span>
        <span class="n">editor</span><span class="o">.</span><span class="na">putString</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
        <span class="n">editor</span><span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="s">"age"</span><span class="o">,</span> <span class="n">age</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">editor</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre>
</div>

<h4 id="section-7">データの取得</h4>

<p>データの取得には、<code class="highlighter-rouge">SharedPreferences#getString()</code>、<code class="highlighter-rouge">SharedPreferences#getBoolean()</code>、<code class="highlighter-rouge">SharedPreferences#getFloat()</code>、<code class="highlighter-rouge">SharedPreferences#getLong()</code>、<code class="highlighter-rouge">SharedPreferences#getStringSet()</code>など、それぞれの型に合わせたメソッドを使います。</p>

<p>保存時の型と取得時の型は一致している必要があります。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="c1">// データの取得</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">mName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mAge</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">readPerson</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">SharedPreferences</span> <span class="n">sp</span> <span class="o">=</span> <span class="n">getContext</span><span class="o">().</span><span class="na">getSharedPreferences</span><span class="o">(</span><span class="s">"person"</span><span class="o">,</span> <span class="n">MODE_PRIVATE</span><span class="o">);</span>
        <span class="n">mName</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"no name"</span><span class="o">);</span>
        <span class="n">mAge</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">"age"</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre>
</div>

<h4 id="section-8">データ変更の監視</h4>

<p>データ変更の監視のためのオブジェクトとして、<code class="highlighter-rouge">SharedPreferences.OnSharedPreferenceChangeListener</code>が定義されています。</p>

<p>このリスナオブジェクトを、<code class="highlighter-rouge">SharedPreferences#registerOnSharedPreferenceChangeListener</code>メソッドで登録することで、SharedPreferences の中で管理しているデータに変更が発生した際に、コールバックを受けることが出来るようになります。</p>

<p>保存されている値に変更があった場合に、その変更を画面上に反映するといった場合に利用されます。</p>

<p>登録した <code class="highlighter-rouge">SharedPreferences.OnSharedPreferenceChangeListener</code> は、Context のライフサイクルの終わりに必ず<code class="highlighter-rouge">SharedPreferences#unregisterOnSharedPreferenceChangeListener()</code>で登録解除をしてください。<br />
登録解除をしなかった場合は、対象のオブジェクトに参照が残ってしまうためリークが発生するので注意が必要です。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="kd">implements</span> <span class="n">OnSharedPreferenceChangeListener</span> <span class="o">{</span> 
    <span class="kd">private</span> <span class="n">SharedPreferences</span> <span class="n">mSharedPreferences</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="n">mSharedPreferences</span> <span class="o">=</span> <span class="n">getSharedPreferences</span><span class="o">(</span><span class="s">"sample"</span><span class="o">,</span> <span class="n">MODE_PRIVATE</span><span class="o">);</span>
        <span class="n">mSharedPreferences</span><span class="o">.</span><span class="na">registerOnSharedPreferenceChangeListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">(){</span>
        <span class="n">mSharedPreferences</span><span class="o">.</span><span class="na">unregisterOnSharedPreferenceChangeListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSharedPreferenceChanged</span><span class="o">(</span><span class="n">SharedPreferences</span> <span class="n">sharedPreferences</span><span class="o">,</span> <span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">sharedPreferences</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">TextView</span> <span class="n">tv</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">PreferencesValue</span><span class="o">);</span>
            <span class="n">tv</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="internal-storage">Internal Storage</h3>

<p>Internal Storage はその名の通りデバイスの内部ストレージのことです。</p>

<p>内部ストレージに保存されたファイルは SharedPreferences と同様、モードによってアクセス制御をすることができます。<br />
これにより安全にファイルを保存することができます。ただし、内部ストレージは外部ストレージに比べて容量に制限があることが多いため、画像ファイルなどを大量に保存することには向きません。</p>

<p>標準で、Context は内部ストレージを利用するためのインタフェースを提供しています。</p>

<ol>
  <li><code class="highlighter-rouge">Context#openFileOutput()</code>で、<code class="highlighter-rouge">FileOutputStream</code>を取得する</li>
  <li><code class="highlighter-rouge">FileOutputStream#write()</code>で保存したいバイト列をストリームに格納する</li>
  <li><code class="highlighter-rouge">FileOutputStream#close()</code>でストリームを閉じる</li>
</ol>

<p>Java のファイル入出力の仕組みに倣い、<code class="highlighter-rouge">FileOutputStream#close()</code> はエラーが発生した場合でも必ず呼び出されるようにする必要があります。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">String</span> <span class="n">FILENAME</span> <span class="o">=</span> <span class="s">"hello_file"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">string</span> <span class="o">=</span> <span class="s">"hello world!"</span><span class="o">;</span>

<span class="n">FileOutputStream</span> <span class="n">fos</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">openFileOutput</span><span class="o">(</span><span class="n">FILENAME</span><span class="o">,</span> <span class="n">MODE_PRIVATE</span><span class="o">);</span>
  <span class="n">fos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// 例外処理</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">fos</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">fos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>ファイルの内容を取得する場合は</p>

<ol>
  <li><code class="highlighter-rouge">Context#openFileInput()</code>でファイル名を指定し<code class="highlighter-rouge">FileInputStream</code>を取得します。</li>
  <li><code class="highlighter-rouge">FileInputStream#read()</code>でファイル内容を読み出します。</li>
  <li><code class="highlighter-rouge">FileInputStream#close()</code>でストリームを閉じます。</li>
</ol>

<p>保存時同様、<code class="highlighter-rouge">FileInputStream#close()</code>は必ず呼び出されるようにしてください。</p>

<h3 id="cache-directory">Cache Directory</h3>

<p>一時ファイルとしてキャッシュしたいファイルを扱うための特別なディレクトリです。<br />
内蔵ディレクトリに、キャッシュ用のディレクトリが作成されます。</p>

<h3 id="external-storage">External Storage</h3>

<p>External Storage は外部ストレージのことです。おおよそ SD カードがこれに当たりますが、端末によっては、内部ストレージとは別の内蔵メモリに保存している場合があります (Galaxy Nexus 等)。</p>

<p>外部ストレージはアクセス制御をすることができません。<br />
そのため、全てのアプリケーションからアクセスすることができるので、保存する内容には注意が必要です。</p>

<p>外部ストレージを取得するには getExternalFilesDir() で外部ストレージのルートディレクトリを取得出来ます。<br />
また、引数の type で DIRECTORY_MUSIC, DIRECTORY_PODCASTS, DIRECTORY_RINGTONES, DIRECTORY_ALARMS, DIRECTORY_NOTIFICATIONS, DIRECTORY_PICTURES, DIRECTORY_MOVIES を指定することにより、用途別のディレクトリを取得ができます。</p>

<h2 id="section-9">実習・課題</h2>

<h3 id="section-10">コレクション・直列化</h3>

<ol>
  <li>（実習）JSONの文字列をパースし、画面に表示してください。</li>
  <li>（課題）JSONのレスポンスをパースし、一覧表示してください。<br />
また、ListView部分をタップすると、詳細画面を表示するようにしてください。<br />
その際、表示するデータはすべてMainActivityから渡すようにしてください。</li>
</ol>

<h3 id="section-11">永続化</h3>

<ol>
  <li>(実習) SharedPreferencesに値を保存、取得をしてください。<br />
アプリケーションを終了しても保存した値を取得できることの確認をしてください。
また、保存した値を削除してください。</li>
  <li>(実習) 内部ストレージ、外部ストレージにそれぞれファイルを保存してください。<br />
内部ストレージにはテキストファイル、外部ストレージには画像ファイルを保存してください。
外部ストレージに保存されたファイルをファイラーなどで参照してみてください。</li>
  <li>(課題) SharedPreferencesを利用してアプリケーションを終了しても保存されるカウンターを作成してください。<br />
また、そのカウントを画面上に表示してください。その際、onSharedPreferenceChanged内から変更を行なってください。</li>
</ol>

          </section>
        </div>

        <!-- FOOTER  -->
        <!-- <div id="footer_wrap" class="outer">
          <footer class="inner">
  <p class="license">Portions of this page are reproduced from work created and <a href="https://code.google.com/p/android/">shared by the Android Open Source Project</a> and used according to terms described in the <a href="http://creativecommons.org/licenses/by/2.5/">Creative Commons2.5 Attribution License</a>.</p>
  <p class="license">
  This work is licensed under a <a rel="license" itemprop="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. 
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
  </p>
  <p class="copyright">Androidtraining maintained by <a href="https://github.com/mixi-inc" itemprop="author">mixi-inc</a></p>
  <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>

</footer>

        </div> -->
      </paper-scroll-header-panel>
    </paper-drawer-panel>
    <script>
        // custom transformation: scale header's title
        var title = document.querySelectorAll('.title')[2];
        addEventListener('paper-header-transform', function(e) {
            var d = e.detail;
            var m = d.height - d.condensedHeight;
            var scale = Math.max(0.75, (m - d.y) / (m / 0.25)  + 0.75);

            Polymer.Base.transform('scale(' + scale + ') translateZ(0)', title);
        });

    </script>
</body>
</html>
