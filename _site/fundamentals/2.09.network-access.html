<!DOCTYPE html>
<html lang="ja">

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="この章では、ネットワーク通信について解説します。" />
    <meta name=viewport content="width=device-width, initial-scale=1">
    <!-- ogp for twitter -->
    <meta content="@mixi_engineers" name="twitter:site" />
    <meta content="summary" name="twitter:card" />
    
    <meta content="ネットワーク通信 - r21nomi/AndroidTraining" name="twitter:title" />
    
    <meta content="この章では、ネットワーク通信について解説します。" name="twitter:description" />
    <meta content="/assets/logo.png" name="twitter:image:src" />
    <!-- ogp -->
    <meta content="r21nomi/AndroidTraining" property="og:site_name" />
    <meta content="article" property="og:type" />
    <meta content="/assets/logo.png" property="og:image" />
    
    <meta content="ネットワーク通信 - r21nomi/AndroidTraining" name="og:title" />
    
    <meta content="/fundamentals/2.09.network-access.html" property="og:url" />
    <meta content="この章では、ネットワーク通信について解説します。" property="og:description" />
    
    <meta name="keyword" content="android, training, 基礎, スキル, 開発, developer, プログラミング, ネットワーク, 通信" />
    

    <meta name="go-import" content="github.com/mixi-inc/AndroidTraining git https://github.com/mixi-inc/AndroidTraining.git">
    <script src="/AndroidTraining/bower_components/webcomponentsjs/webcomponents.js"></script>
    
    <link rel="stylesheet" type="text/css" media="screen" href="/AndroidTraining/stylesheets/main.css">
    <link rel="shortcut icon" href="/AndroidTraining/assets/favicon.ico" />
    <link rel="import" href="/AndroidTraining/bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-drawer-panel/paper-drawer-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-header-panel/paper-header-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-toolbar/paper-toolbar.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-menu/paper-menu.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-item/paper-item.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="/AndroidTraining/bower_components/iron-icons/iron-icons.html">
    <style is="custom-style">
        paper-scroll-header-panel:not([style-scope]):not(.style-scope) {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        paper-toolbar.tall .bottom:not([style-scope]):not(.style-scope) {
            font-size: 40px;
            margin-left: 60px;

            -webkit-transform-origin: left center;
            transform-origin: left center;
        }

        .content:not([style-scope]):not(.style-scope) {
            padding: 8px;
        }

        .spacer:not([style-scope]):not(.style-scope) {
            -ms-flex: 1 1 0.000000001px;
            -webkit-flex: 1;
            flex: 1;
            -webkit-flex-basis: 0.000000001px;
            flex-basis: 0.000000001px;
        }

    </style>
    <title>ネットワーク通信 - r21nomi/AndroidTraining</title>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-50931519-13', 'auto');
    ga('send', 'pageview');
    </script>
  </head>

  <body itemscope itemtype="http://schema.org/Article" fullbleed layout vertical>

    <paper-drawer-panel selected="main" >
      <!-- MENU -->
      <paper-header-panel mode="seamed" drawer class="drawer">
        <nav>
    <ol class="chapter_navigation">
        <a href="/AndroidTraining/">Home</a>
        <li>まえがき</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/introductions/1.01.about-android-os.html">Android-OSについて</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.02.prepare-for-development.html">開発環境の準備</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.03.create-project-for-android-studio.html">プロジェクトの作成</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.04.basic-knowledge.html">Androidの基礎知識</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.05.how-to-build-for-gradle.html">Android のビルドについて(Gradle)</a></li>
            
        </ol>
        <li>基礎編</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/fundamentals/2.01.create-layout.html">アプリのレイアウト作成</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.02.activity-and-fragment.html">ActivityとFragment</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.03.application-resource-management.html">アプリのリソース管理</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.04.messaging-and-notification.html">メッセージングと通知</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.05.actionbar-and-interaction-control.html">ActionBarとインタラクション制御</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.06.listView-and-viewPager.html">ListViewとViewPager</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.07.serialize-and-collection-and-perpetuation.html">直列化とコレクション、永続化</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.08.async-processing.html">非同期処理</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.09.network-access.html">ネットワーク通信</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.10.database.html">データベース</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.11.testing-for-android-studio.html">テスト(AndroidStudio)</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.11.testing.html">テスト</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.12.handler-and-looper.html">HandlerとLooper</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.13.webView.html">WebView</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.14.accountmanager.html">AccountManager</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.15.advance-contentprovider.html">ContentProviderの発展</a></li>
            
        </ol>
        <li>実務編</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/advanced/3.01.build-for-eclipse.html">デバッグと自動ビルド(Eclipse)</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.01.build-for-gradle.html">自動ビルド(Android Studio)</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.02.architecture-and-di.html">アーキテクチャ設計と DI</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.03.advanced-layout.html">続・アプリのレイアウト作成</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.04.user-interface.html">ユーザインタフェース設計</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.05.security.html">セキュリティ</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.06.google-api.html">Google API</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.07.google-play-services.html">Google Play Services</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.08.cloud-sync.html">クラウド同期</a></li>
            
        </ol>
        <li>デザイナー編</li>
        <ol>
        </ol>
    </ol>
    <ol class="appex_navigation">
        <li>付録</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/appendix/A.01.import-from-git-for-eclipse.html">Git リポジトリからのプロジェクトのインポート</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.02.basic-java.html">Java の文法の基礎</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.03.how-to-create-avd.html">仮想デバイスの作成</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.04.advanced-java.html">Javaの活用</a></li>
            
        </ol>
    </ol>
</nav>

      </paper-header-panel>
      <paper-scroll-header-panel main condenses>
        <!-- HEADER -->
        <paper-toolbar class="mainheader tall" role="toolbar">
    <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>

    <span class="title"></span>

    <a id="forkme_banner" href="https://github.com/mixi-inc/AndroidTraining" role="button">
        <paper-icon-button src="/AndroidTraining/images/blacktocat.png"></paper-icon-button> <span>View on GitHub</span>
    </a>

    <div class="middle title">r21nomi/AndroidTraining</div>
    <div class="bottom title">ネットワーク通信</div>
</paper-toolbar>


<div id="description" itemprop="description">この章では、ネットワーク通信について解説します。</div>



        <!-- MAIN CONTENT -->
        <div id="main_content_wrap" class="content outer" itemprop="articleBody">
          <section id="main_content" class="inner">
            <p>参考:<a href="http://developer.android.com/intl/ja/reference/java/net/HttpURLConnection.html">HttpURLConnection | Android Developers</a></p>

<h2 id="section">目次</h2>

<ul>
  <li><a href="#ネットワーク通信の準備">ネットワーク通信の準備</a>
    <ul>
      <li><a href="#パーミッション">パーミッション</a></li>
      <li><a href="#ネットワークの接続状態を知る">ネットワークの接続状態を知る</a></li>
    </ul>
  </li>
  <li><a href="#Http 通信のためのライブラリと通信処理">Http 通信のためのライブラリと通信処理</a>
    <ul>
      <li><a href="#非同期処理">非同期処理</a></li>
      <li><a href="#HttpURLConnection">HttpURLConnection</a></li>
      <li><a href="#Apache HttpClient">Apache HttpClient</a></li>
    </ul>
  </li>
</ul>

<h2 id="section-1">ネットワーク通信の準備</h2>

<h3 id="section-2">パーミッション</h3>

<p>ネットワークアクセスを行うためには AndroidManifest ファイルにネットワークアクセスを許可するパーミッションを追記する必要があります。
このパーミッションがない場合には、ネットワーク接続がエラーとなります。</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.INTERNET"</span> <span class="nt">/&gt;</span>
</code></pre>
</div>

<p>また、ネットワークの接続状態を確認するためには、以下のパーミッションが必要です。</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.ACCESS_NETWORK_STATE"</span> <span class="nt">/&gt;</span>
</code></pre>
</div>

<p>このパーミッションを取得することで、Wifi または 3G などのネットワーク接続が可能な場合は通信を行い、接続が不可能な場合はオフラインモードでアプリケーションを動作させる、等のハンドリングが可能となります。</p>

<h3 id="section-3">ネットワークの接続状態を知る</h3>

<p>ネットワークの接続状態を確認するには、<code class="highlighter-rouge">ConnectivityManager</code>を使用します。<br />
これを以って、以下の様なユースケースに対応することが出来るようになります。</p>

<ul>
  <li>ネットワークに接続されていない場合は、ローカルにキャッシュされているデータを表示する</li>
  <li>ファイルサイズが大きいためwifiに接続されている場合のみダウンロードする</li>
</ul>

<pre><code class="language-Java">public class MyActivity extends Activity {
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        // do something...

        // Context 経由でインスタンスを取得する
        ConnectivityManager cm = (ConnectivityManager) getSystemService(CONNECTIVITY_SERVICE);
        NetworkInfo info = cm.getActiveNetworkInfo();
        if (info.isConnected()) {
            Toast.makeText(this, info.getTypeName() + " connected", Toast.LENGTH_LONG).show();
        }
    }
}
</code></pre>

<p>接続されているネットワークの種別を知りたい場合は、NetworkInfo.getType()で取得することができます。<br />
wifiに接続時のみに動作させたい処理は下記のように記述することで実装できます。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>        <span class="n">ConnectivityManager</span> <span class="n">cm</span> <span class="o">=</span> <span class="o">(</span><span class="n">ConnectivityManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="n">CONNECTIVITY_SERVICE</span><span class="o">);</span>
        <span class="n">NetworkInfo</span> <span class="n">info</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="na">getActiveNetworkInfo</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">info</span><span class="o">.</span><span class="na">getType</span><span class="o">()</span> <span class="o">==</span> <span class="n">ConnectivityManager</span><span class="o">.</span><span class="na">TYPE_WIFI</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// wifi時のみ動作する処理を記述</span>
        <span class="o">}</span>
</code></pre>
</div>

<h2 id="http-">Http 通信のためのライブラリと通信処理</h2>

<p>Android では、Http 通信を行う為のライブラリとして、<code class="highlighter-rouge">HttpURLConnection</code>と<code class="highlighter-rouge">Apache HttpClient</code>の 2 種類の API が提供されています。<br />
Get リクエストや Post リクエストの為の様々な API が用意されており、これを用いて、様々な Web サービスの API にリクエストを投げ、そのレスポンスを以って何らかの処理をするような使い方をします。<br />
Http 通信ですので、html を取得する用途にも用いることができますが、このような場合には、WebView を用いるほうが一般的です。</p>

<p><code class="highlighter-rouge">HttpURLConnection</code>は、Http 通信のための基本的な API を提供しています。よって、I/O ストリームを用いた通信の入出力処理を実装する必要があります。<br />
<code class="highlighter-rouge">Apache HttpClient</code>は、よりレイヤの高い実装となっており、入出力処理が抽象化されています。</p>

<p>Froyo より前の OS では、<code class="highlighter-rouge">HttpURLConnection</code>にはコネクションプールを汚染する深刻なバグが含まれているため、<code class="highlighter-rouge">Apache HttpClient</code>の使用が推奨されています。<br />
GingerBread 以降、<code class="highlighter-rouge">HttpURLConnection</code>のサポートが強化され、<code class="highlighter-rouge">Apache HttpClient</code>の置き換えが推奨されるようになりました。<br />
Android 2.2 をサポート端末に含める場合は<code class="highlighter-rouge">Apache HttpClient</code>の使用を推奨しますが、そうでなければ、<code class="highlighter-rouge">HttpURLConnection</code>を使用するのがよいでしょう。</p>

<p><a href="http://android-developers.blogspot.jp/2011/09/androids-http-clients.html">こちら</a>により詳細な説明が記載されています。</p>

<h3 id="section-4">非同期処理</h3>

<p>ネットワーク接続の処理は、予測不能な遅延を含む可能性があります。<br />
このため、ネットワーク接続の処理は UIThread 実施してはいけません。<br />
よって、ネットワーク接続は基本的に前章の非同期処理と組み合わせて使うことになります。</p>

<h3 id="httpurlconnection">HttpURLConnection</h3>

<p>HttpURLConnection は、指定された URL に接続してデータの送受信をするための Client です。<br />
API がシンプルで、サイズが小さいのでリソースに限りがある Android に適しています。</p>

<p>Froyo より前の OS における、特定の条件でのコネクションプール汚染問題は、下記のようなコードで回避ができます。</p>

<pre><code class="language-Java">private void disableConnectionReuseIfNecessary() {
    // HTTP connection reuse which was buggy pre-froyo
    if (Integer.parseInt(Build.VERSION.SDK) &lt; Build.VERSION_CODES.FROYO) {
        System.setProperty("http.keepAlive", "false");
    }
}
</code></pre>

<p>HttpURLConnection の使用手順は下記のとおりです。</p>

<ol>
  <li><code class="highlighter-rouge">URL#openConnection()</code>を呼び出し、接続を開始する<br />
  <code class="highlighter-rouge">URL#openConnection()</code>で取得できる型は<code class="highlighter-rouge">URLConnection</code>型なので、<code class="highlighter-rouge">HttpURLConnection</code>型へキャストする必要があります。</li>
  <li>必要なヘッダーを設定する<br />
  Session cookie や認証情報、Content-type などを必要に応じて設定します。</li>
  <li>リクエストに body を設定する場合は、<code class="highlighter-rouge">HttpURLConnection#setDoOutput(true)</code>で body が存在することを明示する<br />
  接続を確立後、getOutputStream() で取得した<code class="highlighter-rouge">OutputStream</code>に body の内容を書き込みます。</li>
  <li>connect()で接続を確立する<br />
  <code class="highlighter-rouge">HttpURLConnection#setDoOutput(false)</code>とした場合、この段階で getInputStream() でレスポンスを取得できるかと思います。
  <code class="highlighter-rouge">HttpURLConnection#setDoOutput(true)</code>とした場合、getOutputStream() で取得した<code class="highlighter-rouge">OutputStream</code>を close() するまでデータ送信中の状態となるため、<code class="highlighter-rouge">OutputStream</code>への書き込みが完了したら close() を呼び出すようにしてください。</li>
  <li>レスポンスを getInputStream() で取得する</li>
</ol>

<p>上記のような手順でサーバーからのレスポンスを得ることができます。</p>

<p>ただし、実際には getInputStream() の前に getResponseCode() でステータスコードなどを確認し、必要に応じてエラーハンドリングなどを行う必要があります。<br />
また、実際のアプリケーションでは、<code class="highlighter-rouge">HttpURLConnection</code>をラッピングするクラスを作成し、アクセスする API に対応する Client の実装を経由して行うと良いでしょう。</p>

<p>GET処理</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>        <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">"http://mixi.jp"</span><span class="o">);</span>
        <span class="n">HttpURLConnection</span> <span class="n">connection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
            <span class="n">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>

            <span class="n">StringBuilder</span> <span class="n">src</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">byte</span><span class="o">[]</span> <span class="n">line</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="o">)</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="n">src</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">line</span><span class="o">,</span> <span class="s">"euc-jp"</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span><span class="o">{</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
        <span class="o">}</span>
</code></pre>
</div>

<p>POST処理</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>        <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">"http://mixi.jp"</span><span class="o">);</span>
        <span class="n">HttpURLConnection</span> <span class="n">connection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="s">"POST"</span><span class="o">);</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">setDoOutput</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

            <span class="n">String</span> <span class="n">postData</span> <span class="o">=</span> <span class="s">"hoge=fuga&amp;piyo=test"</span><span class="o">;</span>
            <span class="n">OutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
            <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">postData</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
            <span class="n">os</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="n">os</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>

            <span class="n">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>

            <span class="n">StringBuilder</span> <span class="n">src</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">byte</span><span class="o">[]</span> <span class="n">line</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="o">)</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="n">src</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">line</span><span class="o">,</span> <span class="s">"euc-jp"</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span><span class="o">{</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
        <span class="o">}</span>
</code></pre>
</div>

<h3 id="apache-httpclient">Apache HttpClient</h3>

<p><code class="highlighter-rouge">Apache HttpClient</code>は、Apacheによって開発が進められている Http 通信ライブラリの総称です。<br />
<code class="highlighter-rouge">HttpURLConnection</code>よりも扱いやすいですが、Android での利用は<code class="highlighter-rouge">HttpURLConnection</code>が推奨されいます。<br />
また、Multipart への対応が無いバージョンのものが使用されているため、Multipart への対応を行う場合には別途自前で実装が必要です。</p>

<p>GET の処理は下記のようになります。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>        <span class="n">HttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultHttpClient</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="s">"http://mixi.jp"</span><span class="o">),</span>
                    <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
                        <span class="kd">public</span> <span class="n">String</span> <span class="nf">handleResponse</span><span class="o">(</span><span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span>
                                <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
                            <span class="k">return</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">());</span>
                        <span class="o">}</span>
                    <span class="o">});</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
</code></pre>
</div>

<h2 id="section-5">実習と課題</h2>

<ol>
  <li>(実習) HttpURLConnectionを利用してmixi.jpへアクセスをし、取得できたhtmlの文字列を画面に表示してください。</li>
  <li>(実習) HttpClientを利用して実習1と同様のことを行なってください。</li>
  <li>(課題) youtubeで日本で前日の評価が最も高い動画のタイトルを<a href="https://developers.google.com/youtube/reference?hl=ja#Standard_feeds">API</a>で取得し表示してください。</li>
</ol>

          </section>
        </div>

        <!-- FOOTER  -->
        <div id="footer_wrap" class="outer">
          <footer class="inner">
  <p class="license">Portions of this page are reproduced from work created and <a href="https://code.google.com/p/android/">shared by the Android Open Source Project</a> and used according to terms described in the <a href="http://creativecommons.org/licenses/by/2.5/">Creative Commons2.5 Attribution License</a>.</p>
  <p class="license">
  This work is licensed under a <a rel="license" itemprop="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. 
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
  </p>
  <p class="copyright">Androidtraining maintained by <a href="https://github.com/mixi-inc" itemprop="author">mixi-inc</a></p>
  <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>

</footer>

        </div>
      </paper-scroll-header-panel>
    </paper-drawer-panel>
    <script>
        // custom transformation: scale header's title
        var title = document.querySelectorAll('.title')[2];
        addEventListener('paper-header-transform', function(e) {
            var d = e.detail;
            var m = d.height - d.condensedHeight;
            var scale = Math.max(0.75, (m - d.y) / (m / 0.25)  + 0.75);

            Polymer.Base.transform('scale(' + scale + ') translateZ(0)', title);
        });

    </script>
</body>
</html>
