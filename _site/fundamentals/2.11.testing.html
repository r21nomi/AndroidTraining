<!DOCTYPE html>
<html lang="ja">

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="AndroidTraining - Training course repository for android app development" />
    <meta name=viewport content="width=device-width, initial-scale=1">
    <!-- ogp for twitter -->
    <meta content="@mixi_engineers" name="twitter:site" />
    <meta content="summary" name="twitter:card" />
    
    <meta content="テスト - mixi-inc/AndroidTraining" name="twitter:title" />
    
    <meta content="AndroidTraining - Training course repository for android app development" name="twitter:description" />
    <meta content="/assets/logo.png" name="twitter:image:src" />
    <!-- ogp -->
    <meta content="mixi-inc/AndroidTraining" property="og:site_name" />
    <meta content="article" property="og:type" />
    <meta content="/assets/logo.png" property="og:image" />
    
    <meta content="テスト - mixi-inc/AndroidTraining" name="og:title" />
    
    <meta content="/fundamentals/2.11.testing.html" property="og:url" />
    <meta content="AndroidTraining - Training course repository for android app development" property="og:description" />
    
    <meta name="keyword" content="android, training, 基礎, スキル, 開発, developer, プログラミング, test, UnitTest" />
    

    <meta name="go-import" content="github.com/mixi-inc/AndroidTraining git https://github.com/mixi-inc/AndroidTraining.git">
    <script src="/AndroidTraining/bower_components/webcomponentsjs/webcomponents.js"></script>
    
    <link rel="stylesheet" type="text/css" media="screen" href="/AndroidTraining/stylesheets/main.css">
    <link rel="shortcut icon" href="/AndroidTraining/assets/favicon.ico" />
    <link rel="import" href="/AndroidTraining/bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-drawer-panel/paper-drawer-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-header-panel/paper-header-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-toolbar/paper-toolbar.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-menu/paper-menu.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-item/paper-item.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="/AndroidTraining/bower_components/iron-icons/iron-icons.html">
    <style is="custom-style">
        paper-scroll-header-panel:not([style-scope]):not(.style-scope) {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        paper-toolbar.tall .bottom:not([style-scope]):not(.style-scope) {
            font-size: 40px;
            margin-left: 60px;

            -webkit-transform-origin: left center;
            transform-origin: left center;
        }

        .content:not([style-scope]):not(.style-scope) {
            padding: 8px;
        }

        .spacer:not([style-scope]):not(.style-scope) {
            -ms-flex: 1 1 0.000000001px;
            -webkit-flex: 1;
            flex: 1;
            -webkit-flex-basis: 0.000000001px;
            flex-basis: 0.000000001px;
        }

    </style>
    <title>テスト - mixi-inc/AndroidTraining</title>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-50931519-13', 'auto');
    ga('send', 'pageview');
    </script>
  </head>

  <body itemscope itemtype="http://schema.org/Article" fullbleed layout vertical>

    <paper-drawer-panel selected="main" >
      <!-- MENU -->
      <paper-header-panel mode="seamed" drawer class="drawer">
        <nav>
    <ol class="chapter_navigation">
        <a href="/AndroidTraining/">Home</a>
        <li>まえがき</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/introductions/1.01.about-android-os.html">Android-OSについて</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.02.prepare-for-development.html">開発環境の準備</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.03.create-project-for-android-studio.html">プロジェクトの作成</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.04.basic-knowledge.html">Androidの基礎知識</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.05.how-to-build-for-gradle.html">Android のビルドについて(Gradle)</a></li>
            
        </ol>
        <li>基礎編</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/fundamentals/2.01.create-layout.html">アプリのレイアウト作成</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.02.activity-and-fragment.html">ActivityとFragment</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.03.application-resource-management.html">アプリのリソース管理</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.04.messaging-and-notification.html">メッセージングと通知</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.05.actionbar-and-interaction-control.html">AppBarとインタラクション制御</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.06.listView-and-viewPager.html">ListViewとViewPager</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.07.serialize-and-collection-and-perpetuation.html">直列化とコレクション、永続化</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.08.async-processing.html">非同期処理</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.09.network-access.html">ネットワーク通信</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.10.database.html">データベース</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.11.testing-for-android-studio.html">テスト(AndroidStudio)</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.11.testing.html">テスト</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.12.handler-and-looper.html">HandlerとLooper</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.13.webView.html">WebView</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.14.accountmanager.html">AccountManager</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.15.advance-contentprovider.html">ContentProviderの発展</a></li>
            
        </ol>
        <li>実務編</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/advanced/3.01.build-for-eclipse.html">デバッグと自動ビルド(Eclipse)</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.01.build-for-gradle.html">自動ビルド(Android Studio)</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.02.architecture-and-di.html">アーキテクチャ設計と DI</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.03.advanced-layout.html">続・アプリのレイアウト作成</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.04.user-interface.html">ユーザインタフェース設計</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.05.security.html">セキュリティ</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.06.google-api.html">Google API</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.07.google-play-services.html">Google Play Services</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.08.cloud-sync.html">クラウド同期</a></li>
            
        </ol>
        <li>デザイナー編</li>
        <ol>
        </ol>
    </ol>
    <ol class="appex_navigation">
        <li>付録</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/appendix/A.01.import-from-git-for-eclipse.html">Git リポジトリからのプロジェクトのインポート</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.02.basic-java.html">Java の文法の基礎</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.03.how-to-create-avd.html">仮想デバイスの作成</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.04.advanced-java.html">Javaの活用</a></li>
            
        </ol>
    </ol>
</nav>

      </paper-header-panel>
      <paper-scroll-header-panel main condenses>
        <!-- HEADER -->
        <paper-toolbar class="mainheader tall" role="toolbar">
    <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>

    <span class="title"></span>

    <a id="forkme_banner" href="https://github.com/mixi-inc/AndroidTraining" role="button">
        <paper-icon-button src="/AndroidTraining/images/blacktocat.png"></paper-icon-button> <span>View on GitHub</span>
    </a>

    <div class="middle title">mixi-inc/AndroidTraining</div>
    <div class="bottom title">テスト</div>
</paper-toolbar>


<div id="description" itemprop="description">AndroidTraining - Training course repository for android app development</div>



        <!-- MAIN CONTENT -->
        <div id="main_content_wrap" class="content outer" itemprop="articleBody">
          <section id="main_content" class="inner">
            <h2 id="section">目次</h2>

<ul>
  <li><a href="#テストディレクトリの作成">テストディレクトリの作成</a></li>
  <li><a href="#ユニットテスト">ユニットテスト</a>
    <ul>
      <li><a href="#テストの設定">テストの設定</a></li>
      <li><a href="#テストの実行">テストの実行</a></li>
      <li><a href="#テストレポート">テストレポート</a></li>
    </ul>
  </li>
</ul>

<h2 id="section-1">テストディレクトリの作成</h2>

<h2 id="section-2">ユニットテスト</h2>

<h3 id="section-3">テストの設定</h3>

<h3 id="section-4">テストの実行</h3>

<h4 id="ide">IDE</h4>

<h4 id="section-5">コマンド</h4>

<h3 id="section-6">テストレポート</h3>
<p>description: この章では、ユニットテストとシナリオテストについて解説します。
—</p>

<p>参考：<a href="http://developer.android.com/tools/testing/testing_android.html">Testing Fundamentals | Android Developers</a><br />
参考：<a href="http://developer.android.com/tools/testing/activity_testing.html">Activity Testing | Android Developers</a><br />
参考：<a href="http://developer.android.com/tools/testing/service_testing.html">Service Testing | Android Developers</a><br />
参考：<a href="http://developer.android.com/tools/testing/contentprovider_testing.html">Content Provider Testing | Android Developers</a><br />
参考：<a href="http://developer.android.com/tools/testing/testing_ui.html">UI Testing | Android Developers</a> <br />
参考：<a href="http://developer.android.com/tools/testing/what_to_test.html">What To Test | Android Developers</a><br />
参考：<a href="http://developer.android.com/tools/help/uiautomator/index.html">uiautomator | Android Developers</a></p>

<h2 id="section-7">目次</h2>

<ul>
  <li><a href="#テストプロジェクトの作成">テストプロジェクトの作成</a></li>
  <li><a href="#ユニットテスト">ユニットテスト</a>
    <ul>
      <li><a href="#AndroidTestCase">AndroidTestCase</a></li>
      <li><a href="#ProviderTestCase">ProviderTestCase</a></li>
      <li><a href="#ServiceTestCase">ServiceTestCase</a></li>
      <li><a href="#MockContext">MockContext</a></li>
      <li><a href="#MockContentResolver と MockContentProvider">MockContentResolver と MockContentProvider</a></li>
      <li><a href="#テストの実行">テストの実行</a></li>
    </ul>
  </li>
  <li><a href="#シナリオテスト">シナリオテスト</a>
    <ul>
      <li><a href="#ActivityInstrumentationTestCase">ActivityInstrumentationTestCase</a></li>
      <li><a href="#Robotium">Robotium</a></li>
      <li><a href="#UIAutomator">UIAutomator</a></li>
    </ul>
  </li>
</ul>

<h2 id="section-8">テストプロジェクトの作成</h2>

<p>Android では、アプリ本体のプロジェクトと、テストケース用のプロジェクトが分離されています。<br />
テストプロジェクトのセットアップは、Eclipse 上から実行することができます。</p>

<p>File &gt; New から、Project… または Other… を選択してください（<code class="highlighter-rouge">Ctrl + N</code> または <code class="highlighter-rouge">Command + N</code>）。</p>

<p>新規プロジェクトの画面から、Android &gt; Android Test Project を選択します。</p>

<p><img src="/AndroidTraining/assets/02-11/test-project-wizard-begin.png" alt="Launch Test Project Wizard" /></p>

<p>次に、テストプロジェクトのセットアップをします。<br />
テストプロジェクトの名前と、配置場所を指定します。</p>

<p><img src="/AndroidTraining/assets/02-11/test-project-config.png" alt="Test Project Configuration" /></p>

<p>次に、テストのターゲットとするアプリ本体のプロジェクトを選択します。</p>

<p><img src="/AndroidTraining/assets/02-11/test-project-target-selection.png" alt="Select target" /></p>

<p>最後に、テストプロジェクトが利用する SDK のバージョンを選択して完了です。</p>

<p><img src="/AndroidTraining/assets/02-11/test-project-sdk-dependency.png" alt="Select SDK Version" /></p>

<p>このテストプロジェクトを用いて、ユニットテストや、シナリオテストを記述していきます。</p>

<h2 id="section-9">ユニットテスト</h2>

<p>Android では、フレームワーク自身がユニットテストのフレームワークを持っています。<br />
このフレームワークは、JUnit3 をベースにしています。</p>

<p>テスト対象に応じて、独自に拡張されたテストケースクラスが用意されています。</p>

<h3 id="androidtestcase">AndroidTestCase</h3>

<p>一般的な、Android のテストケースクラスです。<br />
<code class="highlighter-rouge">Context</code>、特に<code class="highlighter-rouge">Activity</code>の<code class="highlighter-rouge">Context</code>を必要とするクラスのテストをするために作られています。<br />
これによって、リソースへのアクセスも可能となっています。</p>

<p>テストケースは、メソッドごとに定義します。<br />
この時、メソッド名の命名規則として、先頭に必ず<code class="highlighter-rouge">test</code>と記述する必要があります(JUnit3 の仕様)。<br />
また、テストケースは、記述した順に実行されるとは限りません。</p>

<p>テストケースを実行するごとに、前準備と後始末をするためのメソッドも用意されています。<br />
それぞれ、事前準備をするメソッドは<code class="highlighter-rouge">AndroidTestCase#setUp()</code>、後始末をするメソッドは<code class="highlighter-rouge">AndroidTestCase#tearDown()</code>です。<br />
特に、テスト内でファイル I/O やデータベース接続などのリソースを扱う場合は、後始末をする<code class="highlighter-rouge">tearDown()</code>で、必ずリソースのクローズを行うようにします。</p>

<p>以下に、テストのターゲットとするクラスのサンプルと、そのターゲットをテストするサンプルを示します。</p>

<pre><code class="language-Java">public class SampleTestTarget1 {
    public int add(int left, int right) {
        return left + right;
    }

    public int div(int left, int right) {
        if (right == 0) throw new IllegalArgumentException("right operand must not be zero.");
        return left / right;
    }
}
</code></pre>

<pre><code class="language-Java">public class MyTestCase extends AndroidTestCase {
    // テストの前準備のメソッド。テストケースの実行ごとに呼ばれる。
    // 事前準備中に何らかの例外が起こる可能性があるので、例外をスローする宣言をする。
    @Override
    protected void setUp() throws Exception {
        super.setUp();
    }

    // テストの後始末のメソッド。テストケースの実行ごとに呼ばれる。
    // 後始末中に何らかの例外が起こる可能性があるので、例外をスローする宣言をする。
    @Override
    protected void tearDown() throws Exception {
        super.tearDown();
    }

    // テストケース本体。名前は必ず test から始まる
    // テスト中に異常が発生した場合（=例外がスローされた場合）、テストを Fail とするためその例外をそのまま投げるようにする
    public void testAdd() throws Exception {
        SampleTestTarget1 target = new SampleTestTarget1();

        // 第 1 引数 に期待値、第 2 引数に実際の計算を入れて、等しいかどうか比較する
        assertEquals(2, target.add(1, 1));
        assertEquals(3, target.add(1, 2));
        assertEquals(4, target.add(2, 2));
    }

    public void testDivide() throws Exception {
        SampleTestTarget1 target = new SampleTestTarget1();

        assertEquals(2, target.div(4, 2));
        try {
            target.div(1, 0);
            // 期待した例外が来ない場合、強制的に Fail する
            fail("no argument checking!?");
        } catch (IllegalArgumentException e) {
            // 例外をテストする場合。
            // テストしたい例外のみをキャッチして、それ以外は throws 宣言で Fail 扱いとする
            // テストしたい例外をキャッチした上で、何もしなければ Pass 扱いとなる
        }
    }
}
</code></pre>

<p>テストで利用する、検証用のメソッドは以下のようなものがあります。<br />
引数を 2 つとるメソッドは、第 1 引数が期待する値、第 2 引数が実際にテスト対象を呼び出した結果を渡すようにします。</p>

<table>
  <thead>
    <tr>
      <th>メソッド</th>
      <th>用途</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">assertEquals()</code></td>
      <td>第 1 引数と第 2 引数が等しいかどうか</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">assertNull()</code></td>
      <td>引数のオブジェクトが<code class="highlighter-rouge">null</code>かどうか</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">assertNotNull()</code></td>
      <td>引数のオブジェクトが<code class="highlighter-rouge">null</code>でないかどうか</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">assertTrue()</code></td>
      <td>引数の<code class="highlighter-rouge">boolean</code>が<code class="highlighter-rouge">true</code>かどうか</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">assertFalse()</code></td>
      <td>引数の<code class="highlighter-rouge">boolean</code>が<code class="highlighter-rouge">false</code>かどうか</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">assertSame()</code></td>
      <td>第 1 引数と第 2 引数が、同じオブジェクトを参照しているかどうか</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">assertNotSame()</code></td>
      <td>第 1 引数と第 2 引数が、同じオブジェクトを参照していないかどうか</td>
    </tr>
  </tbody>
</table>

<p>これらは、JUnit3 由来の検証メソッドですが、これら以外にも検証の手段が提供されています。</p>

<p><a href="http://developer.android.com/reference/android/test/MoreAsserts.html">MoreAsserts | AndroidDevelopers</a><br />
<a href="http://developer.android.com/reference/android/test/ViewAsserts.html">ViewAsserts | AndroidDevelopers</a></p>

<h3 id="providertestcase">ProviderTestCase</h3>

<p><code class="highlighter-rouge">ContentProvider</code>のためのテストケースです。<br />
テスト用に、モックの<code class="highlighter-rouge">Context</code>を利用してテストを行います。</p>

<p>テストを実行すると、テスト用に本体とは分離された<code class="highlighter-rouge">Context</code>のもと、データベース等もすべてテスト向けに特別なものが用意されます。<br />
このため、本体で利用するデータベースへの影響はありません。</p>

<p><code class="highlighter-rouge">ContentProvider</code>のテストでは、<code class="highlighter-rouge">query</code>や<code class="highlighter-rouge">insert</code>、<code class="highlighter-rouge">update</code>、<code class="highlighter-rouge">delete</code>、<code class="highlighter-rouge">getType</code>、<code class="highlighter-rouge">onCreate</code>の動作を保証しておくことが必要です。また、不正なパラメータが与えられた場合などの異常系のテストも必要です。<br />
加えて、<code class="highlighter-rouge">ContentProvider</code>を外部向けにエクスポートする場合、アクセスに利用する<code class="highlighter-rouge">Uri</code>についての正常系と異常系のテストを含めておくことが求められます。</p>

<pre><code class="language-Java">// ProviderTestCase ではなく ProviderTestCase2 を継承すること
public class SampleContentProviderTestCase extends ProviderTestCase2&lt;TestTargetContentProvider&gt; {
    private Context mMockContext;

    public SampleContentProviderTestCase() {
        this(TestTargetContentProvider.class, TestTargetContentProvider.AUTHORITY);
    }

    public SampleContentProviderTestCase(Class&lt;TestTargetContentProvider&gt; providerClass, String providerAuthority) {
        super(providerClass, providerAuthority);
    }

    @Override
    protected void setUp() throws Exception {
        super.setUp();

        mMockContext = getMockContext();
    }

    public void testInsertNewText() throws Exception {
        // モックされたコンテキストから、ContentResolver を取り出し、それを経由してデータベースへとアクセスする
        // テストからアクセスする場合、毎回データベースが作りなおされるため、後始末としてテストで利用したデータを消すなどは必要ない
        // また、データベースそのものも、テスト用のものが作成されるため、本体のデータベースには影響を及ぼさないようになっている
        ContentResolver resolver = mMockContext.getContentResolver();
        ContentValues values = new ContentValues();
        values.put("name", "KeithYokoma");
        Uri newUri = resolver.insert(TestTargetContentProvider.CONTENT_URI, values);
        assertNotNull(newUri);
        assertEquals(ContentUris.withAppendedId(TestTargetContentProvider.CONTENT_URI, 1), newUri);
    }
}
</code></pre>

<h3 id="servicetestcase">ServiceTestCase</h3>

<p><code class="highlighter-rouge">Service</code>のためのテストケースです。<br />
<code class="highlighter-rouge">Service</code>が期待通りのライフサイクルで動作することを保証するためのテストを記述します。</p>

<pre><code class="language-Java">public class SampleServiceTestCase extends ServiceTestCase&lt;TestTargetService&gt; {
    public SampleServiceTestCase() {
        this(TestTargetService.class);
    }

    public SampleServiceTestCase(Class&lt;TestTargetService&gt; serviceClass) {
        super(serviceClass);
    }

    public void testStartingProperly() throws Exception {
        // サービスを問題なく開始できること
        // 何かあれば例外が飛ぶこともチェック
        startService(new Intent(getContext(), TestTargetService.class));
    }

    public void testBinding() throws Exception {
        // 開始するサービスの場合で、バインドをサポートしない場合は、bindService の返り値が null となるので、それをチェック
        IBinder binder = bindService(new Intent(getContext(), TestTargetService.class));
        assertNull(binder);
    }
}
</code></pre>

<h3 id="mockcontext">MockContext</h3>

<p><code class="highlighter-rouge">Context</code>をモックするための仕組みとして、<code class="highlighter-rouge">MockContext</code>クラスが用意されています。<br />
このクラス自身は、どのメソッドを読んでも、<code class="highlighter-rouge">UnsupportedOperationException</code>を投げるだけになっており、自分でモックしたい部分や、モックすべき部分を、<code class="highlighter-rouge">MockContext</code>を継承して記述し、各テストケースクラスで、その<code class="highlighter-rouge">Context</code>を注入して使います。</p>

<pre><code class="language-Java">public class SampleTestTarget2 {
    public void startSubActivity(Context context, String hogeExtra) {
        Intent intent = new Intent(context, SubActivity.class);
        intent.putExtra("hoge", hogeExtra);
        context.startActivity(intent);
    }
}
</code></pre>

<pre><code class="language-Java">public class SampleTestTarget2TestCase extends AndroidTestCase {
    @Override
    protected void setUp() throws Exception {
        super.setUp();
    }

    @Override
    protected void tearDown() throws Exception {
        super.tearDown();
    }

    // startSubActivity() を呼び出すテスト
    public void testStartSubActivity() throws Exception {
        SampleTestTarget2 target = new SampleTestTarget2();
        // AndroidTestCase が持っている ActivityContext ではなく、自分でモックした Context
        target.startSubActivity(new SampleTestTarget2Context(getContext()), "hogehoge");
    }

    // Context#startActivity() が、期待通りのコンポーネントに Intent を投げているかテストするための
    // MockContext
    private static class SampleTestTarget2Context extends MockContext {
        private Context mContext;

        public SampleTestTarget2Context(Context baseContext) {
            mContext = baseContext;
        }

        @Override
        public String getPackageName() {
            return mContext.getPackageName();
        }

        @Override
        public void startActivity(Intent intent) {
            // Intent から、Intent の送り先のコンポーネント情報を取り出して、期待値と一致するか確認する
            ComponentName component = intent.getComponent();
            assertEquals(SubActivity.class.getCanonicalName(), component.getClassName());
            // Extra に期待するものが有るか確認する
            assertTrue(intent.hasExtra("hoge"));
            assertEquals("hogehoge", intent.getStringExtra("hoge"));
        }
    }
}
</code></pre>

<h3 id="mockcontentresolver--mockcontentprovider">MockContentResolver と MockContentProvider</h3>

<p><code class="highlighter-rouge">ContentProvider</code>のデータを元にしたモデルや、<code class="highlighter-rouge">Activity</code>のテストを行う際、実際のデータを用いてしまうと、デバイスによってテストがうまくいく場合とうまくいかない場合が出来てしまいます。<br />
これを回避するため、<code class="highlighter-rouge">ContentProvider</code>への問い合わせの際に、直接<code class="highlighter-rouge">ContentProvider</code>を使用せず、テスト用に定義したモックのデータを返すようにするものが、<code class="highlighter-rouge">MockContentResolver</code>と<code class="highlighter-rouge">MockContentProvider</code>です。</p>

<p><code class="highlighter-rouge">ContentResolver</code>は、<code class="highlighter-rouge">ContentProvider</code>へのアクセスの窓口となるものですので、テスト対象のクラスで、自分で定義した<code class="highlighter-rouge">MockContentProvider</code>へアクセスするように設定します。</p>

<p><code class="highlighter-rouge">query()</code>メソッドによる<code class="highlighter-rouge">Cursor</code>オブジェクトの取得をモックする際には、<code class="highlighter-rouge">MatrixCursor</code>クラスを使用します。<br />
<code class="highlighter-rouge">MatrixCursor</code>クラスによって、仮想のカラムとデータを<code class="highlighter-rouge">Cursor</code>オブジェクトに詰め込むことが出来るようになります。</p>

<p>以下に、テスト対象のコードと、それに対応するテストコードを示します。</p>

<pre><code class="language-Java">public class SampleTestTarget3 {
    // DB に問い合わせた結果を、適宜データ構造に当てはめてオブジェクトを作って、リストで返すメソッド
    public List&lt;SampleDBEntity&gt; getAllListFromDB(Context context) {
        List&lt;SampleDBEntity&gt; list = new ArrayList&lt;SampleDBEntity&gt;();

        ContentResolver resolver = context.getContentResolver();
        Cursor c = null;
        try {
            c = resolver.query(TestTargetContentProvider.CONTENT_URI, new String[] { BaseColumns._ID, "name" }, null, null, null);
            // 結果があれば、ポインタを先頭に移動してから処理を始める
            if (c.moveToFirst()) {
                do {
                    // Cursor からデータを取り出してインスタンスを作ってリストに詰める、1 回以上の繰り返し
                    int id = c.getInt(c.getColumnIndex(BaseColumns._ID));
                    String name = c.getString(c.getColumnIndex("name"));
                    list.add(new SampleDBEntity(id, name));
                } while (c.moveToNext());
            }
        } finally {
            // リソースを閉じる
            if (c != null) {
                c.close();
            }
        }
        return list;
    }
}
</code></pre>

<pre><code class="language-Java">public class SampleTestTarget3TestCase extends AndroidTestCase {
    public void testGetAllList() throws Exception {
        SampleTestTarget3 target = new SampleTestTarget3();
        List&lt;SampleDBEntity&gt; list = target.getAllListFromDB(new SampleMockContext(getContext()));
        assertNotNull(list);
        MoreAsserts.assertNotEmpty(list);
        assertEquals(3, list.size());

        {
            SampleDBEntity entity = list.get(0);
            assertEquals(1, entity.getId());
            assertEquals("KeithYokoma", entity.getName());
        }

        {
            SampleDBEntity entity = list.get(1);
            assertEquals(2, entity.getId());
            assertEquals("HogeFugao", entity.getName());
        }

        {
            SampleDBEntity entity = list.get(2);
            assertEquals(3, entity.getId());
            assertEquals("HiyoHiyo", entity.getName());
        }
    }

    // モックの本体。ContentProvider そのものをモックしてしまう。
    // モックしたいメソッドを適宜オーバライドすること。
    private static class SampleMockContentProvider extends MockContentProvider {
        @Override
        public Cursor query(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder) {
            // クエリ結果のモック作成
            // MatrixCursor を用いてデータをモックする
            MatrixCursor cursor = new MatrixCursor(projection);
            cursor.addRow(new String[] {"1", "KeithYokoma"});
            cursor.addRow(new String[] {"2", "HogeFugao"});
            cursor.addRow(new String[] {"3", "HiyoHiyo"});
            return cursor;
        }

        @Override
        public void attachInfo(Context context, ProviderInfo info) {
        }
    }

    private static class SampleMockContentResolver extends MockContentResolver {
        public SampleMockContentResolver(Context context) {
            // モックの ContentProvider へアクセスしに行くよう設定する
            ContentProvider provider = new SampleMockContentProvider();

            // AndroidManifest に記述する ContentProvider の宣言をここで動的に行う
            ProviderInfo info = new ProviderInfo();
            info.authority = TestTargetContentProvider.AUTHORITY;
            info.enabled = true;
            info.packageName = TestTargetContentProvider.class.getPackage().getName();

            provider.attachInfo(context, info);

            // ContentProvider を追加する
            addProvider(TestTargetContentProvider.AUTHORITY, provider);
        }
    }

    private static class SampleMockContext extends MockContext {
        private Context mContext;

        public SampleMockContext(Context context) {
            mContext = context;
        }

        // コンテキストをモックして、独自の MockContentResolver を返すようにしてしまう
        @Override
        public ContentResolver getContentResolver() {
            return new SampleMockContentResolver(mContext);
        }
    }
}
</code></pre>

<p>このようにすることで、データベースのデータそのものが分離されるので、テストケースでは、テスト対象のビジネスロジックをテストできるようになります。</p>

<h3 id="section-10">テストの実行</h3>

<p>実行したいテストクラスを選択して、テストを実行します。</p>

<p>右クリックメニューから、Run As &gt; Android JUnit Test を選択すると、自動でターゲットプロジェクトとテストプロジェクトをそれぞれビルドし、ターゲットプロジェクトの apk とテストプロジェクトの apk をインストールし、テストが動き始めます。</p>

<p>テストが動き始めると、順次テスト結果が表示されます。</p>

<p><img src="/AndroidTraining/assets/02-11/junit-test-result.png" alt="JUnit Test Result" /></p>

<p>すべて成功すると、緑色のインディケータが表示されます。<br />
なにか 1 つでも失敗したケースがあると、その時点でインディケータの色が紺色になります。</p>

<p>また、実行したテストケースの一覧も表示されます。<br />
この一覧のなかで、成功・失敗の表示がありますので、どのテストケースが成功・失敗したかが分かるようになっています。</p>

<h2 id="section-11">シナリオテスト</h2>

<p>ユニットテストでは、各クラス（特にモデルのクラス）が適切な振る舞いをするかどうかをテストしました。<br />
シナリオテストでは、ボタンを押したり、画面を回転した時に、アプリがどのように振る舞うかをテストします。<br />
これを機能テストとも呼んだりしています。</p>

<h3 id="activityinstrumentationtestcase">ActivityInstrumentationTestCase</h3>

<p>Activity に対して、テストプロジェクトから様々な操作を行うためのテストケースクラスです。</p>

<p>実行すると、実際に実機やエミュレータ上で画面が立ち上がり、自動で UI の操作が行われます。</p>

<p>UI の操作は、立ち上げた<code class="highlighter-rouge">Activity</code>のインスタンスを通して、レイアウトのリソースから<code class="highlighter-rouge">View</code>オブジェクトを取り出して操作をするものと、キーイベントのように <a href="http://developer.android.com/reference/android/app/Instrumentation.html">Instrumentation</a> を通して操作するものがあります。</p>

<p>View のタッチイベントを再現するためのライブラリとして、<a href="http://developer.android.com/reference/android/test/TouchUtils.html">TouchUtils</a> が用意されています。</p>

<pre><code class="language-Java">// ActivityInstrumentationTestCase2 を継承して、機能テストを書く
public class SampleActivityInstrumentationTestCase extends
        ActivityInstrumentationTestCase2&lt;MainActivity&gt; {
    public SampleActivityInstrumentationTestCase() {
        this(MainActivity.class);
    }

    public SampleActivityInstrumentationTestCase(Class&lt;MainActivity&gt; activityClass) {
        super(activityClass);
    }

    public void testCountUpScenario() throws Exception {
        // getActivity() の呼び出しで、テスト対象の Activity が立ち上がる
        Activity activity = getActivity();

        // UI 操作による View の状態を見るために、View のインスタンスを取り出す
        TextView counter = (TextView) activity.findViewById(R.id.ClickCounter);
        Button button = (Button) activity.findViewById(R.id.CountEventTrigger);

        // 最初は 0
        assertEquals("0", counter.getText().toString());

        // ボタンのクリックをシミュレート
        TouchUtils.clickView(this, button);

        // クリックしたら、カウンタの値がインクリメントされる
        assertEquals("1", counter.getText().toString());
        TouchUtils.clickView(this, button);

        // もう一度クリック
        assertEquals("2", counter.getText().toString());

        // 画面回転する
        activity.setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE);
        Thread.sleep(1000L);

        // クリック回数が引き継がれているはず
        assertEquals("2", counter.getText().toString());
    }

    public void testCallSubActivityAndReturn() throws Exception {
        Activity activity = getActivity();

        // UI 操作による View の状態を見るために、View のインスタンスを取り出す
        TextView counter = (TextView) activity.findViewById(R.id.ClickCounter);
        Button button = (Button) activity.findViewById(R.id.CountEventTrigger);
        Button button2 = (Button) activity.findViewById(R.id.CallSubActivity);

        // 最初は 0
        assertEquals("0", counter.getText().toString());

        // ボタンのクリックをシミュレート
        TouchUtils.clickView(this, button);

        // クリックしたら、カウンタの値がインクリメントされる
        assertEquals("1", counter.getText().toString());

        // Activity の起動を監視する（厳密には Intent を監視する）オブジェクトを作る
        ActivityMonitor monitor = new ActivityMonitor(SubActivity.class.getCanonicalName(), null, true);
        // 監視オブジェクトを登録
        getInstrumentation().addMonitor(monitor);

        // Launch SubActivity をクリック
        TouchUtils.clickView(this, button2);

        // 起動を待つ
        Activity newActivity = getInstrumentation().waitForMonitorWithTimeout(monitor, 3000L);
        // 1 つの Activity が起動しているはず
        assertEquals(1, monitor.getHits());

        // 終わる
        if (newActivity != null)
            newActivity.finish();

        // 戻ってきても状態が復帰できるはず
        assertEquals("1", counter.getText().toString());
    }
}
</code></pre>

<h3 id="robotium">Robotium</h3>

<p><code class="highlighter-rouge">ActivityInstrumentationTestCase</code>だけでは足りない、より幅広い UI のテストをするためのフレームワークです。</p>

<p><code class="highlighter-rouge">ActivityInstrumentationTestCase</code>では、レイアウトの実装を知っている必要がありましたが、Robotium では、この部分もブラックボックス化することができるようになります。<br />
Android ネイティブアプリ版の Selenium とも呼ばれています。</p>

<p><a href="https://code.google.com/p/robotium/">robotium - The world’s leading Android™ test automation framework …</a></p>

<p>Robotium は、jar 形式のライブラリとなっており、テストプロジェクトに<code class="highlighter-rouge">libs</code>ディレクトリを作成して、その中に Robotium の jar を格納することで使用可能となります。</p>

<p>Robotium では、レイアウトの実装をテストから分離するため、<code class="highlighter-rouge">Solo</code>と呼ばれる窓口を介して UI を操作します。<br />
本来は UI スレッド上で UI 操作をするための記述をする必要のある部分を、すべて<code class="highlighter-rouge">Solo</code>オブジェクトが担ってくれることと、レイアウトの実装を知らなくても、ボタンを押したり、メニューを表示したり、長押ししたりと言ったインタラクションが簡単に記述できることから、<code class="highlighter-rouge">ActivityInstrumentationTestCase2</code>よりもブラックボックスなテストが可能です。<br />
また、複数の<code class="highlighter-rouge">Activity</code>に渡るシナリオテストも、<code class="highlighter-rouge">ActivityMonitor</code>を利用するより非常に簡単に記述できるようになっています。</p>

<pre><code class="language-Java">// Solo クラスを import
import com.jayway.android.robotium.solo.Solo;

// 継承するものは、ActivityInstrumentationTestCase2
public class SampleRobotiumTestCase extends ActivityInstrumentationTestCase2&lt;MainActivity&gt; {
    public SampleRobotiumTestCase() {
        this(MainActivity.class);
    }

    public SampleRobotiumTestCase(Class&lt;MainActivity&gt; activityClass) {
        super(activityClass);
    }

    public void testCountUpScenario() throws Exception {
        Activity activity = getActivity();

        // Robotium ライブラリのコアで、UI の操作の窓口となるオブジェクト
        Solo solo = new Solo(getInstrumentation(), activity);

        // MainActivity が立ち上がってフォアグラウンドにいる
        solo.assertCurrentActivity("MainActivity now.", MainActivity.class);

        // カウンタの数字が 0 であることを確認する
        // 0 と書かれた TextView を画面上から探し出し、あればその TextView オブジェクトを返すメソッド
        assertTrue(solo.searchText("0"));

        // Count up と書かれたボタンをクリックする (View の id を知る必要はない)
        solo.clickOnButton("Count up");

        // 0 と書かれた TextView はなくなり、1 と書かれたTextView になるはず
        assertFalse(solo.searchText("0"));
        assertTrue(solo.searchText("1"));

        solo.clickOnButton("Count up");

        assertFalse(solo.searchText("1"));
        assertTrue(solo.searchText("2"));

        // 横画面に回転する
        solo.setActivityOrientation(Solo.LANDSCAPE);

        // 状態が保存され、2 と書かれた TextView が引き続き居るはず
        assertTrue(solo.searchText("2"));
    }

    public void testCallSubActivityAndReturn() throws Exception {
        Activity activity = getActivity();

        Solo solo = new Solo(getInstrumentation(), activity);

        // MainActivity が立ち上がってフォアグラウンドにいる
        solo.assertCurrentActivity("MainActivity now.", MainActivity.class);

        // カウンタの数字が 0 であることを確認する
        // 0 と書かれた TextView を画面上から探し出し、あればその TextView オブジェクトを返すメソッド
        assertTrue(solo.searchText("0"));

        // Count up と書かれたボタンをクリックする (View の id を知る必要はない)
        solo.clickOnButton("Count up");

        // 0 と書かれた TextView はなくなり、1 と書かれたTextView になるはず
        assertFalse(solo.searchText("0"));
        assertTrue(solo.searchText("1"));

        // Launch SubActivity ボタンを押す
        solo.clickOnButton("Launch SubActivity");

        // SubActivity が起動し、フォアグラウンドに居るはず
        solo.assertCurrentActivity("SubActivity now.", SubActivity.class);

        // メニューキーを押した
        solo.sendKey(KeyEvent.KEYCODE_MENU);
        // ActionBarを使っているなら、以下でも良い
        // solo.clickOnActionBarItem(0);

        // 戻る
        solo.getCurrentActivity().finish();

        // 状態復帰できているはず
        assertTrue(solo.searchText("1"));
    }
}
</code></pre>

<h3 id="uiautomator">UIAutomator</h3>

<p>ADT リビジョン 21 以降から導入され、Android 4.1 以降で動作するように作られた、UI のテストフレームワークです。<br />
Android SDK に含まれています。</p>

<h4 id="section-12">プロジェクトのセットアップ</h4>

<p>UIAutomator を使ったプロジェクトの作成は、Android 用プロジェクトではなく、Java 用プロジェクトとして作成します。</p>

<p><img src="/AndroidTraining/assets/02-11/new_uiautomator_project.png" alt="New Java Project Wizard" /></p>

<p>次に、テストプロジェクトで利用するライブラリのセットアップを行います。</p>

<p><img src="/AndroidTraining/assets/02-11/add_libraries.png" alt="Library Configuration" /></p>

<p>Libraries タブから、Add Libraries… を選択し、表示されたダイアログから、JUnit を選択します。</p>

<p><img src="/AndroidTraining/assets/02-11/add_junit.png" alt="Add JUnit" /></p>

<p>バージョンを聞かれるので、JUnit3 を選択します。</p>

<p><img src="/AndroidTraining/assets/02-11/select_junit_version.png" alt="Select JUnit Version" /></p>

<p>次に、Add External Jars… から、android.jar と uiautomator.jar をピックアップします。<br />
この 2 つは、SDK のディレクトリ以下の<code class="highlighter-rouge">platforms/android-16/</code>または<code class="highlighter-rouge">platforms/android-17</code>ディレクトリに配置されています。</p>

<p><img src="/AndroidTraining/assets/02-11/pick_external_jars.png" alt="External Jars" /></p>

<p>選択したら、このような画面になるはずです。</p>

<p><img src="/AndroidTraining/assets/02-11/library_config_done.png" alt="Configuration Done" /></p>

<p>次に、コマンドラインから、UIAutomator のプロジェクトディレクトリへ移動し、下記のコマンドを実行します。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ android create uitest-project -p UIAutomatorSample -n UIAutomatorSample -t 21
Added file UIAutomatorSample/build.xml
</code></pre>
</div>

<p>以上で、プロジェクトのセットアップは終了です。</p>

<h4 id="section-13">テストの作成</h4>

<p><code class="highlighter-rouge">UiAutomatorTestCase</code>を継承して、テストケースクラスを作ります。<br />
JUnit3 をベースとするため、テストケースのメソッド定義は他のテストケースと同様な命名規則に従います。</p>

<pre><code class="language-Java">// 端末ホーム画面からアプリを起動して操作するテスト
public class MainActivityAutomatorTestCase extends UiAutomatorTestCase {
    public void testMainActivityButtonClick() throws Exception {
        // デバイスオブジェクトの取得。このオブジェクトを介して、デバイスの状態を取得したり、UI の操作を行ったりする。
        UiDevice device = getUiDevice();

        // ホームボタンを押す
        device.pressHome();

        // ホームボタンに有るターゲットのアイコンをタップする
        UiObject launchIcon = new UiObject(new UiSelector().textContains("TestTarget"));
        launchIcon.clickAndWaitForNewWindow();

        // 起動した（指定したパッケージ名のアプリがフォアグラウンドに居て、オブジェクトの取得が無事に出来る）
        UiObject app = new UiObject(new UiSelector().packageName("jp.mixi.sample.test"));
        assertTrue(app.exists());

        device.pressBack();

        // もう一度タップ
        UiObject launchIcon2 = new UiObject(new UiSelector().textContains("TestTarget"));
        launchIcon2.clickAndWaitForNewWindow();

        // カウンターの初期値は 0
        UiObject firstCounterState = new UiObject(new UiSelector().text("0"));
        assertTrue(firstCounterState.exists());

        // カウントアップ
        UiObject countUp = new UiObject(new UiSelector().text("Count up"));
        countUp.click();

        // カウンターが更新される
        UiObject secondCounterState = new UiObject(new UiSelector().text("1"));
        assertTrue(secondCounterState.exists());
    }
}
</code></pre>

<h4 id="section-14">テストの実行</h4>

<p>テストプロジェクトの中で、下記のコマンドを実行します。</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ant build
Buildfile: /Path/To/UIAutomatorTestProject/build.xml

-check-env:
 <span class="o">[</span>checkenv] Android SDK Tools Revision 21.1.0
 <span class="o">[</span>checkenv] Installed at /Path/To/android-sdk-macosx

-build-setup:
     <span class="o">[</span><span class="nb">echo</span><span class="o">]</span> Resolving Build Target <span class="k">for </span>UIAutomatorTestProject...
<span class="o">[</span>getuitarget] Project Target:   Android 4.2.2
<span class="o">[</span>getuitarget] API level:        17
     <span class="o">[</span><span class="nb">echo</span><span class="o">]</span> ----------
     <span class="o">[</span><span class="nb">echo</span><span class="o">]</span> Creating output directories <span class="k">if </span>needed...
    <span class="o">[</span>mkdir] Created dir: /Path/To/UIAutomatorTestProject/bin/classes

-pre-compile:

compile:
    <span class="o">[</span>javac] Compiling 1 <span class="nb">source </span>file to /Path/To/UIAutomatorTestProject/bin/classes

-post-compile:

-dex:
      <span class="o">[</span>dex] input: /Path/To/UIAutomatorTestProject/bin/classes
      <span class="o">[</span>dex] Converting compiled files and external libraries into /Path/To/UIAutomatorTestProject/bin/classes.dex...

-post-dex:

-jar:
      <span class="o">[</span>jar] Building jar: /Path/To/UIAutomatorTestProject/bin/UIAutomatorTestProject.jar

-post-jar:

build:

BUILD SUCCESSFUL
Total <span class="nb">time</span>: 2 seconds
</code></pre>
</div>

<p>コマンドを実行すると、プロジェクトディレクトリ以下の<code class="highlighter-rouge">bin/</code>ディレクトリの中に、jar ファイルが生成されます。</p>

<p>次に、この jar ファイルをデバイスへ転送し、デバイス上で jar を実行します。</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>adb push UIAutomatorTestProject.jar /data/local/tmp
<span class="gp">$ </span>adb shell uiautomator runtest UIAutomatorTestProject.jar -c jp.mixi.sample.test.automator.MainActivityAutomatorTestCase
</code></pre>
</div>

<p>すると、画面がひとりでに動き始め、コンソールにテスト結果が出力されるようになります。</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>INSTRUMENTATION_STATUS: <span class="nv">current</span><span class="o">=</span>1
INSTRUMENTATION_STATUS: <span class="nv">id</span><span class="o">=</span>UiAutomatorTestRunner
INSTRUMENTATION_STATUS: <span class="nv">class</span><span class="o">=</span>jp.mixi.sample.test.automator.MainActivityAutomatorTestCase
INSTRUMENTATION_STATUS: <span class="nv">stream</span><span class="o">=</span>
jp.mixi.sample.test.automator.MainActivityAutomatorTestCase:
INSTRUMENTATION_STATUS: <span class="nv">numtests</span><span class="o">=</span>1
INSTRUMENTATION_STATUS: <span class="nb">test</span><span class="o">=</span>testMainActivityButtonClick
INSTRUMENTATION_STATUS_CODE: 1
INSTRUMENTATION_STATUS: <span class="nv">current</span><span class="o">=</span>1
INSTRUMENTATION_STATUS: <span class="nv">id</span><span class="o">=</span>UiAutomatorTestRunner
INSTRUMENTATION_STATUS: <span class="nv">class</span><span class="o">=</span>jp.mixi.sample.test.automator.MainActivityAutomatorTestCase
INSTRUMENTATION_STATUS: <span class="nv">stream</span><span class="o">=</span>.
INSTRUMENTATION_STATUS: <span class="nv">numtests</span><span class="o">=</span>1
INSTRUMENTATION_STATUS: <span class="nb">test</span><span class="o">=</span>testMainActivityButtonClick
INSTRUMENTATION_STATUS_CODE: 0
INSTRUMENTATION_STATUS: <span class="nv">stream</span><span class="o">=</span>
Test results <span class="k">for </span><span class="nv">WatcherResultPrinter</span><span class="o">=</span>.
Time: 5.77

OK <span class="o">(</span>1 <span class="nb">test</span><span class="o">)</span>


INSTRUMENTATION_STATUS_CODE: -1
</code></pre>
</div>

<p>通常、<code class="highlighter-rouge">ActivityInstrumentationTestCase</code>等では、アプリの署名が合致しないものはテストができませんでしたが、UIAutomator では、署名に関係なく UI の操作をテストすることができます。<br />
これにより、例えば、他のアプリとの連携をする部分のテストも容易に記述できるようになります。</p>

<p>画面から UI の要素を取り出して操作するには、画面に表示されているレイアウトの階層構造をたどることの他、サンプルのように、表示されている文字列でたどったり、あるいは、View のクラス名 (FQDN) からたどったりすることで、要素を取り出して操作をすることが出来るようになっています。<br />
ImageView など文字列でたどれないものは、<code class="highlighter-rouge">android:contentDescription</code>属性を元に辿る手段もあります。</p>

<p>デバイス上で表示されている画面のレイアウト構造を見るための手段として、<code class="highlighter-rouge">uiautomatorviewer</code>というコマンドも用意されています。</p>

<h2 id="section-15">実習・課題</h2>

<ol>
  <li>(実習) 実習用のターゲットプロジェクトに配置された、TestTarget1 クラスに対応する AndroidTestCase を書いてください。</li>
  <li>(実習) 実習用のテストプロジェクトに配置された、TestPactice2 クラスのテストを通るクラスを、ターゲットプロジェクトに作成してください。</li>
  <li>(実習) 実習用のターゲットプロジェクトに配置された、TestTarget3 クラスに対応する ActivityInstrumentationTestCase2 を書いてください。</li>
  <li>(課題) 課題用のテストプロジェクトに配置された、MainActivityInstrumentationTestCase クラスのテストを通る MainActivity を、ターゲットプロジェクトに作成してください。</li>
  <li>(課題) 4 の課題で使用するテストケースを、Robotium を用いて記述してください。</li>
  <li>(課題) 4 の課題で使用するテストケースを、UIAutomator を用いて記述してください。</li>
</ol>

          </section>
        </div>

        <!-- FOOTER  -->
        <div id="footer_wrap" class="outer">
          <footer class="inner">
  <p class="license">Portions of this page are reproduced from work created and <a href="https://code.google.com/p/android/">shared by the Android Open Source Project</a> and used according to terms described in the <a href="http://creativecommons.org/licenses/by/2.5/">Creative Commons2.5 Attribution License</a>.</p>
  <p class="license">
  This work is licensed under a <a rel="license" itemprop="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. 
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
  </p>
  <p class="copyright">Androidtraining maintained by <a href="https://github.com/mixi-inc" itemprop="author">mixi-inc</a></p>
  <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>

</footer>

        </div>
      </paper-scroll-header-panel>
    </paper-drawer-panel>
    <script>
        // custom transformation: scale header's title
        var title = document.querySelectorAll('.title')[2];
        addEventListener('paper-header-transform', function(e) {
            var d = e.detail;
            var m = d.height - d.condensedHeight;
            var scale = Math.max(0.75, (m - d.y) / (m / 0.25)  + 0.75);

            Polymer.Base.transform('scale(' + scale + ') translateZ(0)', title);
        });

    </script>
</body>
</html>
