<!DOCTYPE html>
<html lang="ja">

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="この章ではAndroidStudioでのユニットテストについて解説します。" />
    <meta name=viewport content="width=device-width, initial-scale=1">
    <!-- ogp for twitter -->
    <meta content="@mixi_engineers" name="twitter:site" />
    <meta content="summary" name="twitter:card" />
    
    <meta content="テスト(AndroidStudio) - mixi-inc/AndroidTraining" name="twitter:title" />
    
    <meta content="この章ではAndroidStudioでのユニットテストについて解説します。" name="twitter:description" />
    <meta content="/assets/logo.png" name="twitter:image:src" />
    <!-- ogp -->
    <meta content="mixi-inc/AndroidTraining" property="og:site_name" />
    <meta content="article" property="og:type" />
    <meta content="/assets/logo.png" property="og:image" />
    
    <meta content="テスト(AndroidStudio) - mixi-inc/AndroidTraining" name="og:title" />
    
    <meta content="/fundamentals/2.11.testing-for-android-studio.html" property="og:url" />
    <meta content="この章ではAndroidStudioでのユニットテストについて解説します。" property="og:description" />
    
    <meta name="keyword" content="android, training, 基礎, スキル, 開発, developer, プログラミング, test, UnitTest" />
    

    <meta name="go-import" content="github.com/mixi-inc/AndroidTraining git https://github.com/mixi-inc/AndroidTraining.git">
    <script src="/AndroidTraining/bower_components/webcomponentsjs/webcomponents.js"></script>
    
    <link rel="stylesheet" type="text/css" media="screen" href="/AndroidTraining/stylesheets/main.css">
    <link rel="shortcut icon" href="/AndroidTraining/assets/favicon.ico" />
    <link rel="import" href="/AndroidTraining/bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-drawer-panel/paper-drawer-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-header-panel/paper-header-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-toolbar/paper-toolbar.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-menu/paper-menu.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-item/paper-item.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="/AndroidTraining/bower_components/iron-icons/iron-icons.html">
    <style is="custom-style">
        paper-scroll-header-panel:not([style-scope]):not(.style-scope) {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        paper-toolbar.tall .bottom:not([style-scope]):not(.style-scope) {
            font-size: 40px;
            margin-left: 60px;

            -webkit-transform-origin: left center;
            transform-origin: left center;
        }

        .content:not([style-scope]):not(.style-scope) {
            padding: 8px;
        }

        .spacer:not([style-scope]):not(.style-scope) {
            -ms-flex: 1 1 0.000000001px;
            -webkit-flex: 1;
            flex: 1;
            -webkit-flex-basis: 0.000000001px;
            flex-basis: 0.000000001px;
        }

    </style>
    <title>テスト(AndroidStudio) - mixi-inc/AndroidTraining</title>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-50931519-13', 'auto');
    ga('send', 'pageview');
    </script>
  </head>

  <body itemscope itemtype="http://schema.org/Article" fullbleed layout vertical>

    <paper-drawer-panel selected="main" >
      <!-- MENU -->
      <paper-header-panel mode="seamed" drawer class="drawer">
        <nav>
    <ol class="chapter_navigation">
        <a href="/AndroidTraining/">Home</a>
        <li>まえがき</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/introductions/1.01.about-android-os.html">Android-OSについて</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.02.prepare-for-development.html">開発環境の準備</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.03.create-project-for-android-studio.html">プロジェクトの作成</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.04.basic-knowledge.html">Androidの基礎知識</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.05.how-to-build-for-gradle.html">Android のビルドについて(Gradle)</a></li>
            
        </ol>
        <li>基礎編</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/fundamentals/2.01.create-layout.html">アプリのレイアウト作成</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.02.activity-and-fragment.html">ActivityとFragment</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.03.application-resource-management.html">アプリのリソース管理</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.04.messaging-and-notification.html">メッセージングと通知</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.05.actionbar-and-interaction-control.html">AppBarとインタラクション制御</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.06.listView-and-viewPager.html">ListViewとViewPager</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.07.serialize-and-collection-and-perpetuation.html">直列化とコレクション、永続化</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.08.async-processing.html">非同期処理</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.09.network-access.html">ネットワーク通信</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.10.database.html">データベース</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.11.testing-for-android-studio.html">テスト(AndroidStudio)</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.11.testing.html">テスト</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.12.handler-and-looper.html">HandlerとLooper</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.13.webView.html">WebView</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.14.accountmanager.html">AccountManager</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.15.advance-contentprovider.html">ContentProviderの発展</a></li>
            
        </ol>
        <li>実務編</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/advanced/3.01.build-for-eclipse.html">デバッグと自動ビルド(Eclipse)</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.01.build-for-gradle.html">自動ビルド(Android Studio)</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.02.architecture-and-di.html">アーキテクチャ設計と DI</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.03.advanced-layout.html">続・アプリのレイアウト作成</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.04.user-interface.html">ユーザインタフェース設計</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.05.security.html">セキュリティ</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.06.google-api.html">Google API</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.07.google-play-services.html">Google Play Services</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.08.cloud-sync.html">クラウド同期</a></li>
            
        </ol>
        <li>デザイナー編</li>
        <ol>
        </ol>
    </ol>
    <ol class="appex_navigation">
        <li>付録</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/appendix/A.01.import-from-git-for-eclipse.html">Git リポジトリからのプロジェクトのインポート</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.02.basic-java.html">Java の文法の基礎</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.03.how-to-create-avd.html">仮想デバイスの作成</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.04.advanced-java.html">Javaの活用</a></li>
            
        </ol>
    </ol>
</nav>

      </paper-header-panel>
      <paper-scroll-header-panel main condenses>
        <!-- HEADER -->
        <paper-toolbar class="mainheader tall" role="toolbar">
    <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>

    <span class="title"></span>

    <a id="forkme_banner" href="https://github.com/mixi-inc/AndroidTraining" role="button">
        <paper-icon-button src="/AndroidTraining/images/blacktocat.png"></paper-icon-button> <span>View on GitHub</span>
    </a>

    <div class="middle title">mixi-inc/AndroidTraining</div>
    <div class="bottom title">テスト(AndroidStudio)</div>
</paper-toolbar>


<div id="description" itemprop="description">この章ではAndroidStudioでのユニットテストについて解説します。</div>



        <!-- MAIN CONTENT -->
        <div id="main_content_wrap" class="content outer" itemprop="articleBody">
          <section id="main_content" class="inner">
            <h2 id="section">目次</h2>

<ul>
  <li><a href="#tools">利用するツールについて</a></li>
  <li>テストの準備
    <ul>
      <li><a href="#add_dependencies">dependenciesの追加</a></li>
      <li><a href="#add_testInstrumentationRunner">testInstrumentationRunnerの設定</a></li>
    </ul>
  </li>
  <li><a href="#add_test_class">テストの作成</a>
    <ul>
      <li><a href="#add_test_method">テストメソッドの作成</a></li>
      <li><a href="#espresso_view_matcher">EspressoのMatcherを活用する</a>
        <ul>
          <li><a href="#espresso_import">主要メソッドのimportをする</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#exec_tests">テストの実行</a>
    <ul>
      <li><a href="#tests_command">コマンド</a></li>
    </ul>
  </li>
  <li><a href="#test_reports">テストレポート</a></li>
</ul>

<h2 id="section-1">このページを読む前に</h2>
<p>このページの内容は<a href="/AndroidTraining/fundamentals/2.11.testing.html">テスト</a>の内容を読んでいる前提で記述していますので、テストの記述などについてはユニットテストの項目を参照すると理解しやすいです。</p>

<h2 id="a-nametools-"><a name="tools"></a>利用するツールについて</h2>
<p>この章ではテストツールとしてEspressoを利用します。
Espressoは、Googleが公開したAndroid用のUIテスティングフレームワークで、2015年5月現在Android support libraryでサポートされているため、ここではEspressoを利用します。<br />
Espressoは、JUnit4が使えるため従来に比べ記述方法がシンプルになるなど利点が多いため、UIテストをする場合には積極的に活用していくのがよいでしょう。<br />
JUnit4はJavaの単体テストを行うテスティングフレームワークです。<br />
UIに関連のないユニットテストを行うためには<a href="http://robolectric.org/">Robolectric</a>の方が高速にテストを実施することが出来ます。(現在のところRobolectricについては解説しません、後日追記するかもしれません)</p>

<h2 id="section-2">テストの準備</h2>
<p>テストを実施する前に何点かテスト対象のモジュール内のbuild.gradleの編集が必要になります。</p>

<h3 id="a-nameadddependencies-dependencies"><a name="add_dependencies"></a>dependenciesの追加</h3>
<p>build.gradleのdependenciesに下記の2行を追加します</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">androidTestCompile</span> <span class="s1">'com.android.support.test.espresso:espresso-core:2.0'</span>
    <span class="n">androidTestCompile</span> <span class="s1">'com.android.support.test:testing-support-lib:0.1'</span>
<span class="o">}</span>
</code></pre>
</div>

<p>LICENSE.txt等のファイルの重複エラーが出た場合はgradleのエラーメッセージに従い、下記のような記述を追記するとよいでしょう。　</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">android</span> <span class="o">{</span>
    <span class="n">packagingOptions</span> <span class="o">{</span>
        <span class="n">pickFirst</span> <span class="s1">'LICENSE.txt'</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="a-nameaddtestinstrumentationrunner-testinstrumentationrunner"><a name="add_testInstrumentationRunner"></a>testInstrumentationRunnerの設定</h3>

<p>同じくbuild.gradleのdefaultConfigのtestInstrumentationRunnerにandroid.support.test.runner.AndroidJUnitRunnerを設定します。</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">android</span> <span class="o">{</span>
    <span class="n">defaultConfig</span> <span class="o">{</span>
        <span class="n">testInstrumentationRunner</span> <span class="s2">"android.support.test.runner.AndroidJUnitRunner"</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>ここまで出来たら一度ビルドを実行してみるとよいでしょう。
エラーが発生する場合は、gradleのエラーメッセージを見ながら解決していきましょう</p>

<h2 id="a-nameaddtestclass-"><a name="add_test_class"></a>テストの作成</h2>
<p>AndroidStudio上でテスト対象のファイル内で<code class="highlighter-rouge">cmd+shift+t</code> または、クラスのクラス宣言にカーソルを合わせ、<code class="highlighter-rouge">alt+Enter</code>Create Test を選択します。<br />
すると、下記のようなダイアログが表示されます。</p>

<p><img src="/AndroidTraining/assets/02-11/create_test_dialog.png" alt="create_test_dialog" /></p>

<p>これ以降の説明でJUnit4を使うので、JUnit4を選択します。(別のtesting libraryを選択したい場合はそれを選んでも構いません)<br />
setUp/tearDownのチェックボックスは必要に応じてチェックを入れてください。<br />
また、テスト対象のメソッドにはチェックを入れておくと自動生成されるので便利です。
OKボタンを押下すると、Diredtory Structureの選択画面になります。<br />
ここでは、<code class="highlighter-rouge">src/androidTest/java/</code>以下のものを選択します。</p>

<p>すると、下記のようなファイルが作成されます</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">sample</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.After</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Before</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>

<span class="cm">/**
 * Created by XXX on yy/mm/dd.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleViewTest</span> <span class="o">{</span>

    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@After</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tearDown</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testNewView</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>これでテストファイルの作成が出来たので一度テストを実行してみましょう。<br />
その際、Androidの実機、またはエミュレータが必要なので、利用できる状態にしておくとよいでしょう。<br />
右クリックメニューからRunを選択します。この時androidのシンボルのついたテストを選択します。</p>

<p><img src="/AndroidTraining/assets/02-11/run_test.png" alt="run_test" /></p>

<p>何も記述していないので無事テストが完了すると思います。</p>

<p>また、AndroidStudioのビルドシステムはgradleに統一されているため、コマンドラインからテストを実行することも出来ます。<br />
その場合は、下記コマンドで実行出来ます(テストが全部実行されます)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>./gradlew connectedAndroidTest
</code></pre>
</div>

<h3 id="a-nameaddtestmethod-"><a name="add_test_method"></a>テストメソッドの作成</h3>
<p>テストクラスが作成できたらテストメソッドの実装をしていきます。<br />
JUnit3の場合はメソッド名を<code class="highlighter-rouge">public void testXXX()</code>なメソッドがテスト対象のメソッドでしたが、JUnit4ではメソッドにアノテーションを付けることによりテスト対象のメソッドかを判断します。<br />
そのため、下記のような記述をすることによりテストとして実行されます。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="nd">@Test</span> 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">hoge</span> <span class="o">=</span> <span class="s">"hoge"</span><span class="o">;</span>
        <span class="n">assertEquals</span><span class="o">(</span> <span class="s">"hoge"</span><span class="o">,</span> <span class="n">hoge</span> <span class="o">);</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>また、@Testアノテーションにexpected 属性を付与すると、そのテストメソッドは例外が投げられる事を期待するテストメソッドとなります。<br />
異なる例外がThrowされた場合、または例外がThrowされない場合はテストが失敗します。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="nd">@Test</span><span class="o">(</span><span class="n">expected</span><span class="o">=</span><span class="n">NullPointerException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="err">ぬるぽ</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">hoge</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">hoge</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>Androidのテストを実行する場合、多くのケースではContextが必要です。Contextが必要な場合は<code class="highlighter-rouge"> InstrumentationRegistry.getContext();</code>で取得ができます。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">TextView</span> <span class="n">view</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextView</span><span class="o">(</span><span class="n">InstrumentationRegistry</span><span class="o">.</span><span class="na">getContext</span><span class="o">());</span>
        <span class="n">view</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"sample"</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">view</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="s">"sample"</span><span class="o">));</span>
    <span class="o">}</span>
</code></pre>
</div>

<h3 id="a-nameespressoviewmatcher-espressomatcher"><a name="espresso_view_matcher"></a>EspressoのMatcherを活用する</h3>
<p>EspressoにはViewのテストをするために便利なMatcherが用意されています。<br />
これらを活用するとViewのテストが効率的に記述することができるようになります。<br />
Espressoに関するドキュメントは<a href="https://code.google.com/p/android-test-kit/wiki/Espresso">公式ドキュメント</a>を参照するのがよいでしょう。<br />
ここでは、頻繁に利用する主要なメソッドについて簡単に説明します。</p>

<h4 id="a-nameespressoimport-import"><a name="espresso_import"></a>主要メソッドのimportをする</h4>
<p>Espresso, ViewActions, ViewMatchers, ViewAssertions, Matchers などの主要 static メソッドを import static で定義しておくと良いでしょう。<br />
static importをしなくても、使えますが記述をわかりやすくするために必要に応じてstatic importしておくのが便利です。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">apps</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">testing</span><span class="o">.</span><span class="na">ui</span><span class="o">.</span><span class="na">espresso</span><span class="o">.</span><span class="na">Espresso</span><span class="o">.</span><span class="na">onData</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">apps</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">testing</span><span class="o">.</span><span class="na">ui</span><span class="o">.</span><span class="na">espresso</span><span class="o">.</span><span class="na">Espresso</span><span class="o">.</span><span class="na">onView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">apps</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">testing</span><span class="o">.</span><span class="na">ui</span><span class="o">.</span><span class="na">espresso</span><span class="o">.</span><span class="na">Espresso</span><span class="o">.</span><span class="na">pressBack</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">apps</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">testing</span><span class="o">.</span><span class="na">ui</span><span class="o">.</span><span class="na">espresso</span><span class="o">.</span><span class="na">action</span><span class="o">.</span><span class="na">ViewActions</span><span class="o">.</span><span class="na">click</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">apps</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">testing</span><span class="o">.</span><span class="na">ui</span><span class="o">.</span><span class="na">espresso</span><span class="o">.</span><span class="na">action</span><span class="o">.</span><span class="na">ViewActions</span><span class="o">.</span><span class="na">closeSoftKeyboard</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">apps</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">testing</span><span class="o">.</span><span class="na">ui</span><span class="o">.</span><span class="na">espresso</span><span class="o">.</span><span class="na">action</span><span class="o">.</span><span class="na">ViewActions</span><span class="o">.</span><span class="na">typeText</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">apps</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">testing</span><span class="o">.</span><span class="na">ui</span><span class="o">.</span><span class="na">espresso</span><span class="o">.</span><span class="na">assertion</span><span class="o">.</span><span class="na">ViewAssertions</span><span class="o">.</span><span class="na">matches</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">apps</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">testing</span><span class="o">.</span><span class="na">ui</span><span class="o">.</span><span class="na">espresso</span><span class="o">.</span><span class="na">matcher</span><span class="o">.</span><span class="na">ViewMatchers</span><span class="o">.</span><span class="na">assertThat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">apps</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">testing</span><span class="o">.</span><span class="na">ui</span><span class="o">.</span><span class="na">espresso</span><span class="o">.</span><span class="na">matcher</span><span class="o">.</span><span class="na">ViewMatchers</span><span class="o">.</span><span class="na">hasContentDescription</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">apps</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">testing</span><span class="o">.</span><span class="na">ui</span><span class="o">.</span><span class="na">espresso</span><span class="o">.</span><span class="na">matcher</span><span class="o">.</span><span class="na">ViewMatchers</span><span class="o">.</span><span class="na">hasFocus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">apps</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">testing</span><span class="o">.</span><span class="na">ui</span><span class="o">.</span><span class="na">espresso</span><span class="o">.</span><span class="na">matcher</span><span class="o">.</span><span class="na">ViewMatchers</span><span class="o">.</span><span class="na">withId</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">apps</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">testing</span><span class="o">.</span><span class="na">ui</span><span class="o">.</span><span class="na">espresso</span><span class="o">.</span><span class="na">matcher</span><span class="o">.</span><span class="na">ViewMatchers</span><span class="o">.</span><span class="na">withText</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">Matchers</span><span class="o">.</span><span class="na">allOf</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">Matchers</span><span class="o">.</span><span class="na">containsString</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">Matchers</span><span class="o">.</span><span class="na">instanceOf</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">Matchers</span><span class="o">.</span><span class="na">is</span><span class="o">;</span>
</code></pre>
</div>

<h4 id="espressoonviewhttpsdeveloperandroidcomreferenceandroidsupporttestespressoespressohtmlonvieworghamcrestmatcherandroidviewview"><a href="https://developer.android.com/reference/android/support/test/espresso/Espresso.html#onView(org.hamcrest.Matcher&lt;android.view.View&gt;)">Espresso.onView</a></h4>
<p>Matcherを渡すと、一致したViewのViewInteractionを返します。<br />
このViewInteractionに対して、クリックなどの値のチェックなどを指定できます。</p>

<h4 id="viewmatcherswithidint-idhttpsdeveloperandroidcomreferenceandroidsupporttestespressomatcherviewmatchershtmlwithidorghamcrestmatcherjavalanginteger"><a href="https://developer.android.com/reference/android/support/test/espresso/matcher/ViewMatchers.html#withId(org.hamcrest.Matcher&lt;java.lang.Integer&gt;)">ViewMatchers.withId(int id)</a></h4>
<p>findViewByIdと同じく、ViewのIDを渡すと一致したViewのViewMatcherを返します。</p>

<h4 id="viewinteractioncheckviewassertionhttpsdeveloperandroidcomreferenceandroidsupporttestespressoviewassertionhtml"><a href="https://developer.android.com/reference/android/support/test/espresso/ViewAssertion.html">ViewInteraction.check(ViewAssertion)</a></h4>
<p>引数で渡されたViewAssertionでViewの状態を検査します。</p>

<h4 id="viewmatchersisdisplayedhttpsdeveloperandroidcomreferenceandroidsupporttestespressomatcherviewmatchershtmlisdisplayed"><a href="https://developer.android.com/reference/android/support/test/espresso/matcher/ViewMatchers.html#isDisplayed()">ViewMatchers.isDisplayed()</a></h4>
<p>Viewが表示されているかを返すメソッドです。</p>

<h4 id="viewmatcherswithtexthttpsdeveloperandroidcomreferenceandroidsupporttestespressomatcherviewmatchershtmlwithtextjavalangstring"><a href="https://developer.android.com/reference/android/support/test/espresso/matcher/ViewMatchers.html#withText(java.lang.String)">ViewMatchers.withText()</a></h4>
<p>Viewが持っているテキストが一致するかを返すメソッドです。</p>

<p>これらを利用すると、下記のような書き方ができます。<br />
下記の例はid=hogeのTextViewのテキストの値が”hoge”であることをテストしています。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Espresso</span><span class="o">.</span><span class="na">onView</span><span class="o">(</span><span class="n">ViewMatchers</span><span class="o">.</span><span class="na">withId</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">hoge</span><span class="o">)).</span><span class="na">check</span><span class="o">(</span><span class="n">ViewAssertions</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="n">ViewMatchers</span><span class="o">.</span><span class="na">withText</span><span class="o">(</span><span class="s">"hoge"</span><span class="o">)));</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>また、static importを活用すると下記のように書くことが出来ます。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">onView</span><span class="o">(</span><span class="n">withId</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">hoge</span><span class="o">)).</span><span class="na">check</span><span class="o">(</span><span class="n">matches</span><span class="o">(</span><span class="n">withText</span><span class="o">(</span><span class="s">"hoge"</span><span class="o">)));</span>
    <span class="o">}</span>
</code></pre>
</div>

<h3 id="a-nameexectests-"><a name="exec_tests"></a>テストの実行</h3>
<p>AndroidStudio上からテストを実行する場合は、テストクラスで<code class="highlighter-rouge">ctrl+shift+R</code>でダイアログが表示されるので、Android Tests を選択すると実行することが出来ます。</p>

<p><img src="/AndroidTraining/assets/02-11/choose_test.png" alt="choose_test" /></p>

<h4 id="a-nametestscommand-"><a name="tests_command"></a>コマンド</h4>
<p>コマンドラインからテストをする場合はgradleから実行することが出来ます。<br />
その場合、テストは<code class="highlighter-rouge">connectedAndroidTest</code>タスクで実行することが出来ます。<br />
CIサーバー上で実行する場合も<code class="highlighter-rouge">connectedAndroidTest</code>を追加するとテストが実行されます。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>./gradlew connectedAndroidTest
</code></pre>
</div>

<h3 id="a-nametestreports-"><a name="test_reports"></a>テストレポート</h3>
<p>AndroidStudio上で実行した場合は、画面上に結果が表示されると思います。<br />
テスト結果のレポートは
<code class="highlighter-rouge">[実行したモジュールのパス]/build/outputs/androidTest-results/connected/</code>
以下にxml形式で出力されます。CIサーバーなどを利用している場合、このxmlを結果として渡せば、適切に処理してくれると思います。<br />
また、<code class="highlighter-rouge">[実行したモジュールのパス]/build/outputs/reports/androidTests/connected/</code>
以下にhtml形式でも出力されています。<br />
手元で確認したい場合には、こちらの方が便利でしょう。</p>

          </section>
        </div>

        <!-- FOOTER  -->
        <div id="footer_wrap" class="outer">
          <footer class="inner">
  <p class="license">Portions of this page are reproduced from work created and <a href="https://code.google.com/p/android/">shared by the Android Open Source Project</a> and used according to terms described in the <a href="http://creativecommons.org/licenses/by/2.5/">Creative Commons2.5 Attribution License</a>.</p>
  <p class="license">
  This work is licensed under a <a rel="license" itemprop="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. 
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
  </p>
  <p class="copyright">Androidtraining maintained by <a href="https://github.com/mixi-inc" itemprop="author">mixi-inc</a></p>
  <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>

</footer>

        </div>
      </paper-scroll-header-panel>
    </paper-drawer-panel>
    <script>
        // custom transformation: scale header's title
        var title = document.querySelectorAll('.title')[2];
        addEventListener('paper-header-transform', function(e) {
            var d = e.detail;
            var m = d.height - d.condensedHeight;
            var scale = Math.max(0.75, (m - d.y) / (m / 0.25)  + 0.75);

            Polymer.Base.transform('scale(' + scale + ') translateZ(0)', title);
        });

    </script>
</body>
</html>
