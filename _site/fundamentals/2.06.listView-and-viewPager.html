<!DOCTYPE html>
<html lang="ja">

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="この章では、ListView と ViewPager の2つの特殊な View について解説します。" />
    <meta name=viewport content="width=device-width, initial-scale=1">
    <!-- ogp for twitter -->
    <meta content="@mixi_engineers" name="twitter:site" />
    <meta content="summary" name="twitter:card" />
    
    <meta content="ListViewとViewPager - mixi-inc/AndroidTraining" name="twitter:title" />
    
    <meta content="この章では、ListView と ViewPager の2つの特殊な View について解説します。" name="twitter:description" />
    <meta content="/assets/logo.png" name="twitter:image:src" />
    <!-- ogp -->
    <meta content="mixi-inc/AndroidTraining" property="og:site_name" />
    <meta content="article" property="og:type" />
    <meta content="/assets/logo.png" property="og:image" />
    
    <meta content="ListViewとViewPager - mixi-inc/AndroidTraining" name="og:title" />
    
    <meta content="/fundamentals/2.06.listView-and-viewPager.html" property="og:url" />
    <meta content="この章では、ListView と ViewPager の2つの特殊な View について解説します。" property="og:description" />
    
    <meta name="keyword" content="android, training, 基礎, スキル, 開発, developer, プログラミング, ListView, ViewPager" />
    

    <meta name="go-import" content="github.com/mixi-inc/AndroidTraining git https://github.com/mixi-inc/AndroidTraining.git">
    <script src="/AndroidTraining/bower_components/webcomponentsjs/webcomponents.js"></script>
    
    <link rel="stylesheet" type="text/css" media="screen" href="/AndroidTraining/stylesheets/main.css">
    <link rel="shortcut icon" href="/AndroidTraining/assets/favicon.ico" />
    <link rel="import" href="/AndroidTraining/bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-drawer-panel/paper-drawer-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-header-panel/paper-header-panel.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-toolbar/paper-toolbar.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-menu/paper-menu.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-item/paper-item.html">
    <link rel="import" href="/AndroidTraining/bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="/AndroidTraining/bower_components/iron-icons/iron-icons.html">
    <style is="custom-style">
        paper-scroll-header-panel:not([style-scope]):not(.style-scope) {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        paper-toolbar.tall .bottom:not([style-scope]):not(.style-scope) {
            font-size: 40px;
            margin-left: 60px;

            -webkit-transform-origin: left center;
            transform-origin: left center;
        }

        .content:not([style-scope]):not(.style-scope) {
            padding: 8px;
        }

        .spacer:not([style-scope]):not(.style-scope) {
            -ms-flex: 1 1 0.000000001px;
            -webkit-flex: 1;
            flex: 1;
            -webkit-flex-basis: 0.000000001px;
            flex-basis: 0.000000001px;
        }

    </style>
    <title>ListViewとViewPager - mixi-inc/AndroidTraining</title>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-50931519-13', 'auto');
    ga('send', 'pageview');
    </script>
  </head>

  <body itemscope itemtype="http://schema.org/Article" fullbleed layout vertical>

    <paper-drawer-panel selected="main" >
      <!-- MENU -->
      <paper-header-panel mode="seamed" drawer class="drawer">
        <nav>
    <ol class="chapter_navigation">
        <a href="/AndroidTraining/">Home</a>
        <li>まえがき</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/introductions/1.01.about-android-os.html">Android-OSについて</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.02.prepare-for-development.html">開発環境の準備</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.03.create-project-for-android-studio.html">プロジェクトの作成</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.04.basic-knowledge.html">Androidの基礎知識</a></li>
            
            <li><a href="/AndroidTraining/introductions/1.05.how-to-build-for-gradle.html">Android のビルドについて(Gradle)</a></li>
            
        </ol>
        <li>基礎編</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/fundamentals/2.01.create-layout.html">アプリのレイアウト作成</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.02.activity-and-fragment.html">ActivityとFragment</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.03.application-resource-management.html">アプリのリソース管理</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.04.messaging-and-notification.html">メッセージングと通知</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.05.actionbar-and-interaction-control.html">AppBarとインタラクション制御</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.06.listView-and-viewPager.html">ListViewとViewPager</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.07.serialize-and-collection-and-perpetuation.html">直列化とコレクション、永続化</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.08.async-processing.html">非同期処理</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.09.network-access.html">ネットワーク通信</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.10.database.html">データベース</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.11.testing-for-android-studio.html">テスト(AndroidStudio)</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.11.testing.html">テスト</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.12.handler-and-looper.html">HandlerとLooper</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.13.webView.html">WebView</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.14.accountmanager.html">AccountManager</a></li>
            
            <li><a href="/AndroidTraining/fundamentals/2.15.advance-contentprovider.html">ContentProviderの発展</a></li>
            
        </ol>
        <li>実務編</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/advanced/3.01.build-for-eclipse.html">デバッグと自動ビルド(Eclipse)</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.01.build-for-gradle.html">自動ビルド(Android Studio)</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.02.architecture-and-di.html">アーキテクチャ設計と DI</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.03.advanced-layout.html">続・アプリのレイアウト作成</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.04.user-interface.html">ユーザインタフェース設計</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.05.security.html">セキュリティ</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.06.google-api.html">Google API</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.07.google-play-services.html">Google Play Services</a></li>
            
            <li><a href="/AndroidTraining/advanced/3.08.cloud-sync.html">クラウド同期</a></li>
            
        </ol>
        <li>デザイナー編</li>
        <ol>
        </ol>
    </ol>
    <ol class="appex_navigation">
        <li>付録</li>
        <ol class="section_navigation">
            
            
            <li><a href="/AndroidTraining/appendix/A.01.import-from-git-for-eclipse.html">Git リポジトリからのプロジェクトのインポート</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.02.basic-java.html">Java の文法の基礎</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.03.how-to-create-avd.html">仮想デバイスの作成</a></li>
            
            <li><a href="/AndroidTraining/appendix/A.04.advanced-java.html">Javaの活用</a></li>
            
        </ol>
    </ol>
</nav>

      </paper-header-panel>
      <paper-scroll-header-panel main condenses>
        <!-- HEADER -->
        <paper-toolbar class="mainheader tall" role="toolbar">
    <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>

    <span class="title"></span>

    <a id="forkme_banner" href="https://github.com/mixi-inc/AndroidTraining" role="button">
        <paper-icon-button src="/AndroidTraining/images/blacktocat.png"></paper-icon-button> <span>View on GitHub</span>
    </a>

    <div class="middle title">mixi-inc/AndroidTraining</div>
    <div class="bottom title">ListViewとViewPager</div>
</paper-toolbar>


<div id="description" itemprop="description">この章では、ListView と ViewPager の2つの特殊な View について解説します。</div>



        <!-- MAIN CONTENT -->
        <div id="main_content_wrap" class="content outer" itemprop="articleBody">
          <section id="main_content" class="inner">
            <p>参考：<a href="http://developer.android.com/guide/topics/ui/declaring-layout.html#AdapterViews">Building Layouts with an Adapter | Android Developers</a><br />
参考：<a href="http://developer.android.com/training/improving-layouts/smooth-scrolling.html#ViewHolder">Making ListView Scrolling Smooth | Android Developers</a><br />
参考：<a href="http://developer.android.com/reference/android/support/v4/view/PagerAdapter.html">PagerAdapter | Android Developers</a><br />
参考：<a href="http://developer.android.com/reference/android/support/v13/app/FragmentPagerAdapter.html">FragmentPagerAdapter | Android Developers</a></p>

<h2 id="section">目次</h2>

<ul>
  <li><a href="#ListView">ListView</a>
    <ul>
      <li><a href="#ListAdapter">ListAdapter</a></li>
      <li><a href="#ListViewを表示する">ListViewを表示する</a></li>
      <li><a href="#カスタマイズしたリストアイテムを表示する">カスタマイズしたリストアイテムを表示する</a></li>
      <li><a href="#Viewの再利用について">Viewの再利用について</a></li>
      <li><a href="#パフォーマンスについて">パフォーマンスについて</a></li>
    </ul>
  </li>
  <li><a href="#ViewPager">ViewPager</a>
    <ul>
      <li><a href="#PagerAdapter">PagerAdapter</a></li>
      <li><a href="#FragmentPagerAdapter">FragmentPagerAdapter</a></li>
    </ul>
  </li>
</ul>

<h2 id="listview">ListView</h2>

<p>ListView は、縦にスクロールする一覧表示のための View です。</p>

<p>ListView 自身には、一覧の中身を管理する機能はありません。<br />
代わりに、Adapter という仕組みを用いて、データソースの管理と、データの View へのバインドをさせ、ListView は、スクロール位置に合わせて必要な View を Adapter から取り出すことをします。</p>

<p>リストデータは、List<T> インタフェースを実装したデータソースや、或いは、データベースへ問い合わせた結果のデータソースである場合もあります。</T></p>

<h3 id="listadapter">ListAdapter</h3>

<p>データをバインドして表示する際には、 ListAdapter インタフェースを実装した Adapter を使用します。<br />
Adapter にはいくつかの種類が提供されています。以下はその一部となります。</p>

<table>
  <thead>
    <tr>
      <th>名前</th>
      <th>役割</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>BaseAdapter</td>
      <td>ListView と Spinner で使用可能な共通基底クラスです。 ListView では ListAdapter 用の interface を実装します</td>
    </tr>
    <tr>
      <td>ArrayAdapter</td>
      <td>配列やリストデータソースをバインドする際に使用します</td>
    </tr>
    <tr>
      <td>CursorAdapter</td>
      <td>データベースへ問い合わせた結果をバインドする際に使用します</td>
    </tr>
    <tr>
      <td>SimpleCursorAdapter</td>
      <td>データベースへ問い合わせた結果を View へ容易にバインドできるようにしたCursorAdapterです</td>
    </tr>
  </tbody>
</table>

<h3 id="listview-">ListView を表示する</h3>
<p>ListView を表示するには以下の作業が必要となります。</p>

<ul>
  <li>ListView をレイアウトxmlに配置</li>
  <li>ListView に Adapter をセットする</li>
</ul>

<p>activity_main.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;RelativeLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">tools:context=</span><span class="s">".MainActivity"</span> <span class="nt">&gt;</span>

    <span class="c">&lt;!-- ListViewを配置 --&gt;</span>
    <span class="nt">&lt;ListView</span>
        <span class="na">android:id=</span><span class="s">"@+id/ListView"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"match_parent"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/RelativeLayout&gt;</span>
</code></pre>
</div>
<p>MainActivity.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
        <span class="n">mActivity</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>

        <span class="c1">// ListViewに表示するデータを作成する</span>
        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"hoge"</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">ListView</span> <span class="n">listView</span> <span class="o">=</span> <span class="o">(</span><span class="n">ListView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">ListView</span><span class="o">);</span>
        <span class="c1">// android.R.layout.simple_list_item_1はAndroidで既に定義されているリストアイテムのレイアウトです</span>
        <span class="n">ArrayAdapter</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayAdapter</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">mActivity</span><span class="o">,</span>
                <span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">simple_list_item_1</span><span class="o">,</span> <span class="n">list</span><span class="o">);</span>

        <span class="n">listView</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">adapter</span><span class="o">);</span>
        <span class="c1">// タップした時の動作を定義する</span>
        <span class="n">listView</span><span class="o">.</span><span class="na">setOnItemClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">OnItemClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onItemClick</span><span class="o">(</span><span class="n">AdapterView</span><span class="o">&lt;?&gt;</span> <span class="n">parent</span><span class="o">,</span> <span class="n">View</span> <span class="n">view</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// Adapterからタップした位置のデータを取得する</span>
                <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">parent</span><span class="o">.</span><span class="na">getItemAtPosition</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
                <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">mActivity</span><span class="o">,</span> <span class="n">str</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

</code></pre>
</div>
<p>まずは ArrayAdapter のインスタンスを作成します。<br />
ここではコンストラクタの引数に Context とリストアイテムのレイアウトIDと表示するデータをリスト形式で渡しています。<br />
ArrayAdapter には様々なコンストラクタが用意されています。適宜、適切なものを使用すると良いでしょう。</p>

<p>レイアウトIDには<code class="highlighter-rouge">android.R.layout.simple_list_item_1</code>を設定しています。これは Android で用意されているリストアイテムのレイアウトです。中には TextView が１つあるだけです。<br />
表現豊かなレイアウトを使用したい場合、自分で作成したレイアウトをリストアイテムに表示することもできます。<br />
その方法は次項リストアイテムをカスタマイズするにて説明します。</p>

<p>次に、 setAdapter メソッドで ListView に Adapter をセットします。<br />
最後に、 setOnItemClickListener メソッドでリストをタップした時の動作を設定しています。<br />
実行すると以下の様なListViewが表示されます。</p>

<p><img src="/AndroidTraining/assets/02-06/listview.png" alt="listview" /></p>

<h3 id="section-1">カスタマイズしたリストアイテムを表示する</h3>
<p>カスタマイズしたリストアイテムを表示するには以下の作業が必要となります。</p>

<ul>
  <li>リストアイテムのレイアウトxmlの作成</li>
  <li>ListView をレイアウトxmlに配置</li>
  <li>独自 Adapter の作成</li>
  <li>ListView に独自 Adapter をセットする</li>
</ul>

<h4 id="xml">リストアイテムのレイアウトxmlを作成する</h4>
<p>新規にレイアウトxmlを作成します。
リストアイテムのレイアウトは以下のように作成します。<br />
<img src="/AndroidTraining/assets/02-06/custom_list_item_layout.png" alt="custom_list_item_layout" /></p>

<p>custom_list_item.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;RelativeLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
    <span class="na">android:layout_margin=</span><span class="s">"4dp"</span> <span class="nt">&gt;</span>

    <span class="nt">&lt;ImageView</span>
        <span class="na">android:id=</span><span class="s">"@+id/imageView1"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_alignParentLeft=</span><span class="s">"true"</span>
        <span class="na">android:layout_alignParentTop=</span><span class="s">"true"</span>
        <span class="na">android:src=</span><span class="s">"@drawable/ic_launcher"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;TextView</span>
        <span class="na">android:id=</span><span class="s">"@+id/TitleText"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_alignParentRight=</span><span class="s">"true"</span>
        <span class="na">android:layout_alignParentTop=</span><span class="s">"true"</span>
        <span class="na">android:layout_toRightOf=</span><span class="s">"@+id/imageView1"</span>
        <span class="na">android:textSize=</span><span class="s">"18sp"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;TextView</span>
        <span class="na">android:id=</span><span class="s">"@+id/SubTitleText"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_alignLeft=</span><span class="s">"@+id/TitleText"</span>
        <span class="na">android:layout_alignParentRight=</span><span class="s">"true"</span>
        <span class="na">android:layout_below=</span><span class="s">"@+id/TitleText"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/RelativeLayout&gt;</span>
</code></pre>
</div>

<h4 id="adapter-">独自 Adapter を作成します</h4>
<p>Adapter 内ではリストアイテム View の生成と表示位置に対応するデータの取得、設定といった処理を行います。</p>

<p>CustomListItemAdapter.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomListItemAdapter</span> <span class="kd">extends</span> <span class="n">ArrayAdapter</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">LayoutInflater</span> <span class="n">mLayoutInflater</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CustomListItemAdapter</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">objects</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 第2引数はtextViewResourceIdとされていますが、カスタムリストアイテムを使用する場合は特に意識する必要のない引数です</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">objects</span><span class="o">);</span>
        <span class="c1">// レイアウト生成に使用するインフレーター</span>
        <span class="n">mLayoutInflater</span> <span class="o">=</span> <span class="o">(</span><span class="n">LayoutInflater</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">LAYOUT_INFLATER_SERVICE</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">View</span> <span class="nf">getView</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="n">View</span> <span class="n">convertView</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">View</span> <span class="n">view</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="c1">// ListViewに表示する分のレイアウトが生成されていない場合レイアウトを作成する</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">convertView</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// レイアウトファイルからViewを生成する</span>
            <span class="n">view</span> <span class="o">=</span> <span class="n">mLayoutInflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">custom_list_item</span><span class="o">,</span> <span class="n">parent</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">// レイアウトが存在する場合は再利用する</span>
            <span class="n">view</span> <span class="o">=</span> <span class="n">convertView</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">// リストアイテムに対応するデータを取得する</span>
        <span class="n">String</span> <span class="n">item</span> <span class="o">=</span> <span class="n">getItem</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>

        <span class="c1">// 各Viewに表示する情報を設定</span>
        <span class="n">TextView</span> <span class="n">text1</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">TitleText</span><span class="o">);</span>
        <span class="n">text1</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"Title:"</span> <span class="o">+</span> <span class="n">item</span><span class="o">);</span>
        <span class="n">TextView</span> <span class="n">text2</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">SubTitleText</span><span class="o">);</span>
        <span class="n">text2</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"SubTitle:"</span> <span class="o">+</span> <span class="n">item</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">view</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre>
</div>
<p>ArrayAdapter を継承して独自の Adapter を作成しています。<br />
getView メソッドをオーバーライドして、戻り値に表示するリストアイテムの View を返します。<br />
表示している位置のデータは getItem メソッドで取得することができます。</p>

<p><img src="/AndroidTraining/assets/02-06/custom_list_item.png" alt="custom_list_item" /></p>

<h3 id="view-">View の再利用について</h3>
<p>Android ではリストアイテムを表示する際に、既に View が生成されていてる場合はそれを再利用します。<br />
リストに表示するデータが50件あった場合、リストアイテムの View を50個を生成することはしないということです。<br />
画面を構成するのに必要な分の View が生成され、あとは再利用するため無駄な View を生成するといったことはありません。<br />
どのように View が再利用されているかを確認するため先ほどの CustomListItemAdapter クラスの getView メソッドを以下のように修正します。</p>

<p>CustomListItemAdapter.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">View</span> <span class="nf">getView</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="n">View</span> <span class="n">convertView</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">View</span> <span class="n">view</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="c1">// ListViewに表示する分のレイアウトが生成されていない場合レイアウトを作成する</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">convertView</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// レイアウトファイルからViewを生成する</span>
            <span class="n">view</span> <span class="o">=</span> <span class="n">mLayoutInflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">custom_list_item</span><span class="o">,</span> <span class="n">parent</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
            
            <span class="c1">// リストアイテムに対応するデータを取得する</span>
            <span class="n">String</span> <span class="n">item</span> <span class="o">=</span> <span class="n">getItem</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>

            <span class="c1">// 各Viewに表示する情報を設定</span>
            <span class="n">TextView</span> <span class="n">text1</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">TitleText</span><span class="o">);</span>
            <span class="n">text1</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"Title:"</span> <span class="o">+</span> <span class="n">item</span><span class="o">);</span>
            <span class="n">TextView</span> <span class="n">text2</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">SubTitleText</span><span class="o">);</span>
            <span class="n">text2</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"SubTitle:"</span> <span class="o">+</span> <span class="n">item</span><span class="o">);</span>

        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">// レイアウトが存在する場合は再利用する</span>
            <span class="n">view</span> <span class="o">=</span> <span class="n">convertView</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">// 一度作成したレイアウトの表示データを変更しないことにより、再利用されたデータがどこに表示されるかを確認する</span>
        <span class="k">return</span> <span class="n">view</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>実行すると以下のように View が使いまわされていることがわかります。<br />
<img src="/AndroidTraining/assets/02-06/recycle_list_item.png" alt="recycle_list_item" /></p>

<h3 id="section-2">パフォーマンスについて</h3>
<p>ListView がスクロールされるたびに findViewById メソッドを呼び出すとパフォーマンスが低下します。
再利用した View を表示するときでも各要素を更新することがあります。<br />
頻繁に findViewById メソッドを呼び出す場合には”view holder”デザインパターンを利用すると良いです。</p>

<p>詳しくは、 <a href="http://developer.android.com/training/improving-layouts/smooth-scrolling.html#ViewHolder">Hold View Objects in a View Holder | Android Developers</a>を御覧ください。</p>

<h2 id="viewpager">ViewPager</h2>

<p>ViewPager は、横にフリックして View を切り替えるための View です。<br />
単純な View だけでなく、Fragment を持たせて、複数の Fragment を切り替える用途にも使用出来ます。</p>

<p>ViewPager も、ListView と同じく、Adapter に中身を管理させます。<br />
また、ViewPager は Support Package で提供されている機能です。</p>

<h3 id="pageradapter">PagerAdapter</h3>
<p>データをバインドして表示する際には、ListAdapter インタフェースを実装した Adapter を使用します。<br />
PagerAdapter は ViewPager を表示するための基本的な Adapter です。</p>

<h4 id="pageradapter-1">PagerAdapterの使い方</h4>
<p>ここでは TextView をもつページが5つある ViewPager を作成します。</p>

<p>ViewPager を表示するには以下の作業が必要となります。</p>

<ul>
  <li>ViewPager をレイアウトxmlに配置</li>
  <li>独自 PagerAdapter を実装</li>
  <li>ViewPager に Adapter をセットする</li>
</ul>

<h5 id="viewpagerxml">ViewPagerをレイアウトxmlに配置</h5>
<p>ViewPager は Support Package で提供されているため、<code class="highlighter-rouge">android.support.v4.view.ViewPager</code>と記述します。</p>

<p>activity_main.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;RelativeLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">tools:context=</span><span class="s">".MainActivity"</span> <span class="nt">&gt;</span>

    <span class="nt">&lt;android.support.v4.view.ViewPager</span>
        <span class="na">android:id=</span><span class="s">"@+id/Pager"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"match_parent"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/RelativeLayout&gt;</span>
</code></pre>
</div>

<h5 id="pageradapter-">独自 PagerAdapter を実装</h5>
<p>PagerAdapter を実装するには最低限以下のメソッドを実装する必要があります。</p>

<table>
  <thead>
    <tr>
      <th>メソッド名</th>
      <th>役割</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Object instantiateItem(ViewGroup container, int position)</td>
      <td>ページを生成します</td>
    </tr>
    <tr>
      <td>void destroyItem(ViewGroup container, int position, Object object)</td>
      <td>ページを削除します</td>
    </tr>
    <tr>
      <td>int getCount()</td>
      <td>ページ数を返却します</td>
    </tr>
    <tr>
      <td>boolean isViewFromObject(View view, Object object)</td>
      <td>instantiateItemで返却されたキーObjectとページが関連付いているかどうかを確認します。</td>
    </tr>
  </tbody>
</table>

<p>SamplePagerAdapter.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">SamplePagerAdapter</span> <span class="kd">extends</span> <span class="n">PagerAdapter</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">PAGE_COUNT</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Context</span> <span class="n">mContext</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SamplePagerAdapter</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
        <span class="n">mContext</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">instantiateItem</span><span class="o">(</span><span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// TextViewを生成</span>
        <span class="n">TextView</span> <span class="n">textView</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextView</span><span class="o">(</span><span class="n">mContext</span><span class="o">);</span>
        <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"Position:"</span> <span class="o">+</span> <span class="n">position</span><span class="o">);</span>
        <span class="c1">//コンテナに追加</span>
        <span class="n">container</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">textView</span><span class="o">);</span>

        <span class="c1">// ここではTextView自体をキーとして返しています</span>
        <span class="k">return</span> <span class="n">textView</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroyItem</span><span class="o">(</span><span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="n">Object</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// viewの削除</span>
        <span class="c1">// objectはinstantiateItemで返却したオブジェクトです</span>
        <span class="n">container</span><span class="o">.</span><span class="na">removeView</span><span class="o">((</span><span class="n">View</span><span class="o">)</span> <span class="n">object</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// ページ数を返します。今回は固定値としています。</span>
        <span class="k">return</span> <span class="n">PAGE_COUNT</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isViewFromObject</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">,</span> <span class="n">Object</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// キーが正しいかを判定</span>
        <span class="k">return</span> <span class="n">view</span> <span class="o">==</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">object</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre>
</div>
<p>ViewPager はキーとなる object でそれぞれのページを関連付けています。このキーは instantiateItem メソッドで返却された object であり Adapter 内でのユニークな識別子として使用されます。<br />
上記のコードでは TextView 自身をキーとして使用しています。</p>

<h5 id="viewpageradapter">ViewPagerにAdapterをセットする</h5>
<p>MainActivity.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="n">ViewPager</span> <span class="n">pager</span> <span class="o">=</span> <span class="o">(</span><span class="n">ViewPager</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">Pager</span><span class="o">);</span>
        <span class="n">pager</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="k">new</span> <span class="n">SamplePagerAdapter</span><span class="o">(</span><span class="k">this</span><span class="o">));</span>

    <span class="o">}</span>
</code></pre>
</div>

<h3 id="fragmentpageradapter">FragmentPagerAdapter</h3>
<p>ViewPager は Fragment の切り替えに使われるケースが多いです。<br />
Fragment は簡単に提供できますし、それぞれのページのライフサイクルの管理ができるためです。<br />
ViewPager で Fragment を使う際のよくあるユースケースをカバーし実装されたものが、 FragmentPagerAdapter と FragmentStatePagerAdapter になります。</p>

<p>FragmentPagerAdapter は表示したページをメモリに保持します。
FragmentStatePagerAdapter は非表示になったページはステートの保持のみを行い Fragment を破棄します。ページ数が多い場合メモリ消費が大きくなるため使用すると良いです。</p>

<h4 id="fragmentpageradapter-">FragmentPagerAdapter の使い方</h4>

<ul>
  <li>ViewPager をレイアウトxmlに配置</li>
  <li>Fragment を作成</li>
  <li>独自 FragmentPagerAdapter を実装</li>
  <li>ViewPager にAdapter をセットする</li>
</ul>

<h5 id="viewpagerxml-1">ViewPagerをレイアウトxmlに配置</h5>

<p>PagerAdapter の使い方と同様のため割愛します。</p>

<h5 id="fragment">Fragmentを作成</h5>

<p>サンプルでは表示位置（position）を TextView 表示します。
そのため、newInstance メソッドを用意し position を引数として渡し Bundle を設定しています。<br />
Bundle から position を取得し、TextView に設定しています。</p>

<p>fragment_main.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;FrameLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">android:background=</span><span class="s">"@android:color/black"</span> <span class="nt">&gt;</span>

    <span class="nt">&lt;TextView</span>
        <span class="na">android:id=</span><span class="s">"@+id/TextView1"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_margin=</span><span class="s">"4dp"</span>
        <span class="na">android:background=</span><span class="s">"@android:color/white"</span>
        <span class="na">android:gravity=</span><span class="s">"center"</span>
        <span class="na">android:textSize=</span><span class="s">"90sp"</span>
        <span class="na">android:textStyle=</span><span class="s">"bold"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/FrameLayout&gt;</span>
</code></pre>
</div>
<p>SampleFragment.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleFragment</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">SampleFragment</span> <span class="nf">newInstance</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">SampleFragment</span> <span class="n">sampleFragment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SampleFragment</span><span class="o">();</span>
        <span class="n">Bundle</span> <span class="n">bundle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bundle</span><span class="o">();</span>
        <span class="n">bundle</span><span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="s">"position"</span><span class="o">,</span> <span class="n">position</span><span class="o">);</span>
        <span class="n">sampleFragment</span><span class="o">.</span><span class="na">setArguments</span><span class="o">(</span><span class="n">bundle</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">sampleFragment</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">View</span> <span class="nf">onCreateView</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">Bundle</span> <span class="n">bundle</span> <span class="o">=</span> <span class="n">getArguments</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">position</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">bundle</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">"position"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">View</span> <span class="n">view</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">fragment_main</span><span class="o">,</span> <span class="n">container</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>

        <span class="n">TextView</span> <span class="n">text</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">TextView1</span><span class="o">);</span>
        <span class="n">text</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">position</span><span class="o">));</span>

        <span class="k">return</span> <span class="n">view</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="fragmentpageradapter--1">独自 FragmentPagerAdapter を実装</h5>
<p>FragmentPagerAdapter を実装するには最低限以下のメソッドを実装する必要があります。</p>

<table>
  <thead>
    <tr>
      <th>メソッド名</th>
      <th>役割</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Fragment getItem (int position)</td>
      <td>Fragmentを生成します</td>
    </tr>
    <tr>
      <td>int getCount()</td>
      <td>ページ数を返します</td>
    </tr>
  </tbody>
</table>

<p>SampleFragmentPagerAdapter.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleFragmentPagerAdapter</span> <span class="kd">extends</span> <span class="n">FragmentPagerAdapter</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">PAGE_COUNT</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SampleFragmentPagerAdapter</span><span class="o">(</span><span class="n">FragmentManager</span> <span class="n">fm</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">fm</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Fragment</span> <span class="nf">getItem</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">SampleFragment</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">PAGE_COUNT</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<h5 id="viewpager--adapter-">ViewPager に Adapter をセットする</h5>
<p>Fragment を管理するため FragmentManager をコンストラクタに渡します。
Support Package を使用しているため、 FragmentManager を生成するメソッド名は getSupportFragmentManager となります。<br />
( Support Package でない場合は getFragmentManager となります)</p>

<p>MainActivity.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="n">ViewPager</span> <span class="n">pager</span> <span class="o">=</span> <span class="o">(</span><span class="n">ViewPager</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">Pager</span><span class="o">);</span>
        
        <span class="n">FragmentManager</span> <span class="n">fm</span> <span class="o">=</span> <span class="n">getSupportFragmentManager</span><span class="o">();</span>
        <span class="n">SampleFragmentPagerAdapter</span> <span class="n">sampleFragmentPagerAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SampleFragmentPagerAdapter</span><span class="o">(</span><span class="n">fm</span><span class="o">);</span>
        
        <span class="n">pager</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">sampleFragmentPagerAdapter</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre>
</div>

<h2 id="section-3">実習・課題</h2>

<h3 id="listview-1">ListView</h3>
<ol>
  <li>(実習) <a href="#カスタマイズしたリストアイテムを表示する">カスタマイズしたリストアイテムを表示する</a>で説明したプロジェクトを写経して実行してください。余裕がある場合は<a href="#Viewの再利用について">Viewの再利用について</a>についても試してみて下さい。説明したプロジェクトは<code class="highlighter-rouge">AndroidTraining/projects/fundamentals/6th/CustomListItemSample</code>にあります。</li>
  <li>(実習) 実習1の画面にボタンを配置し、ボタンをタップしたらListViewの先頭を表示するようにして下さい。<br />
ヒント:ListView には smoothScrollToPosition メソッドがあります。
    <ul>
      <li><a href="/AndroidTraining/assets/02-06/practice/practice_2_sample.png">スクリーンショット</a></li>
    </ul>
  </li>
  <li>(課題) 以下のListViewを表示するように実装してください。
    <ul>
      <li><a href="/AndroidTraining/assets/02-06/assignment/assignment_1_sample.png">スクリーンショット</a><br />
ListAdapterには予め用意されているBookクラスを使用するようにして下さい。</li>
    </ul>
  </li>
  <li>(課題) 課題3で作成したListViewをタップしたら、次画面に遷移してタップしたアイテムの情報を表示するようにしてください。
    <ul>
      <li><a href="/AndroidTraining/assets/02-06/assignment/assignment_2_sample.png">スクリーンショット</a></li>
    </ul>
  </li>
  <li>(課題) 課題3のContextMenuにListViewが設定されています。ContextMenuには追加と削除メニューが定義されています。追加をタップしたときは選択されているアイテムを新たなアイテムとしてListViewにデータを追加してください。削除をタップしたときは選択されているアイテムを削除するように実装してください。<br />
ヒント:データの追加、削除、表示の更新処理はAdapterで行います。
    <ul>
      <li><a href="/AndroidTraining/assets/02-06/assignment/assignment_3_sample.png">スクリーンショット</a></li>
    </ul>
  </li>
</ol>

<h3 id="viewpager-1">ViewPager</h3>
<ol>
  <li>(実習) <a href="#FragmentPagerAdapter の使い方">FragmentPagerAdapter の使い方</a>で説明したプロジェクトを写経して実行してください。説明したプロジェクトは<code class="highlighter-rouge">AndroidTraining/projects/fundamentals/6th/FragmentViewPagerSample</code>にあります。</li>
  <li>(課題) 実習1のプロジェクトを引き続き使用してください。ActionBarのTab Navigationを追加し、Tabを選択したら該当のページが表示されるようにしてください。（3番目のTabを選択したら3ページ目が表示される）また、ページをスクロールさせたら該当のTabが選択されるようにしてください。 また、Tabとページの数は3つとしてください。</li>
</ol>


          </section>
        </div>

        <!-- FOOTER  -->
        <div id="footer_wrap" class="outer">
          <footer class="inner">
  <p class="license">Portions of this page are reproduced from work created and <a href="https://code.google.com/p/android/">shared by the Android Open Source Project</a> and used according to terms described in the <a href="http://creativecommons.org/licenses/by/2.5/">Creative Commons2.5 Attribution License</a>.</p>
  <p class="license">
  This work is licensed under a <a rel="license" itemprop="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. 
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
  </p>
  <p class="copyright">Androidtraining maintained by <a href="https://github.com/mixi-inc" itemprop="author">mixi-inc</a></p>
  <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>

</footer>

        </div>
      </paper-scroll-header-panel>
    </paper-drawer-panel>
    <script>
        // custom transformation: scale header's title
        var title = document.querySelectorAll('.title')[2];
        addEventListener('paper-header-transform', function(e) {
            var d = e.detail;
            var m = d.height - d.condensedHeight;
            var scale = Math.max(0.75, (m - d.y) / (m / 0.25)  + 0.75);

            Polymer.Base.transform('scale(' + scale + ') translateZ(0)', title);
        });

    </script>
</body>
</html>
